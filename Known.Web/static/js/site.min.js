Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};var Utils={list2Tree:function(n,t,i){var r=n.slice();return r.filter(function(n){var u=r.filter(function(i){return n.id===i[t]});return u.length>0&&(n.children=u),n[t]===i})},tree2List:function(n,t){var i=n.slice();return i.reduce(function(n,i){var r=arguments.callee;return n.push(i),i[t]&&i[t].length>0&&i[t].reduce(r,n),n},[]).map(function(n){return n[t]=[],n})},setUser:function(n){sessionStorage.setItem("Known_User",JSON.stringify(n))},getUser:function(){var n=sessionStorage.getItem("Known_User");return n?JSON.parse(n):null},setCodes:function(n){localStorage.setItem("Known_Codes",JSON.stringify(n))},getCodes:function(n){var i=localStorage.getItem("Known_Codes"),t;return i?(t=JSON.parse(i),!t)?null:t[n]:null},setFormDetail:function(n,t){var r,i,u;for(r in t)i=n.find("."+r),i.length&&(u=i.attr("dateFormat"),u?i.html(new Date(t[r]).format(u)):i.html(t[r]))},bindList:function(n,t,i){var r;if(i===undefined&&(i="请选择"),i!==""&&n.append('<option value="" selected>'+i+"<\/option>"),t&&t.length)for(r=0;r<t.length;r++){var u=t[r].Code,f=t[r].Name||u,e=i||r!==0?"":" selected";n.append('<option value="'+u+'"'+e+">"+f+"<\/option>")}}};$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&i.timeout&&(top.location="/login")}});$(function(){$("[url]").each(function(){var n=$(this).html(""),t=n.attr("url");t&&$.get(t,function(t){if(n[0].tagName==="SELECT"){var i=n.attr("emptyText");Utils.bindList(n,t,i)}})});$("[code]").each(function(){var n=$(this).html(""),t=n.attr("code"),i=n.attr("emptyText"),r=Utils.getCodes(t);Utils.bindList(n,r,i)})});$(document).on("click",".layui-table-body table.layui-table tbody tr",function(){var f=$(this).attr("data-index"),r=$(this).parents(".layui-table-box"),t,i,u,n;for(tableDiv=r.find(".layui-table-fixed.layui-table-fixed-l").length>0?r.find(".layui-table-fixed.layui-table-fixed-l"):r.find(".layui-table-body.layui-table-main"),t=tableDiv.find(".layui-unselect.layui-form-checkbox.layui-form-checked").parent().parent().parent(),i=0;i<t.length;i++)u=$(t[i]).attr("data-index"),u!=f&&(n=tableDiv.find("tr[data-index="+u+"]").find("td div.laytable-cell-checkbox div.layui-form-checkbox I"),n.length>0&&n.click());n=tableDiv.find("tr[data-index="+f+"]").find("td div.laytable-cell-checkbox div.layui-form-checkbox I");n.length>0&t.length===1?n.click():n.click()});$(document).on("click","td div.laytable-cell-checkbox div.layui-form-checkbox",function(n){n.stopPropagation()});