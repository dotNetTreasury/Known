function log(n){console.log(n)}function Router(n,t){var f=t||{},i=n,r={},u=this;this.elem=i;this.route=function(n){var u=r.component,t;u&&u.destroy&&u.destroy();n.previous||(n.previous=r);r=n;t=n.component;t&&(typeof t=="string"?i.html(t):(i.html(""),t.render(i)),setTimeout(function(){t.mounted&&t.mounted();Page.complete()},10))};this.back=function(){u.route(r.previous)}}function WsUtil(){var n=null,i=!1,t=this;this.connectById=function(n,t,i){window[n]={};this.connect("/ws?id="+n,t,function(n){if(n&&n.length){var t=JSON.parse(n);i&&i(t)}})};this.connect=function(r,u,f){return r=WsUtil.getUrl(r,u),log("Connecting......"),n=new WebSocket(r),n.onopen=function(){log("Connected")},n.onmessage=function(n){n.data&&f&&f(n.data)},n.onclose=function(){i||(log("Disconnected"),t.connect(r,u,f))},n.onerror=function(n){log(n);t.close()},window.onbeforeunload=function(){t.close()},n};this.send=function(t){n&&n.send(t)};this.close=function(){i=!0;n&&(n.close(),n=null,log("Closed"))}}function Login(){function o(n){var t=$("<div>").addClass("login-header").appendTo(n);$("<h2>").html(e).appendTo(t)}function s(n){var i=$("<div>").addClass("login").attr("id","login").appendTo(n),t=$("<div>").addClass("login-body").appendTo(i);r||h(t);c(t);r||a(t)}function h(n){var t=$("<div>").addClass("login-bell").appendTo(n);$("<img>").attr("src","/img/login_icon1.png").attr("alt","login").appendTo(t).on("click",function(){var n=$(this).data("icon")||"1",t;n=n==="1"?"2":"1";t="/img/login_icon"+n+".png";$(this).data("icon",n).attr("src",t);$(".login-form").hide();$("#login"+n).show()})}function c(i){var r=$("<div>").addClass("login-form").attr("id","login1").appendTo(i),e=$("<div>").addClass("login-title").attr("id","ltLogin").append(n.UserLogin).appendTo(r),f;e.css("padding-bottom","0");t(r,"userName","text","fa fa-user",n.UserName,'$("#password").focus()');t(r,"password","password","fa fa-lock",n.Password,'$("#captcha").focus()');l(r);f=$("<div>").addClass("login-form-item").appendTo(r);$("<button>").addClass("btn-primary").attr("id","btnLogin").html(n.Login).appendTo(f).on("click",function(){u($(this),!1)});$("<div>").attr("id","message").appendTo(r)}function t(n,t,i,r,u,f){var e=$("<div>").addClass("login-form-item").appendTo(n);return $("<label>").addClass(r).attr("for",t).appendTo(e),$("<input>").attr("type",i).attr("id",t).attr("placeholder",u).attr("autocomplete","off").attr("onenter",f).appendTo(e),e}function l(i){var r=t(i,"captcha","text","fa fa-check-circle-o",n.Captcha,'$("#btnLogin").click()');$("<img>").attr("id","imgCaptcha").attr("src","/Home/GetCaptcha").attr("title",n.RefreshCaptcha).attr("alt","").appendTo(r).on("click",function(){var n=$(this),t=n.attr("src").split("?")[0];n.attr("src",t+"?rnd="+Math.random())})}function a(t){var i=$("<div>").addClass("login-form").attr("id","login2").appendTo(t),r;i.hide();$("<div>").addClass("login-title").attr("id","ltScan").append(n.ScanCode).appendTo(i);r=$("<div>").addClass("login-qrcode").appendTo(i);$("<img>").attr("src","/img/qrcode.png").attr("alt","qrcode").appendTo(r)}function v(n){var t=$("<div>").addClass("login-footer").appendTo(n);$("<p>").addClass("copyright").append("").appendTo(t)}function u(t,r){var h,c;$(".login-form-item input").removeClass("error");var e=i("userName"),o=i("password"),s=i("captcha"),l=Utils.getClientId();e!==""&&o!==""&&s!==""&&(h=t.html(),c=t.attr("disabled",!0).html(n.Logining),$.post("/signin",{userName:e,password:o,captcha:s,cid:l,force:r},function(n){c.removeAttr("disabled").html(h);n.IsValid?(f("#00f",n.Message),location=location):n.Data&&n.Data.Confirm?Layer.confirm(n.Message,function(){u(t,!0)}):f("#f00",n.Message)}))}function i(n){var t=$("#"+n),i=$.trim(t.val());return i===""&&t.addClass("error"),i}function f(n,t){$("#message").css("color",n).html(t)}var r=Utils.checkMobile(),e="Known快速开发平台",n={UserLogin:"用户登录",ScanCode:"手机扫码",UserName:"用户名",Password:"密码",Captcha:"验证码",RefreshCaptcha:"单击可刷新",Login:"登 录",Logining:"登录中..."};this.render=function(n){$("body").css("background-image","url(/img/bg.jpg)");o(n);s(n);v(n)};this.mounted=function(){$("#userName").focus()}}const DateFormat="yyyy-MM-dd",DateTimeFormat="yyyy-MM-dd HH:mm:ss",KeyToken="Known-Token",KeyUser="Known_User",KeyCode="Known_Codes",KeyClient="Known_Client",KeyDownload="Known-Download";Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};WsUtil.getUrl=function(n,t){var i,r,u;if(n.indexOf("ws://")>-1||n.indexOf("wss://")>-1||(i=location.protocol==="https:"?"wss://":"ws://",n.indexOf(location.host)<0&&(i+=location.host),n=i+n),t){n+=n.indexOf("?")<0?"?":"&";r=[];for(u in t)r.push(u+"="+t[u]);n+=r.join("&")}return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?"":decodeURI(t[2])},getClientId:function(){var r=function(n){var t="";for(i=0;i<n.length;i++)t+=u(n.charCodeAt(i));return t},u=function(n){for(var t=n.toString(16),i=0;i+t.length<4;)t="0"+t,i++;return t},t=document.createElement("canvas"),n=t.getContext("2d");n.font="14px Arial";n.fillStyle="#ccc";n.fillText(KeyClient,2,2);var f=t.toDataURL().replace("data:image/png;base64,",""),e=window.atob(f);return r(e.slice(-16,-12))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},setUser:function(n){var t=KeyUser;n?sessionStorage.setItem(t,JSON.stringify(n)):sessionStorage.removeItem(t)},getUser:function(){var n=sessionStorage.getItem(KeyUser);return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){var t=KeyCode;n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return(r=localStorage.getItem(KeyCode),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion&&(n.form.Province.setData(window.PCARegion,n.data.Province),n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area&&n.form.Area.setData([])}),n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City)),n.form.Area&&(n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)}),n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area))))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&$("<i>").addClass(n.icon).appendTo(i);n.style&&i.addClass(n.style);$("<span>").html(n.text||n.name).appendTo(i);i.on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i},parseDom:function(n,t,i){typeof t=="function"?t(i):n.append(t)}},Layer={open:function(){},loading:function(){},tips:function(){},alert:function(){},confirm:function(){}},Ajax={get:function(n,t,i){$.get(n,t,function(n){n.Message&&Layer.tips(n.Message);n.IsValid?i&&i(n.Data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading();$.post(n,t,function(n){r.close();n.IsValid?(Layer.tips(n.Message),i&&i(n.Data)):n.Message?Layer.alert(n.Message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.IsValid?(Layer.tips(n.Message),r&&r(n.Data)):n.Message?Layer.alert(n.Message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f=KeyDownload,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$("<form>").attr("method","post").attr("action",n).attr("target","").appendTo("body").hide(),u;if($("<input>").attr("type","hidden").attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$("<input>").attr("type","hidden").attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},Page={complete:function(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()});$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser(),app=new Router($("#app"));$(document).ajaxSend(function(n,t){t.setRequestHeader(KeyToken,curUser?curUser.Token:"");t.setRequestHeader(KeyClient,Utils.getClientId())});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.app.login():i.error&&app.route({component:new Error(i)}))}});$(document).contextmenu(function(n){n.preventDefault()});app.route({component:new Login});