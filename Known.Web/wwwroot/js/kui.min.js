function log(n){console.log(n)}function loginByToken(n){$.post("/signToken",{token:n},function(n){n.IsValid?location="/":$("#app").html(n.Message)})}function registerWorker(){navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js")}function initDropdown(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()})}function WsUtil(){var n=null,i=!1,t=this;this.connectById=function(n,t,i){window[n]={};this.connect(baseUrl+"/ws?id="+n,t,function(n){if(n&&n.length){var t=JSON.parse(n);i&&i(t)}})};this.connect=function(r,u,f){return r=WsUtil.getUrl(r,u),log(Language.Connecting+"......"),n=new WebSocket(r),n.onopen=function(){log(Language.ClientConnected)},n.onmessage=function(n){n.data&&f&&f(n.data)},n.onclose=function(){i||(log(Language.ClientDisconnected),t.connect(r,u,f))},n.onerror=function(n){log(n);t.close()},window.onbeforeunload=function(){t.close()},n};this.send=function(t){n&&n.send(t)};this.close=function(){i=!0;n&&(n.close(),n=null,log(Language.ClientClosed))}}function Router(n,t){var u=t||{},i=n,r={},f=this;this.elem=i;this.route=function(n){var f=r.component,t;f&&f.destroy&&f.destroy();u.isTop&&(n.previous||(n.previous=r),r=n);t=n.component;t&&(typeof t=="string"?i.html(t):(i.html(""),u.multiNode?t.render(i):t.render().appendTo(i)),setTimeout(function(){Page.complete();t.mounted&&t.mounted()},10))};this.back=function(){f.route(r.previous)}}function Form(n,t){function ut(){i.tabs?at(i.tabs):yt();i.style&&h.addClass(i.style);i.ahtml&&Utils.parseDom(e,i.ahtml,e);u.body=e;pt(h);i.toolbar&&i.toolbar.length?ft(i.toolbar):e.css({bottom:0});i.url?ot(i.url):i.data&&u.setData(i.data)}function at(n){var t,i,f;for(r.addClass("tabs tabs-fit tabs-form"),s=$("<div>").addClass("tabs-header").appendTo(r),c=$("<div>").addClass("tabs-title").appendTo(s),v=$("<ul>").appendTo(s),d=$("<div>").addClass("right-toolbar").appendTo(s),y=$("<div>").addClass("tabs-body").appendTo(r),e=$("<div>").attr("id",rt+"0").addClass("tabs-item active").css("padding","0").appendTo(y),h=$("<div>").addClass("form").appendTo(e),t=0;t<n.length;t++)i=n[t],i.index=t,f=$("<li>").append(i.name).appendTo(v).data("item",i).on("click",function(){var n=$(this).data("item"),t;if(vt($(this),n),t=u.getData(),n.onClick)n.onClick({head:t,item:n.component});else n.component&&n.component.load&&n.component.load({head:t,isDetail:it})}),t===0&&f.addClass("active")}function vt(n,t){v.find("li").removeClass("active");n.addClass("active");var u=t.index||0,r=rt+u,i=$("#"+r);i.length||(i=$("<div>").attr("id",r).addClass("tabs-item").appendTo(y),new Router(i,{}).route(t));$(".tabs-item",y).removeClass("active");i.addClass("active")}function yt(){if(i.card?r.addClass("form-card"):i.info&&r.addClass("form-info"),r.hasClass("form-card"))s=$("<div>").addClass("form-card-header").appendTo(r),c=$("<div>").addClass("form-title").appendTo(s),d=$("<div>").addClass("right-toolbar").appendTo(s),e=$("<div>").addClass("form-card-body").appendTo(r),h=$("<div>").addClass("form").appendTo(e);else if(r.hasClass("form-info")){var n=i.icon||"fa fa-window-maximize";s=$("<div>").addClass("form-info-header").appendTo(r);c=$("<div>").append('<i class="'+n+'">').append(i.title).appendTo(s);e=$("<div>").addClass("form-info-body").appendTo(r);h=$("<div>").addClass("form").appendTo(e)}else e=r,h=r.length?r:$("<div>").addClass("form").appendTo(e)}function pt(n){var s,f,t,e,u,h;if(i.fields&&i.fields.length)s=i.fields.filter(function(n){return n.type&&n.type!==""}),wt(n,s);else for(f=r.find("input,select,textarea"),t=0;t<f.length;t++)e=$(f[t]),u=e.attr("name"),u&&u.length&&(h=o.filter(function(n){return n.name===u}),h.length||w(new Input(e)))}function ft(n){r.hasClass("form-card")?(f||(f=$("<div>").addClass("form-card-footer").appendTo(r)),f.html(""),et(f,n),Utils.createButton({icon:"fa fa-close",text:Language.Close,style:"fbClose danger",handler:function(){u.close()}}).appendTo(f)):(f||(f=$("<div>").addClass("form-button").appendTo(h),i.labelWidth&&f.css({marginLeft:i.labelWidth+20+"px"})),f.html(""),et(f,n))}function et(n,t){for(var r,f,i=0;i<t.length;i++)r=t[i],f=Utils.createButton(r,{form:u}).appendTo(n),r.detail&&(f.addClass("fbDetail"),nt.push({elem:f,item:r}))}function ot(n){i.isPrint?$.ajax({url:n,"async":!1,success:function(n){u.setData(n)}}):Ajax.get(n,null,function(n){u.setData(n)})}function wt(n,t){var f,i,r,e;for(n.html(""),f=0;f<t.length;f++)(i=t[f],i.visible===undefined||i.visible)&&(i.form=u,i.type==="hidden"?(e=new Input(n,i),w(e)):(i.label?k[i.label]?r=k[i.label]:(r=ht(n,i),k[i.label]=r):r=ht(n,i),i.type==="html"?st(i,r):(e=new Input(r,i),w(e),st(i,r)),i.tips&&$("<span>").addClass("form-tips").html(i.tips).appendTo(r)))}function st(n,t){n.inputHtml&&Utils.parseDom(t,n.inputHtml,{form:u,field:n,parent:t})}function ht(n,t){var e=t.label||t.title||"";e.length&&(e+="：");var u=$("<div>").addClass("form-item").appendTo(n),o=$("<label>").addClass("form-label").html(e).appendTo(u),f=$("<div>").addClass("form-input").appendTo(u),s=r.hasClass("form-block");return t.itemStyle&&u.addClass(t.itemStyle),t.inputStyle&&f.addClass(t.inputStyle),(t.lineBlock||s&&t.type==="textarea")&&u.addClass("block"),(t.inputBlock||!s&&t.type==="textarea")&&f.addClass("block"),t.colSpan&&u.addClass(t.colSpan),t.required&&o.addClass("required"),i.labelWidth&&(o.css({width:i.labelWidth+"px"}),(t.inputBlock||t.lineBlock||t.type==="textarea")&&f.css({marginLeft:i.labelWidth+20+"px"})),f}function w(n){o.push(n);u[n.name]=n}function bt(n,t){function u(n){n.mousedown(function(n){n.preventDefault();i.move=!0;i.offset=[n.clientX-parseFloat(r.css("left")),n.clientY-parseFloat(r.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),i.move){var t=n.clientX-i.offset[0],u=n.clientY-i.offset[1];r.css({left:t,top:u})}}).mouseup(function(){delete i.move})}n.html("");var i={};t?($("<i>").addClass("fa fa-window-maximize maximize").data("isMax",!1).appendTo(n).click(function(){Layer.changeMax($(this),r,"form-dialog-max",Layer.index+1)}),u(s)):$("<i>").addClass("fa fa-chevron-up").appendTo(n).click(function(){r.hasClass("collapse")?(r.removeClass("collapse"),$(this).removeClass("fa-chevron-down").addClass("fa-chevron-up")):(r.addClass("collapse"),$(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"))});$("<i>").addClass("fa fa-close close").appendTo(n).click(ct)}function g(n,o,h){var w,ft,k,y,p,g,rt,ut,et;tt=!0;it=o;n=n||{Id:""};b||(w=getCurTab(),b=w?w.title:"");s.length&&(c.html(""),ft=t.icon||"fa fa-window-maximize",c.append('<i class="'+ft+'">').append(b),k=n.Id===""?"【"+Language.New+"】":o?"【"+Language.Detail+"】":"【"+Language.Edit+"】",y="",i.titleInfo&&(y=i.titleInfo(n)),y.indexOf("【")>-1&&(k=""),c.append(k+y),bt(d,a));u.setData(n,o);i.tabs&&v.find("li:eq(0)").click();f&&(p=o&&nt.length===0,p?f.hide():f.show(),!p&&o?(f.find("button").hide(),f.find(".fbDetail,.fbClose").show()):f.find("button").show(),i.tabs||e.css({bottom:(p?0:40)+"px"}));a&&!h&&(r.addClass("form-dialog"),g=Layer.index++,$("<div>").attr("id",l+"Mask").addClass("mask").css({zIndex:g}).appendTo($("body")),rt=i.width||800,ut=i.height||400,r.css({zIndex:g+1,width:rt+"px",height:ut+"px",marginTop:-(ut/2)+"px",marginLeft:-(rt/2)+"px"}));r.removeClass("collapse");r.show();i.max&&(et=r.find(".right-toolbar .maximize"),Layer.changeMax(et,r,"form-dialog-max",Layer.index+1))}function ct(){if($("#"+l+"Mask").remove(),r.hasClass("form-dialog-max")){var n=r.find(".right-toolbar .fa-window-restore");Layer.changeMax(n,r,"form-dialog-max",Layer.index+1)}Layer.index--;r.hide();i.onClose&&i.onClose()}var i=t,l=typeof n=="string"?"form"+n:n.attr("id"),r=typeof n=="string"?$("#"+l):n,lt=t.saveClose===undefined?!0:t.saveClose,b=i.title,k={},o=[],nt=[],u=this,tt,a,it,v,y,rt=l+"-tab-",s,c,d,e,h,f,p={};this.id=l;this.elem=r;this.body=null;this.option=i;this.data={};this.render=function(){return this.elem=r=$("<div>"),ut(),r};this.show=function(n,t,i){p=i||{};a=r.hasClass("form-card")||r.hasClass("tabs-form");g(n,t,!1)};this.showDialog=function(n,t,i){p=i||{};a=!0;g(n,t,!1)};this.close=function(){tt&&ct()};this.setToolbar=function(n){this.option.toolbar=n;ft(n)};this.validate=function(){for(var t,i=[],n=0;n<o.length;n++)t=o[n],t.validate()||i.push(t);return i.length===0};this.clear=function(){for(var t,n=0;n<o.length;n++)t=o[n],t.clearError(),t.setValue("")};this.getData=function(){for(var t,r,i={},u=[],n=0;n<o.length;n++)t=o[n],t.name&&t.type!=="html"&&(t.name.indexOf(".")>-1?(r=t.name.split("."),i[r[0]]||(u.push(r[0]),i[r[0]]={}),i[r[0]][r[1]]=t.getValue()):i[t.name]=t.getValue());if(u.length)for(n=0;n<u.length;n++)i[u[n]]=JSON.stringify(i[u[n]]);return i};this.setData=function(n,t){var e,r,f,s,h;for(this.data=n,e=0;e<o.length;e++)r=o[e],r.clearError(),r.data=n,t?r.setReadonly(!0):r.setReadonly(r.readonly),r.name&&r.name.indexOf(".")>-1?(f=r.name.split("."),$.isPlainObject(n[f[0]])||(n[f[0]]=JSON.parse(n[f[0]]||"{}")),r.setValue(n[f[0]][f[1]],t)):(s=n[r.name],r.type==="picker"&&(s={value:s,text:n[r.name+"Name"]}),r.setValue(s,t));h={form:u,data:n,isDetail:t};i.setData&&i.setData(h)};this.setReadonly=function(n){for(var i,t=0;t<o.length;t++)i=o[t],i.setReadonly(n)};this.setInput=function(n){w(n)};this.load=function(n,t){i.url=n;Ajax.get(n,null,function(n){u.setData(n,t)})};this.reload=function(){ot(i.url)};this.save=function(n,t){function s(n){if(r.Id=n,i.tabs?g(r,!1,!0):lt&&u.close(),p.onSaveCallback)p.onSaveCallback(r);else t&&t(r)}var r,f,e,o;u.validate()&&(r=u.getData(),i.onSaving&&i.onSaving(r),f=[],i.fields&&(f=i.fields.filter(function(n){return n.type&&n.type==="file"})),f.length?Ajax.upload(f[0].field,n,r,s):(e={data:JSON.stringify(r)},i.submitData&&(o=i.submitData(),$.extend(e,o)),Ajax.post(n,e,s)))};r.length&&(ut(),i.isPrint||Page.complete())}function Input(n,t){function a(){f?i.component.render().appendTo(n):(h(i.type),r.render(n),r.elem&&(u=r.elem,v()),i.unit&&(n.css({position:"relative"}),$("<span>").addClass("form-unit").html(i.unit).appendTo(n)),i.value&&r.setValue(i.value))}function h(n){r=n==="label"?new p(i):n==="radio"?new w(i):n==="checkbox"?new b(i):n==="select"?new k(i):n==="date"?new d(i):n==="file"?new g(i):n==="picker"?new nt(i):n==="editor"?new tt(i):n==="textarea"?new it(i):new rt(i)}function v(){u.attr("name",o);i.placeholder&&u.attr("placeholder",i.placeholder);i.required&&u.attr("required",!0);i.inputStyle&&u.attr("style",i.inputStyle);i.change&&c(i.change)}function y(){u=n;e=u.parent();o=u.attr("name");_data=[];var t=u[0].nodeName==="SELECT"?"select":u[0].type;$.extend(i,{field:o,type:t,required:u[0].required});h(t)}function c(n){u&&u.change(function(){var t=$(this);n&&n({form:i.form,elem:t,value:t.val(),selected:t.find(":selected").data("data")})})}function p(n){var t,i=n.value;this.option=n;this.render=function(n){t=$("<div>").addClass("label").appendTo(n)};this.getData=function(){};this.setData=function(){};this.getValue=function(){return i};this.setValue=function(r){i=r;var u=r;n.code&&(u=Utils.getCodeName(n.code,r));t.html(u)};this.setReadonly=function(){}}function w(n){function i(n,t,i,u){var f,o;if(t.label||n.html(""),f=Utils.getCodes(i),f&&f.length)for(o=0;o<f.length;o++){var e=f[o],s=e.Code===""?"":e.Code||e,h=e.Name||s;r(n,e,s,h,u||t.value,t)}}function r(n,t,i,r,u,f){if(t.Code==="-"){$("<br>").appendTo(n);return}var e=$("<label>").addClass("form-radio").appendTo(n),o=$("<input>").data("data",t).attr("type",f.type).attr("name",f.field).attr("value",i).appendTo(e);if(u&&i===u&&o.attr("checked",!0),f.onClick)o.on("click",function(){f.onClick($(this).val())});$("<span>").html(r).appendTo(e)}var t;this.option=n;this.render=function(r){t=r;i(r,n,n.code)};this.getData=function(){var n=[];return t.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(r,u){i(t,n,r,u)};this.getValue=function(){return t.find('input[name="'+n.field+'"]:checked').val()||""};this.setValue=function(i){for(var u=t.find('input[name="'+n.field+'"]'),r=0;r<u.length;r++)u[r].checked=u[r].value===i};this.setReadonly=function(n){t.find("input").attr("disabled",n)}}function b(n){function r(n,t,i,r){var f,o;if(t.label||n.html(""),f=Utils.getCodes(i),f&&f.length)for(o=0;o<f.length;o++){var e=f[o],s=e.Code===""?"":e.Code||e,h=e.Name||s;u(n,e,s,h,r||t.value,t)}}function u(n,t,i,r,u,f){if(t.Code==="-"){$("<br>").appendTo(n);return}var e=$("<label>").addClass("form-radio").appendTo(n),o=$("<input>").data("data",t).attr("type",f.type).attr("name",f.field).attr("value",i).appendTo(e);if(u&&i===u&&o.attr("checked",!0),f.onClick)o.on("click",function(){f.onClick($(this).val())});$("<span>").html(r).appendTo(e)}var i,t;this.option=n;this.render=function(u){t=u;var f=n.code;f==="Enabled"?f=[{Code:1,Name:Language.Enable}]:n.label&&(f=[{Code:1,Name:f==="Enabled"?Language.Enable:n.title}]);f?r(u,n,f):(i=$("<input>").attr("type","checkbox").attr("name",n.field).attr("value","1").appendTo(u),(n.value===1||n.value==="1")&&(i[0].checked=!0))};this.getData=function(){var n=[];return t.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(i,u){r(t,n,i,u)};this.getValue=function(){var r=n.field,u=t.find('input[name="'+r+'"]'),i;return u.length===1?u[0].checked?1:0:(i=[],t.find('input[name="'+r+'"]:checked').each(function(n,t){i.push($(t).val())}),i.join(","))};this.setValue=function(i){for(var f,u=t.find('input[name="'+n.field+'"]'),r=0;r<u.length;r++)f=u[r].value,u[r].checked=i===1||i===!0||i&&i.indexOf(f)>-1};this.setReadonly=function(n){t.find("input").attr("disabled",n)}}function k(n){function i(n,t,i,r){var e,o,h,f;if(t.label||n.html(""),e=Utils.getCodes(i),e&&e.length){for(o=[],h="",h=t.emptyText!==undefined?t.emptyText:t.isQuery?Language.All:Language.PleaseSelect,h!==""&&o.push({Code:"",Name:h}),f=0;f<e.length;f++)o.push(e[f]);for(f=0;f<o.length;f++){var s=o[f],c=s.Code===""?"":s.Code||s,l=s.Name||c;u(n,s,c,l,r||t.value)}}}function u(n,t,i,r,u){var f=$("<option>").data("data",t).attr("value",i).html(r).appendTo(n);u&&i===u&&f.attr("selected",!0)}var t,r=this;this.elem;this.option=n;this.render=function(u){t=$("<select>").appendTo(u);r.elem=t;i(t,n,n.code)};this.getData=function(){return t.find(":selected").data("data")};this.setData=function(r,u){i(t,n,r,u)};this.getValue=function(){return t.val()};this.setValue=function(n){t.val(n)};this.setReadonly=function(n){t.attr("disabled",n)}}function d(n){var t,i,r=this;this.elem;this.option=n;this.render=function(n){i=n;var u=$("<div>").addClass("query-date").appendTo(n);t=$("<input>").attr("type","text").attr("autocomplete","off").appendTo(u);$("<span>").addClass("icon fa fa-calendar").appendTo(u).on("click",function(){t.focus()});r.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(n){var i=t.attr("placeholder");i&&(n instanceof Date?n=n.format(i):isNaN(n)&&!isNaN(Date.parse(n))&&(n=new Date(n).format(i)));t.val(n)};this.setReadonly=function(n){n?i.find(".icon").hide():i.find(".icon").show();t.attr("disabled",n)}}function g(n){var t,i,r=this;this.elem;this.option=n;this.render=function(u){i=u;t=$("<input>").attr("id",n.field).attr("type","file").attr("autocomplete","off").attr("accept",n.fileExt||".png,.jpg,.pdf,.doc,.docx.xls,.xlsx,.ppt,.pptx").appendTo(u);n.multiple&&t.attr("multiple","multiple");r.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(r){var u,f;t.val("");u=i.find(".file");u.length&&u.html("");f=n.form.data[n.idField];f!==null&&f!==""&&f!==undefined&&(u.length||(u=$("<span>").addClass("file inline").appendTo(i)),$("<span>").addClass("link").data("id",f).html(r).on("click",function(){BizFile.download($(this).data("id"))}).appendTo(u))};this.setReadonly=function(n){t.attr("disabled",n)}}function nt(t){var r,u,f=this;this.elem;this.option=t;this.render=function(n){n.css({position:"relative"});r=$("<input>").attr("type","hidden").appendTo(n);f.elem=r;u=new Picker(r,i)};this.getData=function(){return u.getData()};this.setData=function(){};this.getValue=function(){return r.val()};this.setValue=function(n){u.setValue(n)};this.setReadonly=function(t){t?n.find(".icon").hide():n.find(".icon").show();r.attr("disabled",t)}}function tt(n){function e(){var n,r;window.wangEditor||Utils.addJs("/libs/wangEditor.min.js");i.hide();n="editor"+o;i.before('<div id="'+n+'" class="editor">');u=new window.wangEditor("#"+n);u.config.onchange=function(n){i.val(n)};OssClient.config.accessKeyId?(r=new OssClient,u.config.customUploadImg=function(n,i){var e=t.form.OssUrl.getValue(),f=t.form.OssPath.getValue(),u;if(!e&&!f){Layer.tips("OSSPath"+Language.NotEmpty+"！");return}u=n[0];f+="/"+u.lastModified+u.name;r.put(f,u,function(n){i(e+n.name)})}):u.config.uploadImgServer=baseUrl+"/System/Upload";setTimeout(function(){u.create()},10)}var i,r,u,f=this;this.elem;this.option=n;this.render=function(n){r=n;i=$("<textarea>").appendTo(n);f.elem=i;e()};this.getData=function(){};this.setData=function(){};this.getValue=function(){return i.val()};this.setValue=function(n){i.val(n);u&&u.txt.html(n)};this.setReadonly=function(n){n?(r.find(".editor").addClass("readonly-editor"),r.find(".w-e-text-container").css("border-top","1px solid #c9d8db"),r.find(".w-e-text").attr("contenteditable",!1)):(r.find(".editor").removeClass("readonly-editor"),r.find(".w-e-text-container").css("border-top","none"),r.find(".w-e-text").attr("contenteditable",!0))}}function it(n){var t,i=this;this.elem;this.option=n;this.render=function(n){t=$("<textarea>").appendTo(n);i.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(n){t.val(n)};this.setReadonly=function(n){t.attr("disabled",n)}}function rt(n){var t,i=this;this.elem;this.option=n;this.render=function(r){t=$("<input>").attr("type",n.type).attr("autocomplete","off").appendTo(r);i.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return!t||!t.length?"":t.val()};this.setValue=function(n){t&&t.length&&t.val(n)};this.setReadonly=function(n){t&&t.length&&t.attr("disabled",n)}}var e=n,i=t||{},f=i.type==="component",l=i.readonly===undefined?!1:t.readonly,o=i.field,r,u,s=this;t&&t.type?a():y();this.option=i;this.elem=u;this.readonly=l;this.name=o;this.type=i.type;this.value="";this.data={};this.validate=function(){if(s.clearError(),!i.required)return!0;if(f)return i.component.validate();var n=$.trim(s.getValue());return n===""?(e.addClass("error"),!1):!0};this.clearError=function(){if(f){i.component.clearError();return}e.removeClass("error")};this.getValue=function(){return f?i.component.getData():r.getValue()};this.setValue=function(n,t){s.value=n;f?i.component.setData(n,t):r.setValue(n,t)};this.setReadonly=function(n){f?i.component.setReadonly(n):r.setReadonly(n)};this.setVisible=function(n){n?e.parent().show():e.parent().hide()};this.setUrl=function(n,t){$.get(n,function(n){s.setData(n);t&&t(n)})};this.getData=function(){return f?i.component.getData():r.getData()};this.setData=function(n,t){f?i.component.setData(n,t):r.setData(n,t)};this.change=function(n){c(n)};this.setUnit=function(t,i){var r=n.find(".form-unit").html(t);i&&r.css(i)};this.setTips=function(t,i){var r=n.find(".form-tips").html(t);i&&r.css(i)}}function Picker(n,t){function l(){var n=r.pick||{},t,s;e=o;n.action&&(e=n.action+e,n=Picker.action[n.action]||{},$.extend(!0,n,r.pick));f=n.multiSelect||!1;t=$("<span>").addClass("icon fa fa-ellipsis-h").on("click",function(){a(n)});n.valueField===n.textField?(i.attr("type","text").attr("disabled",!0),t.insertAfter(i)):(s=new Input(i.parent(),{field:o+"Name",type:"text",readonly:!0}),u=s.elem,r.form&&r.form.setInput(s),u.attr("disabled",!0),t.insertAfter(u))}function a(n){n.type==="component"?v(n):n.type==="tree"?y(n):p(n)}function v(n){var t=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(t){n.component.render(t);n.onLoad&&n.onLoad({form:r.form,control:n.component,option:n})},buttons:[{text:Language.OK,handler:function(){b(t,n)}}]})}function y(n){var t,i=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(i){t=new Tree(e+"TreePick",{url:n.url});t.render().appendTo(i);n.onLoad&&n.onLoad({form:r.form,control:t,option:n})},buttons:[{text:Language.OK,handler:function(){var r=t.selectedNode;if(!r){Layer.tips(Language.PleaseSelect+Language.Node+"！");return}k(i,n,r)}}]})}function p(n){var t,i=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(u){n.showCheckBox=!0;n.multiSelect=f;f||(n.dblclick=function(t){h(i,n,[t.row])});var o=$.extend({},n,{width:null});t=new Grid(e+"Pick",o);t.render().appendTo(u);n.saveUrl?Utils.createButton({icon:"fa fa-plus",text:Language.Add,handler:function(){w(n,function(r){f?t.reload():h(i,n,[r])})}}).appendTo(t.query.elem):n.onAddClick&&Utils.createButton({icon:"fa fa-plus",text:Language.Add,handler:function(){n.onAddClick({control:t,option:n})}}).appendTo(t.query.elem);n.onLoad&&n.onLoad({form:r.form,control:t,option:n})},buttons:[{text:Language.OK,handler:function(){var r=t.getSelected();if(f){if(!r||r.length===0){Layer.tips(Language.PleaseSelectOneAtLeast);return}}else if(!r||r.length===0||r.length>1){Layer.tips(Language.PleaseSelectOne);return}h(i,n,r)}}]})}function w(n,t){var i=new Form(e+"Pick",{style:"form form-block",fields:n.columns,data:n.formData}),r=Layer.open({title:n.title+"【"+Language.New+"】",width:n.formWidth||600,height:n.formHeight||350,component:i,buttons:[{text:Language.OK,handler:function(){i.save(n.saveUrl,function(n){t&&t(n);r.close()})}}]})}function b(n,t){var i={form:r.form},u=t.component.getData();i.value=u[t.valueField];i.text=u[t.textField];i.data=u;c(n,t,i)}function k(n,t,i){var u={form:r.form};u.value=i.id;u.text=i.title;u.data=i.data;c(n,t,u)}function h(n,t,i){var u={form:r.form},s,h,e,o;if(f){for(s=[],h=[],e=0;e<i.length;e++)s.push(i[e][t.valueField]),h.push(i[e][t.textField]);u.value=s.join(",");u.text=h.join(",");u.data=i}else o=i[0],u.value=o[t.valueField],u.text=o[t.textField],u.data=o;c(n,t,u)}function c(n,t,r){i.data(s,r.data);i.val(r.value);u&&u.val(r.text);t.callback&&t.callback(r);n.close()}var i=typeof n=="string"?$('[name="'+n+'"]'):n,r=t||{},f=!1,e,o=r.field,u,s="data";l();this.name=o;this.validate=function(){var n=$.trim(this.getValue());return!i[0].disabled&&i[0].required&&n===""?!1:!0};this.getValue=function(){var n=i.data(s);return n&&n.value?n.value:i.val()};this.getData=function(){var n=i.data(s);return n&&n.data?n.data:null};this.setValue=function(n){n&&(i.val(n.value),u&&u.val(n.text))}}function Grid(n,t){function kt(n){dt("center red",n)}function dt(n,t){o.html("");var i=$("<tr>").appendTo(o);$("<td>").attr("colspan",v).addClass(n).html(t).appendTo(i)}function ci(n){var t=Utils.getCodes(n.code);Layer.open({width:300,height:200,showClose:!0,content:function(i){var f,u;for($("<h3>").css("padding","10px").html(n.title+Language.CodeOptionTip).appendTo(i),f=$("<div>").css("padding","0 10px 10px 10px").appendTo(i),u=0;u<t.length;u++){var r=t[u],o=r.Code===0?0:r.Code||r,e=o;r.Name&&(e+="-"+r.Name);$("<p>").html(e).appendTo(f)}}})}function gt(n){dt("center",Language.Loading+"......");$.ajax({type:t.url.indexOf("Get")>-1?"get":"post",url:t.url,data:n,cache:!1,"async":!0,success:function(n){$.isArray(n)?(i.total=n.length,ni(n)):(i.total=n.TotalCount,ki(n.TotalCount),ni(n.PageData),t.summary&&t.summary(n.Summary))},error:function(){kt(Language.ServerError)}})}function ni(n){t.setData?t.setData({grid:i,data:n}):i.setData(n)}function a(n){d===0||n<=0||n>d||(f.PageIndex=n,i.reload(null,0))}function ti(n,t){t=t||"";t==="center"?n.addClass("center"):t==="right"&&n.addClass("text-right")}function li(n){if(n.action){var r=$("<span>").addClass("link").data("action",n.action);n.icon?r.addClass(n.icon):r.html(n.title);r.on("click",function(){var n=$(this).data("action");ft[n]&&ft[n].call(this,{grid:i,form:t.form})});return r}return n.title}function ii(n,r,u,f){var l=$("<tr>").appendTo(o),p,w,v,s,c,y,a,k;for(n&&(r+1)%2==0&&l.addClass("alter"),p=$("<span>"),rt&&(c=$("<td>").addClass("center").append(r+1).appendTo(l),e&&c.append(p)),et&&!ot&&ai(l,u),lt.length>0&&!t.isTradition&&!ot&&(c=$("<td>").addClass("center btns").data(b,u).appendTo(l),tr(c)),w=new Form("Row"+r,{grid:i}),h.push(w),v=0;v<g.length;v++)(s=$.extend({rowId:r},g[v],!0),s.action&&f)||(e||s.type!=="hidden")&&(c=s.type==="hidden"?p:$("<td>").appendTo(l),s.action&&c.addClass("action"),ti(c,s.align),s.field&&s.field.indexOf(".")>-1&&(y=s.field.split("."),$.isPlainObject(u[y[0]])||(u[y[0]]=JSON.parse(u[y[0]]||"{}"))),s.format?(a=s.format,typeof a=="string"&&a==="detail"&&(a=vi),k=a(u,{index:r,tr:l,td:c,column:s,row:u,grid:i,form:t.form}),c.append(k)):s.field&&wi(c,w,s,u,f),et&&yi(c),s.aFormat&&pi({index:r,tr:l,td:c,row:u,column:s}))}function ai(n,t){var i=$("<td>").addClass("center checkbox").appendTo(n),r=nt?$("<input>").attr("type","checkbox"):$("<input>").attr("type","radio").attr("name","gridCheck");r.data(b,t).on("change",function(){$(this).is(":checked")?pt($(this),!0):pt($(this),!1)}).appendTo(i)}function vi(n,i){return $("<span>").addClass("link").html(n[i.column.field]).data("data",n).on("click",function(){var n=$(this).data("data");i.form&&(i.form.show(n,!0),t.formUrl&&i.form.load(t.formUrl+"?id="+n.Id,!0))})}function yi(n){var i=nt?":checkbox":":radio";n.on("click",function(){yt(!1);var n=$(this).parent(),t=n.find(i);t[0].checked=!t.is(":checked");t[0].checked?n.addClass("selected"):n.removeClass("selected")});if(t.dblclick)n.on("dblclick",function(){var n=$(this).parent(),r=n.find(i),u=r.data(b);t.dblclick({row:u})})}function pi(n){var e={remove:function(){return $("<span>").addClass("link red fa fa-trash-o").css({marginLeft:"5px"}).attr("action","remove").attr("title",Language.Delete)},up:function(){return $("<span>").addClass("link fa fa-arrow-up").css({marginLeft:"5px"}).attr("action","up").attr("title",Language.MoveUp)},down:function(){return $("<span>").addClass("link fa fa-arrow-down").css({marginLeft:"5px"}).attr("action","down").attr("title",Language.MoveDown)}},u=n.column.aFormat,f,r;if(typeof u=="string")for(f=u.split(","),r=0;r<f.length;r++)e[f[r]]().appendTo(n.td);else u(n);n.tr.find("[action]").on("click",function(){ri();var n=$(this).attr("action"),u=$(this).parentsUntil("tbody").last(),r=o.find("tr").index(u),f=i.data[r];ft[n]&&ft[n].call(this,{grid:i,form:t.form,row:f,index:r})})}function ri(){if(e)for(var n=0;n<h.length;n++)i.data[n]=h[n].getData()}function wi(n,t,i,r,u){var f,h,s,c,o,l;if(i.field.indexOf(".")>-1?(h=i.field.split("."),f=r[h[0]][h[1]]):f=r[i.field],e&&i.type&&!u){f=f||"";i.type==="picker"?(o=r[i.field+"Name"]||"",i.textField&&(o=r[i.textField]||""),i.value={value:f,text:o}):i.value=f;i.form=t;s=new Input(n,i);t.setInput(s);ct.push(s);i.unitField&&s.setUnit(r[i.unitField]||"");return}if(f!==null&&f!==undefined&&f!==""&&i.type!=="hidden")if(i.type==="file")$("<span>").addClass("link").data("id",r[i.idField]).html(Language.Attachment).appendTo(n).on("click",function(){BizFile.download($(this).data("id"))});else i.type==="picker"?(o=f,c=r[i.field+"Name"],c?o=c:i.textField&&(o=r[i.textField]||""),n.html(o)):(o=f,i.placeholder?f instanceof Date?o=f.format(i.placeholder):isNaN(f)&&!isNaN(Date.parse(f))&&(o=new Date(f).format(i.placeholder)):i.code?"YesNo,HasNot,Enabled".indexOf(i.code)>-1?((f==="1"||f==="0")&&(f=parseInt(f)),o=vt(i.code,f),l=f===1?"success":"gray",o='<span class="badge '+l+'">'+o+"<\/span>"):o=vt(i.code,f):o=f||f===0?f:"",i.unit&&(o=o+i.unit),i.unitField&&(o=o+(r[i.unitField]||"")),n.html(o))}function vt(n,t){return(t||t===0)?Utils.getCodeName(n,t):""}function bi(){var n=$("<th>").addClass("check").appendTo(l);if(nt)$("<input>").attr("type","checkbox").appendTo(n).on("change",function(){$(this).is(":checked")?yt(!0):yt(!1)})}function yt(n){var t=nt?":checkbox":":radio";r.find("tbody "+t).each(function(){pt($(this),n)});!n&&nt&&(r.find(".check "+t)[0].checked=!1)}function pt(n,t){n[0].checked=t;t?n.parent().parent().addClass("selected"):n.parent().parent().removeClass("selected")}function ui(n,t,i){var u,s,f,e,o;k=!0;r.find("tbody tr").removeClass("selected");u=r.find("tbody tr:eq("+t+")").addClass("selected");i?(s=n[t],$.post(i,{id:s.Id,direct:"up"},function(){ui(n,t)})):(h.splice(t-1,0,h[t]),h.splice(t+1,1),n.splice(t-1,0,n[t]),n.splice(t+1,1),f=u.prev(),u.insertBefore(f),rt&&(e=f.find("td:first"),e.html(parseInt(e.html())+1),o=u.find("td:first"),o.html(parseInt(o.html())-1)),k=!1)}function fi(n,t,i){var u,s,f,e,o;k=!0;r.find("tbody tr").removeClass("selected");u=r.find("tbody tr:eq("+t+")").addClass("selected");i?(s=n[t],$.post(i,{id:s.Id,direct:"up"},function(){fi(n,t)})):(h.splice(t+2,0,h[t]),h.splice(t,1),n.splice(t+2,0,n[t]),n.splice(t,1),f=u.next(),f&&u.insertAfter(f),rt&&(e=u.find("td:first"),e.html(parseInt(e.html())+1),o=f.find("td:first"),o.html(parseInt(o.html())-1)),k=!1)}function ki(n){u.length&&(d=Math.ceil(n/f.PageSize),u.find(".pi").val(f.PageIndex),u.find(".pc").html(d),u.find(".pt").html(n))}function wt(){w&&setTimeout(function(){var n=0;t.isTradition?(i.toolbar&&(n+=i.toolbar.elem[0].clientHeight),i.query&&(n+=i.query.elem[0].clientHeight)):i.toolbar?n+=i.toolbar.elem[0].clientHeight:i.query&&(n+=i.query.elem[0].clientHeight);n===0&&(n=5);s.css({top:n+"px"})},100)}function ei(){if(ot=!1,t.width&&r.css({width:t.width}),l=r.find("thead tr"),!l.length){var n=$("<thead>").appendTo(r);l=$("<tr>").appendTo(n)}o=r.find("tbody");o.length||(o=$("<tbody>").appendTo(r));u=r.parent().find(".page");st&&!u.length&&di();w&&s.addClass("grid-fixed");gi();t.columns&&i.setColumns(t.columns);nr();ir();wt();t.url&&si&&i.reload(t.where)}function di(){function t(n,t,r){$("<i>").addClass(n).attr("title",t).appendTo(i).on("click",r)}var i,n,r,e;u=$("<div>").addClass("pager");i=$("<span>").addClass("pn").appendTo(u);t("fa fa-refresh",Language.Refresh,function(){a(f.PageIndex)});t("fa fa-step-backward",Language.First,function(){a(1)});t("fa fa-caret-left",Language.Previous,function(){a(f.PageIndex-1)});t("fa fa-caret-right",Language.Next,function(){a(f.PageIndex+1)});t("fa fa-step-forward",Language.Last,function(){a(d)});n=$("<span>").addClass("pm").appendTo(u);n.append(Language.PagerNavTo);$("<input>").attr("type","text").addClass("pi").appendTo(n).on("change",function(){a($(this).val())});n.append("/");$("<span>").addClass("pc").appendTo(n);n.append(Language.PagerPerPage);r=$("<select>").addClass("ps").appendTo(n).on("change",function(){f.PageSize=$(this).val();a(1)});$(hi).each(function(n,t){$("<option>").attr("value",t).html(t).appendTo(r)});e=Utils.format(Language.PagerTotal,'<span class="pt"><\/span>');n.append(e);s.after(u);w&&(u.addClass("pager-fixed"),setTimeout(function(){s.css({bottom:u.outerHeight()+"px"})},100))}function gi(){if(t.footer){var n=$("<div>").addClass("grid-footer").append(t.footer).appendTo(s.parent());w&&(n.addClass("grid-footer-fixed"),setTimeout(function(){var t=n.outerHeight();u.length&&(u.css({bottom:t+"px"}),t+=u.outerHeight());s.css({bottom:t+"px"})},100))}}function nr(){if(y.length){var n={buttons:y,toolbar:t.toolbar,toolbarTips:t.toolbarTips,isTradition:t.isTradition,gridParameter:function(){var n=i.getSelected();return new GridManager(i,t.form,n)}};p.length&&t.isTradition&&(n.query=function(){i.query.elem.hasClass("hide")?i.query.elem.removeClass("hide").css({paddingTop:0}):i.query.elem.addClass("hide").css({paddingTop:"5px"});wt()});i.toolbar=new Toolbar(n);s.before(i.toolbar.render())}}function tr(n){var r={buttons:lt,toolbar:t.toolbar,isGridCell:!0,onlyIcon:t.isIconButton,gridParameter:function(){var r=[n.data(b)];return new GridManager(i,t.form,r)}},u=new Toolbar(r);u.render(n)}function ir(){if(p.length){i.query=new Query({id:oi,grid:i,querys:p,isTradition:t.isTradition,onSearch:t.onSearch});y.length&&t.isTradition&&i.query.elem.addClass("hide");var n=i.columns.filter(function(n){return n.export});!y.length&&(t.showBtnExport||n.length>0)&&Utils.createButton({icon:"fa fa-sign-out",text:Language.Export,handler:function(){var n=new GridManager(i,t.form);n.export()}}).appendTo(i.query.elem);s.before(i.query.elem)}}var it="grid"+n,oi=it+"Query",p=[],r=$("#"+it),rt=t.index===undefined?!0:t.index,w=t.fixed===undefined?!0:t.fixed,e=t.edit,ut=t.import,si=t.autoQuery===undefined?t.url?!0:!1:t.autoQuery,st=t.page===undefined?t.url?!0:!1:t.page,hi=[10,20,50,100,500,1e3],ft=$.extend({add:function(n){n.grid.addRow(t.row||{})},remove:function(n){n.grid.removeRow(n.index)},up:function(n){n.grid.moveRow(n.index,"up",t.moveRowUrl)},down:function(n){n.grid.moveRow(n.index,"down",t.moveRowUrl)}},t.action||{}),b="row",i=this,k=!1,ht,s=r.parent(),f={},d=0,v=0,g=[],h=[],ct=[],l,o,u,y=t.toolButtons||[],lt=y.filter(function(n){return n==="edit"||n==="remove"||n.target&&n.target.indexOf("grid")>=0}),et=t.showCheckBox||!ut&&y.length>0,nt=t.multiSelect===undefined?!0:t.multiSelect,ot=!1,c={},at,bt,tt;if(t.sortField)for(at=t.sortField.split(","),bt=t.sortOrder.split(","),tt=0;tt<at.length;tt++)c[at[tt]]=bt[tt];e&&t.fixed===undefined&&(w=!1);(e||ut)&&(st=!1,et=!1);st&&(f.PageIndex=1,f.PageSize=10);this.elem=r;this.option=t;this.name=n;this.columns=[];this.data=[];this.toolbar=null;this.query=null;this.where=t.where||{};this.total=0;this.render=function(){return it="grid"+n,_gridTop=0,ht=$("<div>").addClass("grid-view"),s=$("<div>").addClass("grid").appendTo(ht),r=$("<table>").attr("id",it).appendTo(s),ei(),ht};this.setDetail=function(n){ot=n;i.toolbar&&(n?i.toolbar.elem.hide():i.toolbar.elem.show());i.query&&(n?i.query.elem.removeClass("hide").css({paddingTop:"5px"}):t.isTradition&&i.query.elem.addClass("hide"));var u="th.check,th.action,th.tb-head";n?r.find(u).hide():r.find(u).show();wt()};this.setReadonly=function(n){this.setDetail(n)};this.setIsEdit=function(n){e=n};this.setColumns=function(n){var s,o,u,h,f;for(g=[],n=n||[],s=DateTimeFormat,t.showModifyBy&&(n.push({title:Language.ModifyBy,field:"ModifyBy"}),n.push({title:Language.ModifyTime,field:"ModifyTime",placeholder:s})),t.showCreateBy&&(n.push({title:Language.CreateBy,field:"CreateBy"}),n.push({title:Language.CreateTime,field:"CreateTime",placeholder:s})),this.columns=n,v=0,l.html(""),rt&&(v+=1,$("<th>").addClass("index").appendTo(l)),et&&(v+=1,bi()),lt.length>0&&!t.isTradition&&(v+=1,$("<th>").addClass("center tb-head").css("width","80px").html(Language.Operate).appendTo(l)),p=t.querys||[],o=0;o<n.length;o++){if(u=n[o],!u.query||e||ut||p.push($.extend({prefixType:"LG"},u)),u.type==="hidden"){g.push(u);continue}if((u.hideColumn===undefined||!u.hideColumn)&&(u.visible===undefined||u.visible)){if(h=li(u),f=$("<th>").append(h).appendTo(l),u.action&&f.addClass("action"),u.width&&f.css({width:u.width}),u.field&&f.attr("field",u.field),ti(f,u.align),ut){if(u.required&&f.addClass("red"),u.code)f.append(" *").css({cursor:"pointer"}).data("column",u).on("click",function(){var n=$(this).data("column");ci(n)})}else{if(u.sort||c[u.field]){f.addClass("sorting").append('<i class="fa fa-caret-down">').append('<i class="fa fa-caret-up">');f.on("click",function(){var t=$(this),n=t.attr("field");c[n]=c[n]==="asc"?"desc":"asc";r.find("th").removeClass("asc desc");t.addClass(c[n]);i.reload()})}f.removeClass("asc desc");c[u.field]&&f.addClass(c[u.field])}g.push(u);v+=1}}};this.setData=function(n,t){this.data=n||[];o.html("");this.data.length||e?$(this.data).each(function(n,i){ii(!e,n,i,t)}):kt(Language.NoDataFound)};this.reload=function(n,r){var o=i.query?i.query.getData():{},u,e;if($.extend(this.where,n||{},o),t.querys)gt(this.where);else{f.IsLoad=r===0?0:1;f.Query=JSON.stringify(this.where);u=[];for(e in c)u.push(e+" "+c[e]);f.OrderBys=u;gt(f)}};this.getSelected=function(){var n=[];return r.find("tbody .checkbox :checked").each(function(){var i=$(this).parent().parent(),r=o.find("tr").index(i),t=$(this).data(b);t.index=r;n.push(t)}),n};this.addRow=function(n){ii(!1,this.data.length,n,!1);this.data.push(n)};this.removeRow=function(n){o.find("tr:eq("+n+")").remove();this.data.splice(n,1)};this.moveRow=function(n,t,i){if(!k)if(t==="up"){if(n===0){Layer.tips(Language.CanNotMoveUp);return}ui(this.data,n,i)}else if(t==="down"){if(n>=this.data.length-1){Layer.tips(Language.CanNotMoveDown);return}fi(this.data,n,i)}};this.getData=function(){return ri(),i.data};this.getValue=function(n,t){var i=n[t.field];if(i===null)return"";if(t.valueFormat)return t.valueFormat({value:i,row:n,column:t});if(t.placeholder){if(i instanceof Date)return i;if(isNaN(i)&&!isNaN(Date.parse(i)))return new Date(i)}else return t.code?vt(t.code,i):i||i===0?i:""};this.clearError=function(){e&&o.find("td").removeClass("error")};this.validate=function(){for(var t,i=[],n=0;n<ct.length;n++)t=ct[n],t.validate()||i.push(t);return i.length===0};r.length&&ei()}function GridManager(n,t,i){function e(){GridManager.isLoadXlsx||(Utils.addJs("/libs/xlsx.core.min.js"),GridManager.isLoadXlsx=!0)}function o(n,t,i){var r=n.rows.length,f=r>1?Utils.format(Language.SelectRecord,r):Language.TheRecord,e=Utils.format(Language.ConfirmDeleteTips,f);Layer.confirm(e,function(){u(n,t,{data:JSON.stringify(n.ids)},i)})}function u(n,t,i,r){Ajax.post(t,i,function(){r?r(n):n.grid.reload()})}function s(n,t){var i,r;return t=t||"Sheet1",i={SheetNames:[t],Sheets:{}},i.Sheets[t]=n,r={bookType:"xlsx",bookSST:!1,type:"binary"},XLSX.write(i,r)}var r=t?t.title:"",f;r||(f=getCurTab(),r=f?f.title:"");this.grid=n;this.rows=i;this.row=i&&i.length?i[0]:null;this.selectRow=function(r){if(!i||i.length===0||i.length>1){Layer.tips(Language.PleaseSelectOne);return}var u=i[0];r&&r({grid:n,form:t,rows:i,row:u,index:u.index,ids:[u.Id]})};this.selectRows=function(r){if(!i||i.length===0){Layer.tips(Language.PleaseSelectOneAtLeast);return}var u=i.map(function(n){return n.Id});r&&r({grid:n,form:t,rows:i,ids:u})};this.addRow=function(n){t.show(n)};this.editRow=function(i){this.selectRow(function(r){(!i||i(r))&&(t.show(r.row),n.option.formUrl&&t.load(n.option.formUrl+"?id="+r.row.Id))})};this.deleteRow=function(n,t){this.selectRow(function(i){o(i,n,t)})};this.deleteRows=function(n,t){this.selectRows(function(i){o(i,n,t)})};this.operateRow=function(n,t,i){this.selectRow(function(r){var f={id:r.row.Id},e=t?Utils.format(Language.ConfirmRecord,t):"";e?Layer.confirm(e,function(){u(r,n,f,i)}):u(r,n,f,i)})};this.operateRows=function(n,t,i){this.selectRows(function(r){var f={data:JSON.stringify(r.ids)},e=t?Utils.format(Language.ConfirmRecord,t):"";e?Layer.confirm(e,function(){u(r,n,f,i)}):u(r,n,f,i)})};this.moveRow=function(n,t){this.selectRow(function(i){i.grid.moveRow(i.index,n,t)})};this.import=function(i,u){e();var f,o=n.columns.slice().filter(function(n){return n.import});Layer.open({title:r+"【"+Language.Import+"】",width:1024,height:450,content:function(n){var t=$("<div>").addClass("import-tips").appendTo(n);t.append(Language.ImportTips);$("<div>").addClass("import-body").append('<div class="grid"><table id="gridImport"><\/table><\/div>').appendTo(n)},success:function(){var n=[{title:Language.ValidInfo,field:"Error",format:function(n,t){return n.Error&&n.Error.length?(t.tr.css({color:"#f00"}),'<span class="red">'+n.Error+"<\/span>"):""}}].concat(o);f=new Grid("Import",{"import":!0,columns:n});Utils.paste(!0,function(n){var h=[],u=n.split("\n"),r,e,s,i;if(u.length>1e3){Layer.tips(Language.ImportMaxLength);return}for(r=0;r<u.length;r++)if(u[r].length){for(e=$.extend({},t.data),s=u[r].replace("\r","").split("\t"),i=0;i<o.length;i++)s.length>i&&(e[o[i].field]=s[i]);h.push(e)}f.setData(h)})},buttons:[{text:Language.ImportRule,handler:function(){for(var u,t=[],i=[],n=0;n<o.length;n++)i.push(o[n].title);t.push(i);u=XLSX.utils.aoa_to_sheet(t);Utils.genFile(s(u),r+Language.ImportRule+".xlsx")}},{text:Language.Import,handler:function(t){var r=f.getData(),e,o;if(!r.length){Layer.tips(Language.PleasePasteImport);return}if(!f.validate()){Layer.tips(Language.DataNotValidPleaseCheck);return}e=Layer.loading(Language.Importing+"......");o=$.extend({},u,{data:JSON.stringify(r)});$.post(i,o,function(i){var u,o,r;if(e.close(),i.IsValid)Layer.tips(i.Message),t.close(),Utils.paste(!1),n.reload();else if(Layer.alert(i.Message),u=i.data,u&&u.length){for(o=f.data,r=0;r<o.length;r++)o[r].Error=u[r];f.setData(o)}})}}]})};this.export=function(t){var o,i,l,f,a,v;e();var h=[],c=[],u=n.columns;for(i=0;i<u.length;i++)u[i].export&&c.push(u[i].title);if(c.length===0){Layer.tips(Language.NotExportColumn);return}if(o=n.getData(),o.length===0){Layer.tips(Language.NotExportData);return}for(h.push(c),i=0;i<o.length;i++){for(l=[],f=0;f<u.length;f++)u[f].export&&(a=n.getValue(o[i],u[f]),l.push(a));h.push(l)}v=XLSX.utils.aoa_to_sheet(h);Utils.genFile(s(v),(t||r)+".xlsx")}}function Card(n){function f(){i=$("<div>").addClass("card");r=$("<div>").addClass("card-header").appendTo(i);t.icon&&$("<span>").addClass(t.icon).appendTo(r);t.title&&$("<span>").html(t.title).appendTo(r);t.tool&&$("<span>").addClass("tool").html(t.tool).appendTo(r);u=$("<div>").addClass("card-body").appendTo(i);t.style&&i.css(t.style);t.body&&Utils.parseDom(u,t.body,u);t.callback&&t.callback({header:r,body:u})}var t=n||{},i,r,u;this.option=t;this.render=function(){return f(),i}}function IconCard(n){function u(){var n,u;if(i=$("<div>").attr("id",t.id).addClass("small-box").css("width",t.width),t.onClick)i.css("cursor","pointer").on("click",t.onClick);else if(t.targetPage)i.css("cursor","pointer").on("click",function(){$.isPlainObject(t.targetPage)?showTabPage(t.targetPage):showTabPageByCode(t.targetPage)});n=$("<div>").addClass("inner").appendTo(i);r=$("<h3>").html(t.value||"0").appendTo(n);$("<p>").html(t.name).appendTo(n);u=$("<div>").addClass("icon").appendTo(n);$("<i>").addClass(t.icon).appendTo(u);t.style&&n.css(t.style)}var t=n||{},i,r;this.option=t;this.render=function(){return u(),i};this.setValue=function(n){r.html(n)}}function Chart(n){Chart.isLoad||(Utils.addJs("/libs/echarts.min.js"),Chart.isLoad=!0);var t=echarts.init(document.getElementById(n));this.clear=function(){t.clear()};this.setOption=function(n){t.setOption(n)};this.setLine=function(n){t.setOption(n)};this.setPie=function(n){t.setOption(n)}}function Error(n){function i(n){var i=t.title,r=t.content;t.title||(i=Language.Error500Title,r=Language.Error500Content,t.type==="403"?(i=Language.Error403Title,r=Language.Error403Content):t.type==="404"&&(i=Language.Error404Title,r=Language.Error404Content));$("<h1>").html(t.type).appendTo(n);$("<h3>").html(i).appendTo(n);$("<div>").html(r).appendTo(n)}var t=n||{};this.render=function(n){var t=$("<div>").addClass("error-box").appendTo(n);return i(t),t}}function FlowArrow(n,t,i,r){this.x1=n;this.y1=t;this.x2=i;this.y2=r;this.tmpX1=null;this.tmpY1=null;this.tmpX2=null;this.tmpY2=null;this.color="black";this.setColor=function(n){this.color=n};this.setP=function(n,t,i,r){this.x1=n;this.y1=t;this.x2=i;this.y2=r};this.setP1=function(n,t){this.tmpX1=n;this.tmpY1=t};this.setP2=function(n,t){this.tmpX2=n;this.tmpY2=t};this.drawBottomToTop=function(n,t){this.x1!=this.x2?(this.setP1(this.x1,(this.y1+this.y2)/2),this.setP2(this.x2,(this.y1+this.y2)/2),this.draw(n)):this.draw(n);t&&t.text&&n.fillText(t.text,this.x1+1,(this.y1+this.y2)/2)};this.drawBottomToRight=function(n,t){this.y1!=this.y2?(this.setP1(this.x1,this.y2),this.draw(n)):this.draw(n);t&&t.text&&n.fillText(t.text,this.x1+1,(this.y1+this.y2)/2)};this.drawLeftOrRightToTop=function(n,t){this.setP1(this.x2,this.y1);this.draw(n);t&&t.text&&n.fillText(t.text,this.x2+1,(this.y1+this.y2)/2)};this.drawLeftToRightOrRightToLeft=function(n,t){if(t=t||{},this.y1!=this.y2){var i=t.offsetX||0;this.setP1((this.x1+this.x2+i)/2,this.y1);this.setP2((this.x1+this.x2+i)/2,this.y2);this.draw(n);t.text&&n.fillText(t.text,(this.x1+this.x2+i)/2+1,(this.y1+this.y2)/2)}else this.draw(n),t.text&&n.fillText(t.text,(this.x1+this.x2)/2+1,(this.y1+this.y2)/2+15)};this.drawRightToLeftOrLeftToRight=function(n,t){if(t=t||{},this.y1!=this.y2){var i=t.offsetX||0;this.setP1((this.x1+this.x2+i)/2,this.y1);this.setP2((this.x1+this.x2+i)/2,this.y2);this.draw(n);t&&t.text&&n.fillText(t.text,(this.x1+this.x2+i)/2+1,(this.y1+this.y2)/2)}else this.draw(n),t.text&&n.fillText(t.text,(this.x1+this.x2)/2+1,(this.y1+this.y2)/2+15)};this.draw=function(n){var t;n.strokeStyle=this.color;n.fillStyle=this.color;n.beginPath();n.moveTo(this.x1,this.y1);this.tmpX1!=null&&this.tmpY1!=null&&this.tmpX2!=null&&this.tmpY2!=null?(n.lineTo(this.tmpX1,this.tmpY1),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX1,this.tmpY1),n.lineTo(this.tmpX2,this.tmpY2),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX2,this.tmpY2),n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.tmpY2)/(this.x2-this.tmpX2)),t+=(this.x2>=this.tmpX2?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t)):this.tmpX1!=null&&this.tmpY1!=null&&this.tmpX2==null&&this.tmpY2==null?(n.lineTo(this.tmpX1,this.tmpY1),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(this.tmpX1,this.tmpY1),n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.tmpY1)/(this.x2-this.tmpX1)),t+=(this.x2>=this.tmpX1?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t)):this.tmpX1==null&&this.tmpY1==null&&this.tmpX2==null&&this.tmpY2==null&&(n.lineTo(this.x2,this.y2),n.closePath(),n.stroke(),t=Math.atan((this.y2-this.y1)/(this.x2-this.x1)),t+=(this.x2>=this.x1?90:-90)*Math.PI/180,this.drawArrowhead(n,this.x2,this.y2,t))};this.drawArrowhead=function(n,t,i,r){n.save();n.beginPath();n.translate(t,i);n.rotate(r);n.moveTo(0,0);n.lineTo(5,10);n.lineTo(-5,10);n.closePath();n.restore();n.fill()}}function FlowStep(n,t,i){function r(t){if(typeof t=="string"){var i=n.steps.filter(function(n){return n.id===t});t=i.length>0?i[0]:null}return t}function e(n,t,i,r,u,f){var e=u/2;n.beginPath();n.moveTo(t+e,i);n.arcTo(t+r,i,t+r,i+u,e);n.arcTo(t+r,i+u,t,i+u,e);n.arcTo(t,i+u,t,i,e);n.arcTo(t,i,t+r,i,e);n.closePath();n.fillText(f,t+10,i+30);n.stroke()}function o(n,t,i,r,u){n.beginPath();n.moveTo(t,i+r);n.lineTo(t-r*2,i);n.lineTo(t,i-r);n.lineTo(t+r*2,i);n.closePath();n.fillText(u,t-r-8,i+5);n.stroke()}var u=i.x,f=i.y;this.id=i.id;this.name=i.name;this.item=i;this.flag=i.flag;this.chart=n;this.l=30;this.h=50;this.w=2*this.h;this.x=u;this.y=f;i.round?e(t,u-this.w/2,f-this.h/2,this.w,this.h,i.name):i.flag==="condition"?o(t,u,f,this.l,i.name):(t.strokeRect(u-this.w/2,f-this.h/2,this.w,this.h),t.fillText(i.name,u-this.w/2+10,f+5));this.contains=function(n,t){if(this.flag==="condition")return n>=this.x-this.l*2&&t>=this.y-this.l&&n<=this.x+this.l*2&&t<=this.y+this.l*2;var i=this.x-this.w/2,r=this.y-this.h/2;return n>=i&&t>=r&&n<=i+this.w&&t<=r+this.h};this.drawBottomToTop=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.h/2:this.l;n.flag=="step"?(u=new FlowArrow(this.x,this.y+f,n.x,n.y-n.h/2),u.drawBottomToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x,this.y+f,n.x,n.y-n.l),u.drawBottomToTop(t,i))};this.drawBottomToLeft=function(n,i){n=r(n);n.flag=="step"?(arrow=new Arrow(this.x,this.y+this.h/2,n.x-n.w/2,n.y),arrow.drawBottomToRight(t,i)):n.flag=="condition"&&(arrow=new Arrow(this.x,this.y+this.h/2,n.x-n.l*2-40,n.y),arrow.drawBottomToRight(t,i))};this.drawBottomToRight=function(n,i){n=r(n);n.flag=="step"?(arrow=new Arrow(this.x,this.y+this.h/2,n.x+n.w/2,n.y),arrow.drawBottomToRight(t,i)):n.flag=="condition"&&(arrow=new Arrow(this.x,this.y+this.h/2,n.x+n.l*2+40,n.y),arrow.drawBottomToRight(t,i))};this.drawLeftToTop=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x-this.w*2,this.y,n.x,n.y-n.h/2),u.drawLeftOrRightToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-this.l*2,this.y,n.x,n.y-n.l),u.drawLeftOrRightToTop(t,i))};this.drawLeftToLeft=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x-this.w*2,this.y,n.x+this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-this.l*2,this.y,n.x+this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawLeftToRight=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;i=i||{};i.offsetX=this.flag==="step"?0:100;n.flag=="step"?(u=new FlowArrow(this.x-f,this.y,n.x+this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x-f,this.y,n.x+this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawRightToTop=function(n,i){var u;n=r(n);n.flag=="step"?(u=new FlowArrow(this.x+this.w*2,this.y,n.x,n.y-n.h/2),u.drawLeftOrRightToTop(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+this.l*2,this.y,n.x,n.y-n.l),u.drawLeftOrRightToTop(t,i))};this.drawRightToLeft=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;n.flag=="step"?(u=new FlowArrow(this.x+f,this.y,n.x-this.w/2,n.y),u.drawLeftToRightOrRightToLeft(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+f,this.y,n.x-this.l*2,n.y),u.drawLeftToRightOrRightToLeft(t,i))};this.drawRightToRight=function(n,i){var f,u;n=r(n);f=this.flag==="step"?this.w/2:this.l*2;i=i||{};i.offsetX=50;n.flag=="step"?(u=new FlowArrow(this.x+f,this.y,n.x+this.w/2,n.y),u.drawRightToLeftOrLeftToRight(t,i)):n.flag=="condition"&&(u=new FlowArrow(this.x+f,this.y,n.x+this.l*2,n.y),u.drawRightToLeftOrLeftToRight(t,i))}}function FlowChart(n,t){var i=this;this.option=t;this.steps=[];this.render=function(r){var h=t.width||1200,c=t.height||800,l=t.font||"normal 14px YaHei",e,o,s,u,f;for($("<canvas>").att("id",n).att("width",h).att("height",c).appendTo(r),e=document.getElementById(n),o=e.getContext("2d"),o.font=l,u=0;u<t.items.length;u++)f=t.items[u],s=new FlowStep(i,o,f),i.steps.push(s);for(u=0;u<t.items.length;u++)f=t.items[u],f.arrow&&f.arrow({step:i.steps[u]});t.click&&(e.onclick=function(n){var r,u;n=n||window.event;var o=n.offsetX,s=n.offsetY,f="",e=null;for(r=0;r<i.steps.length;r++)if(u=i.steps[r],u.contains(o,s)){f=u.name;e=u;break}t.click({name:f,chart:i,step:e})})}}function IconPicker(){var n=["fa-glass","fa-th-large","fa-arrow-right","fa-arrow-up","fa-arrow-down","fa-mail-forward","fa-share","fa-expand","fa-compress","fa-plus","fa-minus","fa-asterisk","fa-th","fa-exclamation-circle","fa-gift","fa-leaf","fa-fire","fa-eye","fa-eye-slash","fa-warning","fa-exclamation-triangle","fa-plane","fa-calendar","fa-th-list","fa-random","fa-comment","fa-magnet","fa-chevron-up","fa-chevron-down","fa-retweet","fa-shopping-cart","fa-folder","fa-folder-open","fa-arrows-v","fa-check","fa-arrows-h","fa-bar-chart-o","fa-bar-chart","fa-twitter-square","fa-facebook-square","fa-camera-retro","fa-key","fa-gears","fa-cogs","fa-comments","fa-remove","fa-thumbs-o-up","fa-thumbs-o-down","fa-star-half","fa-heart-o","fa-sign-out","fa-linkedin-square","fa-thumb-tack","fa-external-link","fa-sign-in","fa-trophy","fa-close","fa-github-square","fa-upload","fa-lemon-o","fa-phone","fa-square-o","fa-bookmark-o","fa-phone-square","fa-twitter","fa-facebook","fa-github","fa-times","fa-unlock","fa-credit-card","fa-rss","fa-hdd-o","fa-bullhorn","fa-bell","fa-certificate","fa-hand-o-right","fa-hand-o-left","fa-hand-o-up","fa-search-plus","fa-hand-o-down","fa-arrow-circle-left","fa-arrow-circle-right","fa-arrow-circle-up","fa-arrow-circle-down","fa-globe","fa-wrench","fa-tasks","fa-filter","fa-briefcase","fa-search-minus","fa-arrows-alt","fa-group","fa-users","fa-chain","fa-link","fa-cloud","fa-flask","fa-cut","fa-scissors","fa-copy","fa-power-off","fa-files-o","fa-paperclip","fa-save","fa-floppy-o","fa-square","fa-navicon","fa-reorder","fa-bars","fa-list-ul","fa-list-ol","fa-music","fa-signal","fa-strikethrough","fa-underline","fa-table","fa-magic","fa-truck","fa-pinterest","fa-pinterest-square","fa-google-plus-square","fa-google-plus","fa-money","fa-gear","fa-caret-down","fa-caret-up","fa-caret-left","fa-caret-right","fa-columns","fa-unsorted","fa-sort","fa-sort-down","fa-sort-desc","fa-sort-up","fa-cog","fa-sort-asc","fa-envelope","fa-linkedin","fa-rotate-left","fa-undo","fa-legal","fa-gavel","fa-dashboard","fa-tachometer","fa-comment-o","fa-trash-o","fa-comments-o","fa-flash","fa-bolt","fa-sitemap","fa-umbrella","fa-paste","fa-clipboard","fa-lightbulb-o","fa-exchange","fa-cloud-download","fa-home","fa-cloud-upload","fa-user-md","fa-stethoscope","fa-suitcase","fa-bell-o","fa-coffee","fa-cutlery","fa-file-text-o","fa-building-o","fa-hospital-o","fa-file-o","fa-ambulance","fa-medkit","fa-fighter-jet","fa-beer","fa-h-square","fa-plus-square","fa-angle-double-left","fa-angle-double-right","fa-angle-double-up","fa-angle-double-down","fa-clock-o","fa-angle-left","fa-angle-right","fa-angle-up","fa-angle-down","fa-desktop","fa-laptop","fa-tablet","fa-mobile-phone","fa-mobile","fa-circle-o","fa-road","fa-quote-left","fa-quote-right","fa-spinner","fa-circle","fa-mail-reply","fa-reply","fa-github-alt","fa-folder-o","fa-folder-open-o","fa-smile-o","fa-download","fa-frown-o","fa-meh-o","fa-gamepad","fa-keyboard-o","fa-flag-o","fa-flag-checkered","fa-terminal","fa-code","fa-mail-reply-all","fa-reply-all","fa-arrow-circle-o-down","fa-star-half-empty","fa-star-half-full","fa-star-half-o","fa-location-arrow","fa-crop","fa-code-fork","fa-unlink","fa-chain-broken","fa-question","fa-info","fa-search","fa-arrow-circle-o-up","fa-exclamation","fa-superscript","fa-subscript","fa-eraser","fa-puzzle-piece","fa-microphone","fa-microphone-slash","fa-shield","fa-calendar-o","fa-fire-extinguisher","fa-inbox","fa-rocket","fa-maxcdn","fa-chevron-circle-left","fa-chevron-circle-right","fa-chevron-circle-up","fa-chevron-circle-down","fa-html5","fa-css3","fa-anchor","fa-unlock-alt","fa-play-circle-o","fa-bullseye","fa-ellipsis-h","fa-ellipsis-v","fa-rss-square","fa-play-circle","fa-ticket","fa-minus-square","fa-minus-square-o","fa-level-up","fa-level-down","fa-rotate-right","fa-check-square","fa-pencil-square","fa-external-link-square","fa-share-square","fa-compass","fa-toggle-down","fa-caret-square-o-down","fa-toggle-up","fa-caret-square-o-up","fa-toggle-right","fa-repeat","fa-caret-square-o-right","fa-euro","fa-eur","fa-gbp","fa-dollar","fa-usd","fa-rupee","fa-inr","fa-cny","fa-rmb","fa-refresh","fa-yen","fa-jpy","fa-ruble","fa-rouble","fa-rub","fa-won","fa-krw","fa-bitcoin","fa-btc","fa-file","fa-list-alt","fa-file-text","fa-sort-alpha-asc","fa-sort-alpha-desc","fa-sort-amount-asc","fa-sort-amount-desc","fa-sort-numeric-asc","fa-sort-numeric-desc","fa-thumbs-up","fa-thumbs-down","fa-youtube-square","fa-lock","fa-youtube","fa-xing","fa-xing-square","fa-youtube-play","fa-dropbox","fa-stack-overflow","fa-instagram","fa-flickr","fa-adn","fa-bitbucket","fa-flag","fa-bitbucket-square","fa-tumblr","fa-tumblr-square","fa-long-arrow-down","fa-long-arrow-up","fa-long-arrow-left","fa-long-arrow-right","fa-apple","fa-windows","fa-android","fa-headphones","fa-linux","fa-dribbble","fa-skype","fa-foursquare","fa-trello","fa-female","fa-male","fa-gittip","fa-sun-o","fa-moon-o","fa-envelope-o","fa-volume-off","fa-archive","fa-bug","fa-vk","fa-weibo","fa-renren","fa-pagelines","fa-stack-exchange","fa-arrow-circle-o-right","fa-arrow-circle-o-left","fa-toggle-left","fa-volume-down","fa-caret-square-o-left","fa-dot-circle-o","fa-wheelchair","fa-vimeo-square","fa-turkish-lira","fa-try","fa-plus-square-o","fa-space-shuttle","fa-slack","fa-envelope-square","fa-volume-up","fa-wordpress","fa-openid","fa-institution","fa-bank","fa-university","fa-mortar-board","fa-graduation-cap","fa-yahoo","fa-google","fa-reddit","fa-qrcode","fa-reddit-square","fa-stumbleupon-circle","fa-stumbleupon","fa-delicious","fa-digg","fa-pied-piper","fa-pied-piper-alt","fa-drupal","fa-joomla","fa-language","fa-barcode","fa-fax","fa-building","fa-child","fa-paw","fa-spoon","fa-cube","fa-cubes","fa-behance","fa-behance-square","fa-steam","fa-tag","fa-steam-square","fa-recycle","fa-automobile","fa-car","fa-cab","fa-taxi","fa-tree","fa-spotify","fa-deviantart","fa-soundcloud","fa-tags","fa-database","fa-file-pdf-o","fa-file-word-o","fa-file-excel-o","fa-file-powerpoint-o","fa-file-photo-o","fa-file-picture-o","fa-file-image-o","fa-file-zip-o","fa-file-archive-o","fa-book","fa-file-sound-o","fa-file-audio-o","fa-file-movie-o","fa-file-video-o","fa-file-code-o","fa-vine","fa-codepen","fa-jsfiddle","fa-life-bouy","fa-life-buoy","fa-bookmark","fa-life-saver","fa-support","fa-life-ring","fa-circle-o-notch","fa-ra","fa-rebel","fa-ge","fa-empire","fa-git-square","fa-git","fa-print","fa-hacker-news","fa-tencent-weibo","fa-qq","fa-wechat","fa-weixin","fa-send","fa-paper-plane","fa-send-o","fa-paper-plane-o","fa-history","fa-heart","fa-camera","fa-circle-thin","fa-header","fa-paragraph","fa-sliders","fa-share-alt","fa-arrow-left","fa-share-alt-square","fa-bomb","fa-soccer-ball-o","fa-futbol-o","fa-tty","fa-font","fa-binoculars","fa-plug","fa-slideshare","fa-twitch","fa-yelp","fa-newspaper-o","fa-wifi","fa-calculator","fa-paypal","fa-google-wallet","fa-bold","fa-cc-visa","fa-cc-mastercard","fa-cc-discover","fa-cc-amex","fa-cc-paypal","fa-cc-stripe","fa-bell-slash","fa-bell-slash-o","fa-trash","fa-copyright","fa-italic","fa-at","fa-eyedropper","fa-paint-brush","fa-birthday-cake","fa-area-chart","fa-pie-chart","fa-line-chart","fa-lastfm","fa-lastfm-square","fa-toggle-off","fa-text-height","fa-toggle-on","fa-bicycle","fa-bus","fa-ioxhost","fa-angellist","fa-cc","fa-shekel","fa-sheqel","fa-ils","fa-meanpath","fa-text-width","fa-align-left","fa-align-center","fa-align-right","fa-align-justify","fa-star","fa-list","fa-dedent","fa-outdent","fa-indent","fa-video-camera","fa-photo","fa-image","fa-picture-o","fa-pencil","fa-map-marker","fa-star-o","fa-adjust","fa-tint","fa-edit","fa-pencil-square-o","fa-share-square-o","fa-check-square-o","fa-arrows","fa-step-backward","fa-fast-backward","fa-backward","fa-user","fa-play","fa-pause","fa-stop","fa-forward","fa-fast-forward","fa-step-forward","fa-eject","fa-chevron-left","fa-chevron-right","fa-plus-circle","fa-film","fa-minus-circle","fa-times-circle","fa-check-circle","fa-question-circle","fa-info-circle","fa-crosshairs","fa-times-circle-o","fa-check-circle-o","fa-ban"],t="";this.render=function(i){for(var u=$("<ul>").addClass("icon-picker").appendTo(i),r=0;r<n.length;r++)$("<li>").data("item",n[r]).addClass("fa "+n[r]).attr("title",n[r]).appendTo(u).on("click",function(){$(".icon-picker li").removeClass("selected");$(this).addClass("selected");t=$(this).data("item")})};this.getData=function(){return{Icon:"fa "+t}}}function ListBox(n,t){function s(){u.length||(u=$("<ul>").addClass("list-body").appendTo(r));i.data?e(i.data):i.url&&c&&h()}function e(n){var r,o,e,t,s;if(u.html(""),_this.selected=null,r=Utils.getCodes(n),o="item",r&&r.length)for(e=0;e<r.length;e++){t=r[e];s=t.Name||t.Code||t;$("<li>").addClass("list-item").html(s).data(o,t.Data||t).appendTo(u).on("click",function(){if($(".list-item").removeClass("active"),f=$(this).index("li"),_this.selected=$(this).addClass("active").data(o),i.onClick)i.onClick(_this.selected)})}}function h(){i.url&&$.get(i.url,function(n){e(n)})}var r=typeof n=="string"?$("#"+n):n,o=typeof n=="string"?n:n.attr("id"),c=t.autoLoad===undefined?!0:t.autoLoad,i=t||{},u=r.find(".list-body"),f=0;_this=this;this.id=o;this.selected=null;this.render=function(){return r=$("<div>").attr("id",o).addClass("list"),s(),r};this.select=function(n){f=n;u.find("li:eq("+n+")").click()};this.reload=function(){h();this.select(f)};this.setData=function(n){e(n)};r.length&&s()}function OssClient(){isloadOssJs||(Utils.addJs("/libs/aliyun-oss-sdk.min.js"),isloadOssJs=!0);var n=new OSS(OssClient.config);this.put=function(t,i,r){n.put(t,i).then(function(n){r(n)}).catch(function(n){console.log(n)})}}function Query(n){function e(){t.id&&i.attr("id",t.id);t.isTradition||i.addClass("left");t.querys&&t.querys.length&&s(t.querys);u.elem=i}function s(n){var f,h,a,e,y,l,s,c,p;for(i.html(""),c=0;c<n.length;c++)if(f=n[c],f.visible===undefined||f.visible)if(h=$("<div>").addClass("query-item").appendTo(i),a=$("<label>").html(f.title).appendTo(h),f.labelWidth&&a.css({width:f.labelWidth}),f.form=u,f.width="",f.inputStyle="",f.type=f.type||"text",f.isQuery=!0,f.type==="textarea"&&(f.type="text"),f.code&&(f.type="select"),e=new Date,f.type==="dateRange"){var w=new Date(e.getFullYear(),e.getMonth(),e.getDate()-(f.diffDay||7)),b=f.prefixType==="LG"?"L":"start",v=new Input(h,$.extend({},f,{type:"date",field:b+f.field,placeholder:DateFormat}));r(v);v.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:w.format(DateFormat),endDate:e});$("<span>~<\/span>").appendTo(h);y=f.prefixType==="LG"?"G":"end";l=new Input(h,$.extend({},f,{type:"date",field:y+f.field,placeholder:DateFormat}));r(l);l.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:e.format(DateFormat),endDate:e})}else f.type==="dateMonth"?(s=new Input(h,$.extend({},f,{type:"date",placeholder:"yyyy-MM"})),r(s),s.elem.fdatepicker({format:"yyyy-mm",startView:"year",minView:"year",maxView:"year",initialDate:e.format("yyyy-MM"),endDate:e.format("yyyy-MM")})):f.type==="date"?(s=new Input(h,$.extend({},f,{type:"date",placeholder:DateFormat})),r(s),s.elem.fdatepicker({format:"yyyy-mm-dd",initialDate:e.format(DateFormat),endDate:e})):f.type==="picker"?(s=new Input(h,{type:"text",field:f.field}),r(s)):(s=new Input(h,f),r(s));if(Utils.createButton({style:"primary",icon:"fa fa-search",text:Language.Search,handler:function(){o()}}).appendTo(i),t.buttons&&t.buttons.length)for(c=0;c<t.buttons.length;c++)p=t.buttons[c],Utils.createButton(p,function(){var n=u.getData();return{grid:t.grid,data:n}}).appendTo(i)}function r(n){n.setReadonly(!1);f.push(n);u[n.name]=n}function o(){var n=u.getData();if(t.onSearch)t.onSearch({grid:t.grid,data:n});else t.grid.reload(n,0)}var t=n,i=$("<div>").addClass("query"),f=[],u=this;(n.autoRender===undefined||n.autoRender)&&e();this.elem=i;this.render=function(){return e(),i};this.getData=function(){for(var t,i={},n=0;n<f.length;n++)t=f[n],i[t.name]=t.getValue();return i};this.search=function(){o()}}function Tabs(n){function l(){i=$("<div>").addClass("tabs");r=$("<div>").addClass("tabs-header").appendTo(i);t.showTitle&&(u=$("<div>").addClass("tabs-title").appendTo(r));f=$("<ul>").appendTo(r);t.showClose&&$("<i>").addClass("fa fa-close close").appendTo(r).click(function(){i.hide();t.onClose&&t.onClose()});e=$("<div>").addClass("tabs-body").appendTo(i);t.fit&&i.addClass("tabs-fit");t.style&&i.addClass(t.style);t.singleTab&&(o=new Router(e,{}));t.items&&a(t.items)}function a(n){for(var i,u,r=0;r<n.length;r++)i=n[r],i.index=r,u=$("<li>").data("item",i).appendTo(f).on("click",function(){var n=$(this).data("item");h($(this),n)}),i.icon&&$("<i>").addClass(i.icon).appendTo(u),u.append(i.name),!t.singleTab&&t.renderAllTab&&c(i);setTimeout(function(){h(f.find("li:eq(0)"),n[0])},100)}function h(n,i){if(f.find("li").removeClass("active"),n.addClass("active"),t.singleTab)o.route(i);else{var r=c(i);$(".tabs-item",e).removeClass("active");r.addClass("active")}t.onItemClick&&t.onItemClick(i)}function c(n){var r=n.index||0,i="tab-"+r,t=$("#"+i);return t.length||(t=$("<div>").attr("id",i).addClass("tabs-item").appendTo(e),new Router(t,{}).route(n)),t}var t=n||{},i,r,u,f,e,o,s;this.option=t;this.render=function(){return l(),i};this.show=function(r){var f,o,c,h,e;s=!0;r=r||{Id:""};t.showTitle&&(f=t.title,f||(o=getCurTab(),f=o?o.title:""),u.html(""),c=n.icon||"fa fa-window-maximize",u.append("<i>").addClass(c).append(f),h=r.Id===""?"【"+Language.New+"】":"【"+Language.Edit+"】",e="",t.titleInfo&&(e=t.titleInfo(r)),e.indexOf("【")>-1&&(h=""),u.append(h+e));i.show()};this.close=function(){s&&i.hide()}}function Toolbar(n){function e(r){var h,e,l,a,c;for(t.id&&i.attr("id",t.id),t.style&&i.addClass(t.style),t.isTradition===undefined||t.isTradition||i.addClass("right"),t.query&&o(i,t.query),h=0;h<t.buttons.length;h++)(e=t.buttons[h],typeof e=="string"&&(e=f[e]),!e.target||(l=e.target.indexOf("toolbar")>=0,a=e.target.indexOf("batch")>=0,n.isGridCell||n.isTradition||l||a))&&(e.children&&e.children.length?s(i,e):u(r||i,e));t.toolbarTips&&(c=$("<div>").addClass("toolbar-tips").appendTo(i),Utils.parseDom(c,t.toolbarTips,c))}function o(n,t){Utils.createButton({icon:"fa fa-search",text:Language.Query,handler:function(){t&&t()}}).appendTo(n)}function s(n,t){var r=$("<div>").addClass("dropdown").appendTo(n),i=$("<div>").addClass("title").appendTo(r),f;$("<i>").addClass(t.icon).appendTo(i);$("<span>").html(t.name).appendTo(i);$("<i>").addClass("fa fa-caret-down arrow").appendTo(i);f=$("<dl>").addClass("child").appendTo(r);t.children.forEach(function(n){u(f,n,"<dd>")})}function u(n,i,u){u||(u=t.isGridCell?t.onlyIcon?"<i>":"<span>":t.onlyIcon?"<i>":"<button>");var f=$(u).data("item",i).on("click",function(){var n=$(this).data("item"),i=t.gridParameter?t.gridParameter():null;n.handler?n.handler.call(this,i):r[n.code]&&r[n.code].call(this,i)}).appendTo(n);t.onlyIcon?f.addClass(i.icon).attr("title",i.name):t.isGridCell?f.append(i.name):($("<i>").addClass(i.icon).appendTo(f),$("<span>").html(i.text||i.name).appendTo(f))}var t=n,i=$("<div>").addClass("toolbar"),r=n.toolbar||{},f={add:{code:"add",name:Language.New,icon:"fa fa-plus",target:"toolbar"},edit:{code:"edit",name:Language.Edit,icon:"fa fa-edit",target:"grid"},remove:{code:"remove",name:Language.Delete,icon:"fa fa-trash-o",target:"grid,batch"},"import":{code:"import",name:Language.Import,icon:"fa fa-sign-in",target:"toolbar"},"export":{code:"export",name:Language.Export,icon:"fa fa-sign-out",target:"toolbar"}};this.elem=i;this.render=function(n){return e(n),i}}function Tree(n,t){function s(){i.addClass("ztree");t.data&&e(t.data);t.url&&l&&h(!1,null)}function h(n,i){t.url&&$.get(t.url,i,function(i){var r,o;if(n)for(r=0;r<i.length;r++)o=f.indexOf(i[r].id),o>-1&&(i[r].open=!0);e(i);t.onLoad&&t.onLoad(u.data)})}function e(n){var e={view:{nodeClasses:function(n,t){return{add:["tree-"+(t.type||"type")]}}},data:{key:{url:""}},callback:{onClick:function(n,i,r){u.selectedNode=r;t.onClick&&t.onClick(r)},onExpand:function(n,t,i){f.push(i.id)},onCollapse:function(n,t,i){var r=f.indexOf(i.id);r>-1&&f.splice(r,1)}}},o;t.check&&(e.check={enable:!0,chkboxType:{Y:"ps",N:"s"}});c&&(e.data.simpleData={enable:!0,pIdKey:t.parentKey||"pid"});u.list=n;t.dataFilter?(o=t.dataFilter(n),r=$.fn.zTree.init(i,e,o)):r=$.fn.zTree.init(i,e,n);t.expandAll&&r.expandAll(!0);u.data=r.getNodes()}$.fn.zTree||(Utils.addCss("/libs/ztree/ztree.css"),Utils.addJs("/libs/ztree/jquery.ztree.min.js"));var c=t.simpleData===undefined?!0:t.simpleData,l=t.autoLoad===undefined?!0:t.autoLoad,i=typeof n=="string"?$("#"+n):n,o=typeof n=="string"?n:n.attr("id"),u=this,r,f=[];i.length&&s();this.id=o;this.list=[];this.data=[];this.selectedNode=null;this.render=function(){return i=$("<ul>").attr("id",o),s(),i};this.setData=function(n){e(n)};this.reload=function(n){h(!0,n)};this.getCheckedNodes=function(){return r.getCheckedNodes(!0)};this.getNodeData=function(n){var t=this.list.filter(n);return t.length?t[0].data:null}}function View(n,t){function h(){var t=top.ExtForm[n],i,r;if(t){if(i=t.columns,i&&i.length)for(r=0;r<i.length;r++)u.push(i[r]);t.formOption&&$.extend(!0,f,t.formOption);t.gridOption&&$.extend(!0,e,t.gridOption)}}function c(){var e=$.extend(!0,{card:!0,fields:u.slice(),toolbar:[{text:Language.Save,icon:"fa fa-save",handler:function(n){n.form.save(t.url.SaveModel,o)}}]},f),i;if(t.formToolbar)for(i=0;i<t.formToolbar.length;i++)e.toolbar.push(t.formToolbar[i]);r=new Form(n,e)}function l(){var s=[],f,h;e.toolButtons||(f=getCurTab(),f&&f.children&&(s=f.children.filter(function(n){return n.type==="button"})));h=$.extend(!0,{form:r,isTradition:!1,isIconButton:!1,url:t.url.QueryModels||"",autoQuery:!1,toolButtons:s,toolbar:{add:function(n){var t=r.option.data;typeof t=="function"&&(t=t());n.addRow(t)},edit:function(n){n.editRow()},remove:function(n){n.deleteRows(t.url.DeleteModels,o)},up:function(n){n.moveRow("up",t.url.MoveModel)},down:function(n){n.moveRow("down",t.url.MoveModel)},"import":function(n){n.import(t.url.ImportModels)},"export":function(n){n.export()}},columns:u.slice().filter(function(n){return!n.onlyForm})},e);i=new Grid(n,h)}var s=this,o=t.refresh||function(){s.load()},u=t.columns||[],r,f=t.formOption||{},i,e=t.gridOption||{};u.filter(function(n){return n.type}).length&&(h(),c());l();this.name=n;this.option=t;this.form=r;this.grid=i;this.render=function(){var n=$("<div>").addClass("fit"),u,f;return t.left?(f=$("<div>").addClass("fit-col-3").appendTo(n),u=$("<div>").addClass("fit-col-7").appendTo(n),t.left.render().appendTo(f)):u=t.inner?n:$("<div>").addClass("fit-col").appendTo(n),i.render().appendTo(u),r&&r.render().appendTo($("body")),n};this.load=function(n){t.left?(t.left.reload(n),i.setData([])):i.reload(n)};this.loadGrid=function(n){i.reload(n)};this.getGridData=function(){return i.getData()};this.setGridData=function(n){i.setData(n)};this.setGridDetail=function(n){i.setDetail(n)};this.getRowData=function(n){var t=i.data.filter(n);return t.length?t.length===1?t[0]:t:null};this.showForm=function(n){var t=f.data;r.render().appendTo($("body"));r.show(t,!1,n)}}function getCurTab(){return top.Admin.CurrentTab}function showTabPage(n){n.children=top.Admin.Buttons.filter(function(t){return t.pid===n.id});top.Admin.showTab(n)}function showTabPageByCode(n){var t=top.Admin.Menus.filter(function(t){return t.code===n});t.length&&showTabPage(t[0])}function App(n){function r(){i=new Router(t,{isTop:!0,multiNode:!0})}var t=$("#"+n),i;r();this.elem=t;this.router=i;this.user={};this.route=function(n){i.route(n)};this.render=function(){var n=Utils.getUrlParam("m"),r=Page[n];r?(i.route(r),setTimeout(function(){Page.complete();BizHistory.init()},10)):(t.html(""),$("<div>").addClass("content").html(n+Language.NotExist+"！").appendTo(t))};this.home=function(){this.route({component:new Home})};this.login=function(){Utils.setUser(null);Utils.setCodes(null);this.route({component:new Login})};this.install=function(){this.route({component:new Install})};this.active=function(){this.route({component:new Active})}}function BizFile(n,t){function f(){var t;BizForm.open({title:Language.AddAttachment,width:450,height:200,fields:[{field:"Category1",type:"hidden"},{field:"Category2",type:"hidden"},{field:"BizId",type:"hidden"},{title:Language.AttachmentType,field:"Type",type:"text",required:!0},{title:Language.Attachment,field:"Files",type:"file",multiple:!0,required:!0}],success:function(r){t=r.form;t.setData({Category1:Language.FormAttachment,Category2:n,BizId:i.Id})},buttons:[{text:Language.OK,handler:function(n){if(t.validate()){var f=t.getData();Ajax.upload("Files",u.UploadFiles,f,function(){n.close();r.reload({bizId:i.Id})})}}}]})}var u={QueryModels:baseUrl+"/System/GetFiles",DeleteModels:baseUrl+"/System/DeleteFiles",UploadFiles:baseUrl+"/System/UploadFiles"},i,r=new Grid("BizFile",{url:u.QueryModels,querys:[],page:!1,autoQuery:!1,isTradition:!0,columns:[{title:Language.AttachmentType,field:"Type"},{title:Language.AttachmentName,field:"Name",format:function(n){var i=Utils.getExtIcon(n.ExtName),t=$("<span>").append('<i class="'+i+'">');$("<span>").addClass("link").html(n.Name).data("id",n.Id).appendTo(t).on("click",function(){var n=$(this).data("id");Ajax.download(BizFileDownloadUrl,{id:n})});return t}}],toolButtons:["add","remove"],toolbarTips:t||"",toolbar:{add:function(){if(!i.Id){Layer.tips(Language.PleaseSaveBizForm);return}f()},remove:function(n){n.deleteRows(u.DeleteModels,function(){r.reload({bizId:i.Id})})}}});this.render=function(){return r.render()};this.load=function(n){i=n.head;r.setDetail(n.isDetail);r.reload({bizId:i.Id})}}function BizFlowLog(){var t={QueryModels:BizFlow.url.GetFlowLogs},n=new Grid("BizFile",{url:t.QueryModels,querys:[],page:!1,autoQuery:!1,showCheckBox:!1,columns:BizFlow.logColumns});this.render=function(){return n.render()};this.load=function(t){n.reload({bizId:t.head.Id})}}function NoticeList(n){$("#"+n).addClass("grid").html('<table id="gridNotice">');var t={GetNewestNotices:baseUrl+"/System/GetNewestNotices"},i=new Grid("Notice",{url:t.GetNewestNotices,page:!1,fixed:!1,showCheckBox:!1,autoQuery:!1,columns:[{title:Language.Title,field:"Title",format:function(n){return $("<span>").addClass("link").append(n.Title).data("data",n).click(function(){var n=$(this).data("data");Layer.open({title:n.Title,width:960,height:400,content:n.Content})})}},{title:Language.PublishTime,field:"PublishTime",width:"120px",placeholder:"yyyy-MM-dd HH:mm"}]});this.load=function(){i.reload()};this.more=function(){Layer.page({url:baseUrl+"/?m=SysNotice&type=more"})}}function UserLink(n,t){function o(){u.html(Language.Loading+"......");$.get(r.GetUserLinks,{type:t},function(n){u.html("");for(var t=0;t<n.length;t++)s(n[t])})}function s(n){f.push(n.Address);var t=e.getDom(n);t.hover(function(){var t="data";$('<span class="close fa fa-close">').data(t,n).click(function(n){var i=$(this),u=i.parent(),f=i.data(t);Layer.confirm(Language.ConfirmDelete,function(){$.post(r.DeleteUserLink,{id:f.Id},function(){u.remove()})});n.stopPropagation()}).appendTo($(this))},function(){$(this).find(".close").remove()}).appendTo(u)}var r={GetUserLinks:baseUrl+"/System/GetUserLinks",DeleteUserLink:baseUrl+"/System/DeleteUserLink",AddUserLink:baseUrl+"/System/AddUserLink",AddShortcuts:baseUrl+"/System/AddShortcuts"},i=top.Admin.Menus,h={shortcut:{getDom:function(n){var u="data",f=i.filter(function(t){return t.id===n.Address}),t=f.length?f[0]:{},r=$("<li>").data(u,t).click(function(){var n=$(this).data(u);showTabPage(n)});return r.append('<span class="icon"><span class="'+t.icon+'"><\/span><\/span>'),r.append("<span>"+t.name+"<\/span>"),r},add:function(){var n;Layer.open({title:Language.Shortcut,icon:"fa fa-external-link",width:360,height:300,content:'<ul id="treeLink"><\/ul>',success:function(){for(var t=0;t<i.length;t++)f.indexOf(i[t].id)>-1&&(i[t].checked=!0);n=new Tree("treeLink",{data:i,check:!0})},buttons:[{text:Language.OK,handler:function(i){var e=n.getCheckedNodes(),s,h,f,u;if(e.length===0)Layer.tips(Language.PleaseSelectMenuItem);else{for(s=[],h=[],f=0;f<e.length;f++)u=e[f],u.children||h.indexOf(u.url)<0&&(s.push({Type:t,Name:u.name,Address:u.id}),h.push(u.id));$.post(r.AddShortcuts,{data:JSON.stringify(s)},function(){i.close();o()})}}}]})}},commlink:{getDom:function(n){var t="data",i=$("<li>").data(t,n).click(function(){var n=$(this).data(t);window.open(n.Address)});return i.append("<span>"+n.Name+"<\/span>"),i},add:function(){var i=this,n;Layer.open({title:Language.CommonLink,icon:"fa fa-external-link",width:400,height:220,content:'<div id ="formLink" class="form form-block">',success:function(){n=new Form("Link",{labelWidth:60,fields:[{title:Language.Name,field:"Name",type:"text",required:!0},{title:Language.Address,field:"Address",type:"text",required:!0,inputStyle:"width:280px"}],onSaving:function(n){n.Type=t;n.Address.indexOf("http")<0&&(n.Address="http://"+n.Address)}})},buttons:[{text:Language.OK,handler:function(t){n.save(r.AddUserLink,function(n){t.close();s(n)})}}]})}}},u=$("#"+n).addClass(t),f=[],e=h[t];this.load=function(){o()};this.add=function(){e.add()}}function IconColumn(){function n(n){$(".icon-input .field").attr("class","field "+n)}this.field={onlyForm:!0,title:"图标",field:"Icon",inputHtml:function(n){$("<span>").addClass("field").appendTo(n.parent)},inputStyle:"icon-input",type:"picker",pick:{action:"icon",callback:function(t){n(t.value)}},required:!0};this.setIcon=function(t){n(t)}}function SysApp(){var i={QueryModels:baseUrl+"/System/QueryApps",DeleteModels:baseUrl+"/System/DeleteApps",SaveModel:baseUrl+"/System/SaveApp"},n=new IconColumn,t=new View("App",{url:i,columns:[{field:"Id",type:"hidden"},{title:"编码",field:"Code",width:"80px",type:"text",required:!0},{title:"名称",field:"Name",width:"120px",type:"text",required:!0,query:!0,format:function(n,t){$("<i>").addClass(n.Icon).appendTo(t.td);$("<a>").attr("target","_blank").attr("href",baseUrl+"/?a="+n.Code).html(n.Name).appendTo(t.td)}},n.field,{label:"选项",title:"状态",field:"Enabled",width:"80px",type:"checkbox",code:"Enabled",required:!0,align:"center"},{label:"选项",title:"App",field:"Extension.App",width:"80px",type:"checkbox",code:"YesNo",required:!0,align:"center"},{title:"顺序",field:"Sort",width:"65px",type:"text",required:!0,align:"center"},{title:"备注",field:"Note",type:"textarea",lineBlock:!0}],formOption:{style:"form-block",data:{Id:"",Enabled:1},setData:function(t){n.setIcon(t.data.Icon)}},gridOption:{sortField:"Sort",sortOrder:"asc"}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysDashboard(n){function e(t){var r=f(t,"75%"),s=$("<div>").addClass("row").appendTo(r),h=$("<div>").addClass("card").appendTo(s),c=n.icons||[{}],i,e;Dashboard.createIconCards(h,c);var l=$("<div>").addClass("row").appendTo(r),a=$("<div>").addClass("card").css({height:"376px"}).appendTo(l),u=n.menus||[];for(i=0;i<u.length;i++)e=u[i],o(a,e)}function o(n,t){var u=$("<div>").addClass("dash-sitemap").appendTo(n),f,i,e;for(r("<span>",u,t).addClass("dash-menu").css({top:0,left:0}),f=$("<ul>").addClass("menu-items").css({paddingTop:"5px"}).appendTo(u),i=0;i<t.children.length;i++)e=t.children[i],r("<li>",f,e).click(function(){var n=$(this).data("item");n.type="page";n.id=n.code;n.title=n.name;showTabPage(n)})}function r(n,t,i){var r=$(n).data("item",i).appendTo(t),u=$("<span>").addClass("icon").appendTo(r);return $("<span>").addClass(i.icon).appendTo(u),$("<span>").html(i.name).appendTo(r),r}function s(n){var r=f(n,"25%"),o=u(r),e;t=Dashboard.createShortcut(o,{height:"211px"});e=u(r);i=Dashboard.createCommLink(e,{height:"212px"})}function u(n){return $("<div>").addClass("row").css("padding-left","0").appendTo(n)}function f(n,t){return $("<div>").css({float:"left",width:t}).appendTo(n)}var t,i;this.render=function(n){e(n);s(n)};this.mounted=function(){n.countUrl&&$.get(n.countUrl,function(n){for(var t in n)$("#"+t+" h3").html(n[t])});t.load();i.load()}}function SysDictionary(){var i={QueryModels:baseUrl+"/System/QueryDictionarys",DeleteModels:baseUrl+"/System/DeleteDictionarys",SaveModel:baseUrl+"/System/SaveDictionary",GetDicCategories:baseUrl+"/System/GetDicCategories?appId="+appId},n,u=new ListBox("listCategory",{url:i.GetDicCategories,autoLoad:!1,onClick:function(i){n=i;t.loadGrid({AppId:appId,Category:i.Code})}}),r=[{field:"Id",type:"hidden"},{field:"Category",type:"hidden"},{field:"CategoryName",type:"hidden"},{title:Language.Code,field:"Code",width:"150px",query:!0,type:"text",required:!0},{title:Language.Name,field:"Name",width:"150px",query:!0,type:"text"},{title:Language.Status,field:"Enabled",width:"80px",align:"center",type:"checkbox",code:"Enabled",required:!0},{title:Language.Sort,field:"Sort",width:"50px",align:"center",type:"text",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],t;curUser.AppId==="DEV"&&r.splice(3,0,{title:Language.System,field:"AppId",width:"80px",query:!0,type:"select",code:"ProductData",required:!0,sort:!0});t=new View("SysDictionary",{url:i,left:u,columns:r,formOption:{style:"form-block",titleInfo:function(n){return"- "+n.Category+"|"+n.CategoryName}},gridOption:{autoQuery:!1,sortField:"Sort",sortOrder:"asc",where:{Category:""},toolbar:{add:function(t){if(!n){Layer.tips(Language.PleaseDicCategory);return}t.addRow({Id:"",Enabled:1,Category:n.Code,CategoryName:n.Name})}}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysError(){function r(n){Layer.open({title:Language.Error+Language.Detail,width:1e3,height:400,content:"<pre>"+n.StackTrace+"<\/pre>"})}function u(i){Layer.confirm(Language.ConfirmDelete,function(){Ajax.post(t.DeleteError,{id:i},function(){n.load()})})}function i(n,t,i,r){return $("<span>").addClass("link").data("data",t).html(i).appendTo(n).on("click",r)}var t={QueryModels:baseUrl+"/System/QueryErrors",DeleteError:baseUrl+"/System/DeleteError"},n=new View("SysError",{url:t,columns:[{title:Language.Operate,field:"Id",width:"100px",format:function(n){var t=$("<span>");return i(t,n,Language.Detail,function(){r($(this).data("data"))}).css("margin-right","5px"),i(t,n,Language.Remove,function(){u($(this).data("data").Id)}),t}},{title:Language.System,field:"System",width:"80px",query:!0},{title:Language.OperateBy,field:"User",width:"80px",query:!0},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:DateTimeFormat},{title:Language.ErrorMessage,field:"Message",width:"150px"},{title:"IP",field:"IP",width:"150px",format:function(n){return n.IP+" - "+n.IPName}},{title:"Url",field:"Url"}],gridOption:{page:!1}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysFile(){function r(){var i=new Form("AddFile",{style:"form form-block",fields:[{title:Language.Category1,field:"Category1",type:"text",required:!0},{title:Language.Category2,field:"Category2",type:"text"},{title:Language.Attachment,field:"Files",type:"file",multiple:!0}]});Layer.open({title:Language.AddDocument,width:500,height:250,component:i,buttons:[{text:Language.OK,handler:function(r){if(i.validate()){var u=i.getData();Ajax.upload("Files",n.UploadFiles,u,function(){r.close();t.load()})}}}]})}var n={QueryModels:baseUrl+"/System/QueryFiles",DeleteModels:baseUrl+"/System/DeleteFiles",SaveModel:baseUrl+"/System/SaveFile",GetFileCategories:baseUrl+"/System/GetFileCategories",UploadFiles:baseUrl+"/System/UploadFiles",DownloadFile:baseUrl+"/System/DownloadFile",DownloadSysFile:baseUrl+"/System/DownloadSysFile"},i=new Tree("treeFile",{url:n.GetFileCategories,autoLoad:!1,onClick:function(n){t.loadGrid({Category1:n.Category1,Category2:n.Category2})}}),t=new View("SysFile",{url:n,left:i,columns:[{field:"Id",type:"hidden"},{title:Language.Category1,field:"Category1",width:"100px",type:"text",required:!0,onlyForm:!0},{title:Language.Category2,field:"Category2",width:"100px",type:"text",onlyForm:!0},{title:Language.FileName,field:"Name",width:"100px",query:!0,format:function(t){var r=Utils.getExtIcon(t.ExtName),i=$("<span>").append('<i class="'+r+'">');$("<span>").addClass("link").html(t.Name).data("id",t).appendTo(i).on("click",function(){var t=$(this).data("id");t.Id===""?Ajax.download(n.DownloadSysFile,{bizId:t.BizId}):Ajax.download(n.DownloadFile,{id:t.Id})});return i},type:"text",required:!0,inputBlock:!0},{title:Language.FileType,field:"Type",width:"100px",type:"text"},{title:Language.FileSize,field:"Size",width:"100px",align:"right",type:"text",readonly:!0},{title:Language.FileSourceName,field:"SourceName",width:"100px",type:"text",readonly:!0,inputBlock:!0},{title:Language.ExtName,field:"ExtName",width:"100px",query:!0,type:"text",readonly:!0},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0},{title:Language.UploadBy,field:"CreateBy",width:"100px"},{title:Language.UploadTime,field:"CreateTime",width:"140px",placeholder:DateTimeFormat,align:"center"}],gridOption:{toolbar:{add:function(){r()},edit:function(n){n.editRow(function(n){return n.row.Id===""?(Layer.tips(Language.SysFileNotEdit),!1):!0})},remove:function(t){var i=!1;if(t.selectRows(function(n){for(var t=0;t<n.rows.length;t++)if(n.rows[t].Id===""){i=!0;break}}),i)return Layer.tips(Language.SysFileNotDelete),!1;t.deleteRows(n.DeleteModels,function(n){n.grid.reload()})}}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysFlow(n){var i={GetModel:baseUrl+"/System/GetFlowStep",SaveModel:baseUrl+"/System/SaveFlowStep"},r,t;n=n||{Code:"SysFlow"};r=new FlowChart(n.Code,{items:n.steps,click:function(r){$.get(i.GetModel,{flowCode:n.Code,stepCode:r.step.id},function(i){i||(i={Id:"",FlowCode:n.Code,FlowName:n.Name});i.StepCode=r.step.id;i.StepName=r.step.name;i.StepType=r.step.flag;i.X=r.step.x;i.Y=r.step.y;i.IsRound=r.step.round?1:0;t.setData(i)})}});t=new Form(n.Code,{style:"form-block",labelWidth:60,fields:[{field:"Id",type:"hidden"},{field:"FlowCode",type:"hidden"},{field:"FlowName",type:"hidden"},{field:"StepCode",type:"hidden"},{field:"StepType",type:"hidden"},{field:"X",type:"hidden"},{field:"Y",type:"hidden"},{field:"IsRound",type:"hidden"},{field:"Arrows",type:"hidden"},{title:Language.Name,field:"StepName",type:"text",readonly:!0},{title:Language.OperateBy,field:"OperateBy",type:"picker",pick:{action:"user"}},{title:Language.Description,field:"Note",type:"textarea"}],toolbar:[{text:Language.OK,handler:function(){t.save(i.SaveModel)}}]});this.render=function(n){var i=$("<div>").addClass("fit-col").css("overflow","hidden").appendTo(n);r.render(i);t.render().appendTo(i);t.elem.addClass("form-flow").css({width:"300px",height:"300px"})};this.mounted=function(){}}function SysJob(){var i={QueryModels:baseUrl+"/System/QueryJobSettings",DeleteModels:baseUrl+"/System/DeleteJobSettings",SaveModel:baseUrl+"/System/SaveJobSetting"},n,t=new View("JobSetting",{url:i,columns:[{field:"Id",type:"hidden"},{title:Language.CompNo,field:"CompNo",width:"100px",query:!0,format:function(n){var t=n.CompNo;return n.CompName&&(t+="-"+n.CompName),t},type:"text",required:!0},{title:Language.System,field:"AppId",width:"100px",query:!0,format:function(n){var t=n.AppId;return n.AppName&&(t+="-"+n.AppName),t},type:"select",required:!0,code:"ProductData"},{title:Language.Name,field:"Name",width:"100px",query:!0,type:"text",required:!0},{title:"Job"+Language.Type,field:"TypeName",width:"100px",type:"text",inputStyle:"width:50%",lineBlock:!0,required:!0,inputHtml:'<div id="rblTypeName" style="display:inline-block;margin-left:5px;"><\/div>'},{title:Language.ExecuteTime,field:"RunTime",width:"100px",type:"text",tips:Language.Sample+"：HH:mm:ss=07:00:00"},{title:Language.ExecuteInterval,field:"Interval",width:"100px",type:"text",tips:Language.ExecuteIntervalTips},{title:Language.ExecuteStatus,field:"Status",width:"100px",type:"select",format:function(n){var t=" gray";return n.Status===Language.Executing?t=" info":n.Status===Language.ExecutePass?t=" success":n.Status===Language.ExecuteFail&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},query:!0,readonly:!0,code:[Language.NoExecute,Language.Executing,Language.ExecutePass,Language.ExecuteFail]},{title:Language.LastTime,field:"LastTime",width:"140px",placeholder:DateTimeFormat,align:"center"},{label:Language.Option,title:Language.Enable,field:"Enabled",width:"100px",align:"center",type:"checkbox",required:!0,code:"YesNo"},{title:Language.ErrorMessage,field:"Exception",format:function(n){return n.Exception?$("<span>").addClass("link").html(Language.Detail).data("note",n.Exception).on("click",function(){var n=$(this).data("note");Layer.open({title:Language.Error+Language.Detail,content:"<pre>"+n+"<\/pre>"})}):""}},{onlyForm:!0,title:Language.ExecuteParams,field:"Params",type:"html",lineBlock:!0,inputHtml:'<table id="gridParam" class="grid"><\/table>'}],formOption:{data:{Id:"",Status:Language.NoExecute,Enabled:1},setData:function(t){var r,i,u;if(new Input($("#rblTypeName"),{type:"radio",field:"JobType",code:["HttpJob","TaskJob"],onClick:function(n){t.form.TypeName.setValue(n)}}),n=new Grid("Param",{edit:!0,columns:[{action:"add",icon:"fa fa-plus",align:"center",width:"80px",actionFormat:function(){return'<span class="link" action="remove">'+Language.Delete+"<\/span>"}},{title:Language.ParameterName,field:"Name",type:"text",width:"150px"},{title:Language.ParameterValue,field:"Value",type:"text"}]}),r=[],i=t.data.Params,i)for(u in i)r.push({Name:u,Value:i[u]});n.setData(r)},onSaving:function(t){var r=n.getData(),i,u;if(r.length)for(t.Params={},i=0;i<r.length;i++)u=r[i],t.Params[u.Name]=u.Value}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysLog(){var t={QueryModels:baseUrl+"/System/QueryLogs"},n=new View("SysLog",{url:t,columns:[{title:Language.OperateBy,field:"CreateBy",width:"80px",query:!0},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:DateTimeFormat},{title:Language.LogType,field:"Type",width:"100px"},{title:Language.LogTarget,field:"Target",width:"100px"},{title:Language.LogContent,field:"Content",query:!0}],gridOption:{sortField:"CreateTime",sortOrder:"desc"}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysModuleTree(n){function o(n){e=n;r={module:n};t.reload({appId:n.Code})}var u={GetSystems:baseUrl+"/System/GetSystems",GetModuleTree:baseUrl+"/System/GetModuleTree"},i,f=!1,e,r,t=new Tree("tree",{url:u.GetModuleTree,autoLoad:!1,dataFilter:function(t){return n.hideButton?t.filter(function(n){return n.type!=="button"}):t},onLoad:function(t){n.onLoad&&n.onLoad(t)},onClick:function(t){r=t;n.onClick&&n.onClick(t)}});this.render=function(){var n=$("<div>"),r=$("<div>").css({padding:"5px"}).appendTo(n);return i=new Input(r,{field:"App",type:"select",emptyText:"全部",change:function(n){o(n.selected)}}),t.render().appendTo(n),n};this.getList=function(){return t.list};this.getSelectedApp=function(){return e};this.getSelectedNode=function(){return r};this.reload=function(){f?t.reload({appId:i.getValue()}):(i.setUrl(u.GetSystems,function(){}),o({Code:"",Name:"全部"}),f=!0)}}function SysModule(){function e(n,t){var i;Layer.open({title:"添加按钮 - "+n.Name,width:420,height:250,content:'<div id="listButton" style="padding:10px;">',success:function(){i=new Input($("#listButton"),{type:"checkbox",code:[{Code:"add",Name:"新增",Data:{Icon:"fa fa-plus",Target:"toolbar",Sort:1}},{Code:"copy",Name:"复制",Data:{Icon:"fa fa-copy",Target:"grid",Sort:2}},{Code:"edit",Name:"编辑",Data:{Icon:"fa fa-edit",Target:"grid",Sort:3}},{Code:"remove",Name:"删除",Data:{Icon:"fa fa-trash-o",Target:"grid,batch",Sort:4}},{Code:"import",Name:"导入",Data:{Icon:"fa fa-sign-in",Target:"toolbar",Sort:5}},{Code:"export",Name:"导出",Data:{Icon:"fa fa-sign-out",Target:"toolbar",Sort:6}},{Code:"-"},{Code:"print",Name:"打印",Data:{Icon:"fa fa-print",Target:"grid",Sort:7}},{Code:"up",Name:"上移",Data:{Icon:"fa fa-arrow-up",Target:"grid",Sort:8}},{Code:"down",Name:"下移",Data:{Icon:"fa fa-arrow-down",Target:"grid",Sort:9}},{Code:"upload",Name:"上载",Data:{Icon:"fa fa-upload",Target:"toolbar",Sort:10}},{Code:"download",Name:"下载",Data:{Icon:"fa fa-download",Target:"toolbar",Sort:11}},{Code:"-"},{Code:"lock",Name:"锁定",Data:{Icon:"fa fa-lock",Target:"grid,batch",Sort:12}},{Code:"unlock",Name:"解锁",Data:{Icon:"fa fa-unlock",Target:"grid,batch",Sort:13}},{Code:"enable",Name:"启用",Data:{Icon:"fa fa-check-circle-o",Target:"grid,batch",Sort:14}},{Code:"disable",Name:"禁用",Data:{Icon:"fa fa-minus-circle",Target:"grid,batch",Sort:15}},{Code:"-"},{Code:"submit",Name:"提交",Data:{Icon:"fa fa-send-o",Target:"grid,batch",Sort:16}},{Code:"revoke",Name:"撤回",Data:{Icon:"fa fa-reply",Target:"grid,batch",Sort:17}},{Code:"pass",Name:"复核通过",Data:{Icon:"fa fa-check",Target:"grid,batch",Sort:18}},{Code:"fail",Name:"复核退回",Data:{Icon:"fa fa-close",Target:"grid,batch",Sort:19}},{Code:"close",Name:"关闭",Data:{Icon:"fa fa-times-circle-o",Target:"grid,batch",Sort:20}}]})},buttons:[{text:"确定",handler:function(r){var u=i.getData(),f;if(!u.length){Layer.tips("请至少选择一个按钮！");return}f=u.map(function(t){var i=t.Data;return i.AppId=n.AppId,i.ParentId=n.Id,i.Code=t.Code,i.Name=t.Name,i.Type="button",i.Enabled=1,i});t&&t(f);r.close()}}]})}function u(t,i){var r;Layer.open({title:t,width:350,height:250,content:'<ul id="treeModule">',success:function(){var t=n.getList();new Tree("treeModule",{data:t.filter(function(n){return n.module.Type!=="button"}),onClick:function(n){r=n.module}})},buttons:[{text:"确定",handler:function(n){n.close();i&&i(r)}}]})}function o(t){var i;Layer.open({title:"导出SQL",width:450,height:300,content:'<ul id="treeSql">',success:function(){i=new Tree("treeSql",{check:!0,data:n.getList(),onClick:function(n){copyNode=n.module}})},buttons:[{text:"确定",handler:function(n){n.close();var r=i.getCheckedNodes();t&&t(r)}}]})}function f(i,r){var u=r===1?"启用":"禁用";i.selectRows(function(i){Layer.confirm("确定要"+u+"所选模块？",function(){Ajax.post(t.EnableModules,{data:JSON.stringify(i.ids),enable:r},function(){n.reload()})})})}var t={DeleteModels:baseUrl+"/System/DeleteModules",MoveModel:baseUrl+"/System/MoveModule",SaveModel:baseUrl+"/System/SaveModule",CopyModules:baseUrl+"/System/CopyModules",MoveModules:baseUrl+"/System/MoveModules",AddModules:baseUrl+"/System/AddModules",EnableModules:baseUrl+"/System/EnableModules"},r=new IconColumn,n=new SysModuleTree({onLoad:function(n){var t=n||[],r=t.map(function(n){return n.module});i.setGridData(r)},onClick:function(n){var t=n.children||[],r=t.map(function(n){return n.module});i.setGridData(r)}}),i=new View("Module",{url:t,left:n,columns:[{field:"Id",type:"hidden"},{field:"AppId",type:"hidden"},{field:"ParentId",type:"hidden"},{title:"编码",field:"Code",width:"80px",type:"text",required:!0},{title:"名称",field:"Name",width:"120px",type:"text",required:!0,format:function(n){return'<i class="'+n.Icon+'"><\/i> '+n.Name}},r.field,{title:"类型",field:"Type",width:"80px",type:"radio",code:[{Code:"menu",Name:"菜单"},{Code:"page",Name:"页面"},{Code:"button",Name:"按钮"}],required:!0,align:"center"},{title:"目标",field:"Target",type:"checkbox",code:[{Code:"tab",Name:"Tab"},{Code:"_blank",Name:"Blank"},{Code:"toolbar",Name:"工具条"},{Code:"grid",Name:"表格内"},{Code:"batch",Name:"批量操作"}]},{title:"URL",field:"Url",type:"text",inputBlock:!0},{title:"状态",field:"Enabled",width:"80px",type:"checkbox",code:"Enabled",required:!0,align:"center"},{title:"顺序",field:"Sort",width:"50px",type:"text",required:!0,align:"center"},{onlyForm:!0,title:"备注",field:"Note",type:"textarea",lineBlock:!0}],refresh:function(){n.reload()},formOption:{width:1100,height:380,titleInfo:function(n){return n.ParentName?"- "+n.ParentName:""},setData:function(n){r.setIcon(n.data.Icon)}},gridOption:{url:"",page:!1,isTradition:!0,toolbar:{addMod:function(t){var i=n.getSelectedNode();if(!i){Layer.tips("请选择上级模块！");return}var u=n.getSelectedApp(),r=i.module,f=i.children||[];t.addRow({Id:"",AppId:u.Code,ParentId:r.Id,ParentName:r.Name,Enabled:1,Icon:"fa fa-file-o",Type:"page",Target:"tab",Sort:f.length+1})},addBtn:function(){var i=n.getSelectedNode();if(!i||!i.module.Code){Layer.tips("请选择模块！");return}e(i.module,function(i){Ajax.post(t.AddModules,{data:JSON.stringify(i)},function(){n.reload()})})},copy:function(i){i.selectRows(function(i){u("复制到",function(r){Ajax.post(t.CopyModules,{data:JSON.stringify(i.ids),mid:r.Id},function(){n.reload()})})})},move:function(i){i.selectRows(function(i){u("移动到",function(r){Ajax.post(t.MoveModules,{data:JSON.stringify(i.ids),mid:r.Id},function(){n.reload()})})})},enable:function(n){f(n,1)},disable:function(n){f(n,0)},sql:function(){o(function(n){var i=n.map(function(n){return n.id});Ajax.download(t.ExportModules,{data:JSON.stringify(i)})})}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load()}}function SysNoRule(){function r(){t.load();t.setGridData([])}function e(){var t=new Form("NoRule",{style:"form form-block",fields:[{field:"Id",type:"hidden"},{title:Language.System,field:"AppId",type:"select",code:"ProductData",required:!0},{title:Language.Number,field:"Code",type:"text",required:!0},{title:Language.Name,field:"Name",type:"text",required:!0},{title:Language.Description,field:"Description",type:"textarea"}]});Layer.open({title:Language.NoRule,width:450,height:320,component:t,buttons:[{text:Language.OK,handler:function(i){t.save(n.SaveModel,function(){r();i.close()})}}]})}function o(){if(!i){Layer.tips(Language.PleaseSelectRuleName);return}var r=t.getGridData();i.RuleData=JSON.stringify(r);Ajax.post(n.SaveModel,{data:JSON.stringify(i)})}function s(){Layer.confirm(Language.ConfirmDelete,function(){Ajax.post(n.DeleteModels,{data:JSON.stringify([u.selected.Id])},function(){r()})})}var n={GetNoRules:baseUrl+"/System/GetNoRules",DeleteModels:baseUrl+"/System/DeleteNoRules",SaveModel:baseUrl+"/System/SaveNoRule"},i,u=new ListBox("listCategory",{url:n.GetNoRules,autoLoad:!1,onClick:function(n){i=n;var r=[];n.RuleData&&(r=JSON.parse(n.RuleData));t.setGridData(r)}}),f='<div style="color:#00f;">'+Language.NoRuleTips+"<\/span>",t=new View("SysNoRule",{url:n,left:u,columns:[{action:"add",icon:"fa fa-plus",align:"center",width:"80px",aFormat:"remove,up,down"},{title:Language.Type,field:"Type",type:"select",width:"100px",code:[Language.FixedValue,Language.DateValue,Language.SeqNo]},{title:Language.Value,field:"Value",type:"text"}],gridOption:{edit:!0,fixed:!0,isTradition:!0,toolbar:{add:function(){e()},save:function(){o()},remove:function(){s()}},footer:f}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){r()}}function SysNotice(){var i=Utils.getUrlParam("type"),t={QueryModels:baseUrl+"/System/QueryNotices",DeleteModels:baseUrl+"/System/DeleteNotices",SaveModel:baseUrl+"/System/SaveNotice",PublishNotice:baseUrl+"/System/PublishNotice"},n=new View("SysNotice",{url:t,columns:[{field:"Id",type:"hidden"},{title:Language.Title,field:"Title",query:!0,format:function(n){return $('<span class="link">').append(n.Title).data("data",n).click(function(){var n=$(this).data("data");Layer.open({title:n.Title,width:960,height:500,content:n.Content})})},type:"text",required:!0,lineBlock:!0,inputStyle:"width:50%"},{onlyForm:!0,title:Language.Content,field:"Content",type:"editor",required:!0,lineBlock:!0},{title:Language.Status,field:"Status"},{title:Language.PublishBy,field:"PublishBy",type:"text"},{title:Language.PublishTime,field:"PublishTime",placeholder:"yyyy-MM-dd HH:mm",type:"date"}],formToolbar:[{text:Language.Publish,icon:"fa fa-send-o",handler:function(i){i.form.save(t.PublishNotice,function(){n.loadGrid()})}}],gridOption:{where:{type:i}}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysOrganization(){var i={DeleteModels:baseUrl+"/System/DeleteOrganizations",SaveModel:baseUrl+"/System/SaveOrganization",GetOrganizations:baseUrl+"/System/GetOrganizations"},n=new Tree("treeOrganization",{url:i.GetOrganizations,onClick:function(n){if(n.children){var i=n.children.map(function(n){return n.data});t.setGridData(i)}}}),t=new View("SysOrganization",{url:i,left:n,columns:[{field:"Id",type:"hidden"},{field:"ParentId",type:"hidden"},{title:Language.Code,field:"Code",width:"100px",type:"text",required:!0},{title:Language.Name,field:"Name",width:"250px",type:"text",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],refresh:function(){n.reload();t.setGridData([])},formOption:{style:"form-block",width:600,height:300,titleInfo:function(t){var i=n.getNodeData(function(n){return n.id===t.ParentId});return i?"- "+i.Code+"|"+i.Name:""},setData:function(n){n.form.Code.setReadonly(n.data.Id!=="")}},gridOption:{page:!1,toolbar:{add:function(t){var i=n.selectedNode;if(!i){Layer.tips(Language.PleaseSelectParentOrg);return}t.addRow({Id:"",ParentId:i.id})}}}});this.render=function(n){t.render().appendTo(n)};this.mounted=function(){t.load()}}function SysPage(){var t={DeleteModels:baseUrl+"/System/DeleteModules",MoveModel:baseUrl+"/System/MoveModule",SaveModel:baseUrl+"/System/SaveModule"},n=new SysModuleTree({hideButton:!0,onClick:function(n){n.children||editor.load(n)}});this.render=function(t){var i,r,u;Utils.addJs("/libs/prettify/prettify.js");Utils.addJs("/libs/prettify/lang-css.js");i=$("<div>").addClass("fit").appendTo(t);r=$("<div>").addClass("fit-col-3").appendTo(i);n.render().appendTo(r);u=$("<div>").addClass("fit-col-7").appendTo(i)};this.mounted=function(){n.reload()}}function SysRole(){var n={QueryModels:baseUrl+"/System/QueryRoles",DeleteModels:baseUrl+"/System/DeleteRoles",SaveModel:baseUrl+"/System/SaveRole",GetRoleModules:baseUrl+"/System/GetRoleModules",SaveRoleModules:baseUrl+"/System/SaveRoleModules"},t,i=new View("SysRole",{url:n,columns:[{field:"Id",type:"hidden"},{field:"AppId",type:"hidden"},{title:Language.Name,field:"Name",width:"150px",query:!0,type:"text",required:!0,inputBlock:!0},{title:Language.Status,field:"Enabled",width:"100px",type:"checkbox",code:"Enabled",required:!0},{title:Language.Note,field:"Note",type:"textarea"}],formOption:{style:"form-block form-split",width:1024,height:450,labelWidth:60,ahtml:'<div class="form-split-view"><ul id="treeRoleRight"><\/ul><\/div>',data:{Id:"",AppId:appId,Enabled:1},setData:function(i){t=new Tree("treeRoleRight",{url:n.GetRoleModules+"?roleId="+i.data.Id,check:!0,expandAll:!0,onLoad:function(){var n=$(".tree-button").parent().parent().addClass("tree-button-ul");n.parent().addClass("tree-page-li")}})},submitData:function(){var n=t.getCheckedNodes(),i=n.map(function(n){return n.id});return{ids:JSON.stringify(i)}}},gridOption:{toolbar:{right:function(){}}}});this.render=function(n){i.render().appendTo(n)};this.mounted=function(){i.load({AppId:appId})}}function SysServer(){function i(n){Layer.open({title:Language.ThreadInfo+" - "+n.Type,width:550,height:300,content:'<div class="fit"><table id="gridThreadInfo" class="grid"><\/table><\/div>',success:function(){var t=new Grid("ThreadInfo",{columns:[{title:"ID",field:"Id"},{title:Language.Name,field:"Name"},{title:Language.Status,field:"Status",format:function(n){var t=" gray";return n.Status.indexOf("正常")>-1||n.Status.indexOf("已")>-1?t=" success":n.Status.indexOf("异常")>-1&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"}},{title:Language.Description,field:"Description"},{title:Language.ErrorMessage,field:"ErrorMessage"}]});t.setData(n.Threads)}})}var t={QueryModels:baseUrl+"/System/QueryServers"},n=new View("SysServer",{url:t,columns:[{title:Language.Customer,field:"CompName",query:!0},{title:Language.System,field:"AppId",query:!0,code:"ProductData"},{title:Language.Service,field:"Type"},{title:Language.Status,field:"Status",format:function(n){var t=" gray";return n.Status===Language.Normal&&(t=" success"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},code:[Language.BreakOff,Language.Normal]},{title:Language.ThreadCount,field:"ThreadCount",format:function(n){return $('<span class="link">').html(n.ThreadCount).data("item",n).on("click",function(){var n=$(this).data("item");i(n)})}},{title:Language.UpdateTime,field:"UpdateTime",width:"140px",placeholder:DateTimeFormat},{title:Language.StartTime,field:"CreateTime",width:"140px",placeholder:DateTimeFormat},{title:"IP",field:"IP",width:"150px",format:function(n){return n.IP+" - "+n.IPName}},{title:"MAC"+Language.Address,field:"MacAddress"}],gridOption:{page:!1}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysSetting(){var t={GetModel:baseUrl+"/System/GetSetting",SaveModel:baseUrl+"/System/SaveSetting"},n=new Form("SysSetting",{icon:"fa fa-cog",title:Language.SystemSetting,info:!0,fields:[{title:Language.CompNo,field:"CompNo",type:"text",readonly:!0},{title:Language.Product+"ID",field:"ProductId",type:"text",readonly:!0},{title:Language.CompName,field:"CompName",type:"text",required:!0,inputBlock:!0},{title:Language.ProductSerialNo,field:"ProductKey",type:"text",required:!0,inputBlock:!0},{title:Language.SystemName,field:"AppName",type:"text",required:!0,inputBlock:!0},{title:Language.ProductValidDate,field:"ValidDate",type:"text",readonly:!0,tips:"天"},{title:Language.UserDefaultPwd,field:"UserDefaultPwd",type:"text",required:!0}],toolbar:[{text:Language.Save,icon:"fa fa-check",handler:function(n){n.form.save(t.SaveModel)}}]});this.render=function(t){n.render().css({display:"block"}).appendTo(t)};this.mounted=function(){n.ValidDate.setTips("&nbsp;");$.get(t.GetModel,function(t){var i;if(n.setData(t),i=t.ValidDate,i!=="永久"){var r=Date.parse(i),u=new Date,f=parseInt((r-u)/864e5)+1,e=Utils.format(Language.ProductValidDateTip,f);n.ValidDate.setTips(e,{color:"#e00211"})}})}}function SysSite(){var t={QueryModels:baseUrl+"/System/QuerySites",DeleteModels:baseUrl+"/System/DeleteSites",SaveModel:baseUrl+"/System/SaveSite"},n=new View("SysSite",{url:t,columns:[{field:"Id",type:"hidden"},{title:"Host",field:"Host",type:"text",required:!0,format:function(n){return'<a href="http://'+n.Host+'" target="_blank">'+n.Host+"<\/i>"}},{title:"AppId",field:"AppId",type:"text",required:!0},{title:"图标",field:"AppIcon",type:"text",required:!0,format:function(n){var t="#"+Math.random().toString(16).substr(2,6);return'<i class="'+n.AppIcon+'" style="color:'+t+'"><\/i>'}},{title:"App名称",field:"AppName",type:"text",inputStyle:"width:300px",required:!0},{title:"企业编码",field:"CompNo",type:"text",required:!0},{title:"企业名称",field:"CompName",type:"text",inputStyle:"width:300px",required:!0},{title:"技术支持",field:"SupportName",type:"text",inputStyle:"width:300px"},{title:"技术支持URL",field:"SupportUrl",type:"text",inputStyle:"width:300px"},{title:"登录背景图",field:"LoginImage",type:"text",inputStyle:"width:300px"},{label:"选项",title:"状态",field:"Enabled",type:"checkbox",required:!0,align:"center",code:"Enabled"},{label:"选项",title:"顶部菜单",field:"TopMenu",type:"checkbox",required:!0,align:"center",code:"YesNo"},{title:"备注",field:"Note",type:"textarea",lineBlock:!0}],formOption:{data:{Id:"",Enabled:1}},gridOption:{autoQuery:!1,page:!1,toolButtons:["add",{name:"复制",icon:"fa fa-copy",handler:function(n){n.selectRow(function(n){var t=$.extend({},n.row,{Id:""});n.form.show(t)})}},"edit","remove"]}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysSiteMap(n){function i(n,i){var o=$("<div>").addClass("row dash-sitemap").appendTo(n),u=$("<div>").addClass("card").appendTo(o),f,r,e;if(t("<span>",u,i).addClass("dash-menu"),i.children&&i.children.length>0)for(f=$("<ul>").addClass("menu-items").appendTo(u),r=0;r<i.children.length;r++)e=i.children[r],t("<li>",f,e).click(function(){var n=$(this).data("item");showTabPage(n)})}function t(n,t,i){var r=$(n).data("item",i).appendTo(t),u=$("<span>").addClass("icon").appendTo(r);return $("<span>").addClass(i.icon).appendTo(u),$("<span>").html(i.name).appendTo(r),r}this.render=function(t){var e=n?$("<div>").addClass("fit").css("padding-top","10px").appendTo(t):t,r=top.Admin.CurrentMenu,u,f;if(r&&r.children&&r.children.length)for(u=0;u<r.children.length;u++)f=r.children[u],i(e,f)};this.mounted=function(){}}function SysTask(){var t={QueryModels:baseUrl+"/System/QueryTasks"},n=new View("SysTask",{url:t,columns:[{title:Language.Type,field:"Type",width:"100px",query:!0},{title:Language.Name,field:"Name",width:"200px",query:!0},{title:Language.ExecuteTarget,field:"Target",width:"200px"},{title:Language.ExecuteStatus,field:"Status",width:"100px",format:function(n){var t=" gray";return n.Status===Language.Executing?t=" info":n.Status===Language.ExecutePass?t=" success":n.Status===Language.ExecuteFail&&(t=" danger"),'<span class="badge'+t+'">'+n.Status+"<\/span>"},query:!0,code:[Language.PendingExecute,Language.Executing,Language.ExecutePass,Language.ExecuteFail]},{title:Language.BeginTime,field:"BeginTime",width:"140px",placeholder:DateTimeFormat},{title:Language.EndTime,field:"EndTime",width:"140px",placeholder:DateTimeFormat},{title:Language.Note,field:"Note",format:function(n){return n.Note?$('<span class="link">'+Language.Detail+"<\/span>").data("note",n.Note).on("click",function(){var n=$(this).data("note");Layer.open({title:Language.Error+Language.Detail,content:"<pre>"+n+"<\/pre>"})}):""}}],gridOption:{sortField:"CreateTime",sortOrder:"desc"}});this.render=function(t){n.render().appendTo(t)};this.mounted=function(){n.load()}}function SysUser(n){function f(n,i){var r=i===1?Language.Enable:Language.Disable;n.selectRows(function(n){var u=Utils.format(Language.ConfirmOperateUser,r);Layer.confirm(u,function(){Ajax.post(t.EnableUsers,{data:JSON.stringify(n.ids),enable:i},function(){n.grid.reload()})})})}var t={QueryModels:baseUrl+"/System/QueryUsers",DeleteModels:baseUrl+"/System/DeleteUsers",ImportModels:baseUrl+"/System/ImportUsers",SaveModel:baseUrl+"/System/SaveUser",GetOrganizations:baseUrl+"/System/GetOrganizations",SetUserPwds:baseUrl+"/System/SetUserPwds",EnableUsers:baseUrl+"/System/EnableUsers",GetUserRoles:baseUrl+"/System/GetUserRoles",SaveUserRoles:baseUrl+"/System/SaveUserRoles"},u,i=n?new Tree("treeUser",{url:t.GetOrganizations,autoLoad:!1,onClick:function(n){r.loadGrid({AppId:appId,OrgNo:n.code})}}):null,r=new View("SysUser",{url:t,left:i,columns:[{field:"Id",type:"hidden"},{field:"AppId",type:"hidden"},{field:"OrgNo",type:"hidden"},{title:Language.UserName,field:"UserName",width:"100px",query:!0,sort:!0,type:"text",required:!0},{title:Language.UserRealName,field:"Name",width:"100px",query:!0,sort:!0,type:"text",required:!0},{title:Language.EnglishName,field:"EnglishName",width:"100px",type:"text"},{title:Language.Role,field:"Role",width:"100px"},{title:Language.Gender,field:"Gender",width:"60px",align:"center",sort:!0,format:function(n){return n.Gender===Language.Male?Language.Male:'<span style="color: #F581B1;">'+Language.Female+"<\/span>"},required:!0,type:"radio",code:[Language.Male,Language.Female]},{title:Language.Phone,field:"Phone",width:"120px",type:"text"},{title:Language.Mobile,field:"Mobile",width:"120px",type:"text"},{title:Language.Email,field:"Email",width:"150px",type:"text"},{title:Language.Status,field:"Enabled",width:"60px",type:"checkbox",code:"Enabled",required:!0},{title:Language.FirstLoginTime,field:"FirstLoginTime",width:"140px",placeholder:DateTimeFormat,align:"center"},{title:Language.FirstLoginIP,field:"FirstLoginIP",width:"100px",align:"center"},{title:Language.LastLoginTime,field:"LastLoginTime",width:"140px",placeholder:DateTimeFormat,align:"center"},{title:Language.LastLoginIP,field:"LastLoginIP",width:"100px",align:"center"},{title:Language.Role,field:"Role",type:"html",lineBlock:!0,inputHtml:'<div id="chkUserRole"><\/div>',onlyForm:!0},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0}],formOption:{data:{Id:"",Enabled:1},titleInfo:function(t){var r=n?i.getNodeData(function(n){return n.id===t.OrgNo}):null;return r?'- <span class="bold">'+r.Code+"|"+r.Name+"<\/span>":""},setData:function(n){n.form.UserName.setReadonly(n.data.Id!=="");$.get(t.GetUserRoles,{userId:n.data.Id},function(n){u=new Input($("#chkUserRole"),{field:"UserRole",type:"checkbox",code:n.roles,value:n.value})})},submitData:function(){var n=u.getData();return{role:JSON.stringify(n)}}},gridOption:{autoQuery:!1,width:"1800px",toolbar:{add:function(t){var u=curUser.CompNo,r;if(n){if(r=i.selectedNode,!r){Layer.tips(Language.PleaseSelectOrg);return}u=r.data.Code}t.addRow({Id:"",AppId:appId,Enabled:1,OrgNo:u})},setPwd:function(n){n.selectRows(function(n){Layer.confirm(Language.ConfirmResetPassword,function(){Ajax.post(t.SetUserPwds,{data:JSON.stringify(n.ids)})})})},enable:function(n){f(n,1)},disable:function(n){f(n,0)}}}});this.render=function(n){r.render().appendTo(n)};this.mounted=function(){r.load({AppId:appId,OrgNo:curUser.CompNo})}}function SysUserInfo(){var n=new Tabs({fit:!0,items:[{name:Language.BaseInfo,component:new SysUserBaseInfo},{name:Language.UpdatePassword,component:new SysUserPassword},{name:Language.MyMessage,component:new SysUserMessage}]});this.render=function(t){var r=$("<div>").addClass("fit").appendTo(t),f=$("<div>").addClass("fit-col-3").appendTo(r),i=$("<div>").css({padding:"10px"}).appendTo(f),u;$("<div>").addClass("center").css({padding:"20px"}).append('<img id="userAvatar" class="circle" src="'+staticUrl+'/img/face1.png" />').appendTo(i);$("<div>").addClass("info-item").append('<i class="fa fa-user">').append('<span id="userName">').appendTo(i);$("<div>").addClass("info-item").append('<i class="fa fa-mobile" style="font-size:16px;">').append('<span id="userMobile">').appendTo(i);$("<div>").addClass("info-item").append('<i class="fa fa-envelope-o" style="font-size:11px;">').append('<span id="userEmail">').appendTo(i);$('<div id="userNote">').addClass("info-item").appendTo(i);u=$("<div>").addClass("fit-col-7").appendTo(r);n.render().appendTo(u)};this.mounted=function(){}}function SysUserBaseInfo(){var n={GetUserInfo:baseUrl+"/Home/GetUserInfo",SaveUserInfo:baseUrl+"/Home/SaveUserInfo"},t=new Form("UserInfo",{url:n.GetUserInfo,fields:[{field:"Id",type:"hidden"},{field:"AvatarUrl",type:"hidden"},{title:Language.UserName,field:"UserName",type:"text",readonly:!0},{title:Language.UserRealName,field:"Name",type:"text",required:!0},{title:Language.EnglishName,field:"EnglishName",type:"text"},{title:Language.Gender,field:"Gender",type:"radio",code:[Language.Male,Language.Female]},{title:Language.Phone,field:"Phone",type:"text"},{title:Language.Mobile,field:"Mobile",type:"text"},{title:Language.Email,field:"Email",type:"text"},{title:Language.Note,field:"Note",type:"textarea",lineBlock:!0}],setData:function(n){$("#userAvatar").attr("src",staticUrl+n.data.AvatarUrl);$("#userName").html(n.data.Name+"("+n.data.UserName+")");$("#userMobile").html(n.data.Mobile);$("#userEmail").html(n.data.Email);$("#userNote").html(n.data.Note)},onSaving:function(n){var t=n.Gender===Language.Female?"2":"1";n.AvatarUrl="/img/face"+t+".png"},toolbar:[{text:Language.ConfirmUpdate,icon:"fa fa-check",handler:function(t){t.form.save(n.SaveUserInfo)}}]});this.render=function(){return t.render()}}function SysUserPassword(){var n={UpdatePassword:baseUrl+"/Home/UpdatePassword"},t=new Form("Password",{style:"form-block",fields:[{title:Language.CurrentPassword,field:"OldPassword",type:"password",required:!0},{title:Language.NewPassword,field:"NewPassword",type:"password",required:!0,tips:Language.PasswordTips},{title:Language.NewPassword1,field:"NewPassword1",type:"password",required:!0}],toolbar:[{text:Language.ConfirmUpdate,icon:"fa fa-check",handler:function(t){t.form.save(n.UpdatePassword)}}]});this.render=function(){return t.render()}}function SysUserMessage(){function e(n,t){for(var r,i=0;i<t.length;i++)r=t[i],$("<div>").addClass("um-box-button").data("button",r).append('<i class="'+r.icon+'">').append("<span>"+r.text+"<\/span>").on("click",function(){$(".um-box-button").removeClass("active");$(this).addClass("active");var n=$(this).data("button");n.handler()}).appendTo(n)}function i(i){var r=o(i),u=new Grid("UserMessage",{url:n.QueryUserMessages,where:{Type:i},autoQuery:!1,toolButtons:r.toolButtons,columns:[{title:r.rsTitle,field:"MsgByName",width:"150px"},{title:"分类",field:"Category",width:"100px"},{title:"主题",field:"Subject"},{title:"时间",field:"CreateTime",width:"140px",placeholder:DateTimeFormat}]});t.html("");u.render().appendTo(t);Page.complete();setTimeout(function(){u.reload()},100)}function o(n){var i="",t=[];return n==="收件"?(i="发件人",t.push({name:"删除",icon:"fa fa-trash-o",handler:function(n){r(n)}}),t.push({name:"标记为",icon:"fa fa-bookmark-o",children:[{name:"已读",icon:"fa fa-envelope-open-o",handler:function(n){u(n,"已读")}},{name:"未读",icon:"fa fa-envelope-o",handler:function(n){u(n,"未读")}},{name:"全部设为已读",icon:"fa fa-envelope-open-o",handler:function(n){u(n,"全部已读")}}]})):n==="发件"?(i="收件人",t.push({name:"删除",icon:"fa fa-trash-o",handler:function(n){r(n)}})):n==="删除"&&(i="收发件人",t.push({name:"彻底删除",icon:"fa fa-trash-o",handler:function(n){r(n)}})),{rsTitle:i,toolButtons:t}}function r(t){t.deleteRows(n.DeleteUserMessages,function(){t.grid.reload()})}function u(t,i){i==="全部已读"?Layer.confirm("确定全部设为已读？",function(){Ajax.post(n.MarkUserMessages,{status:i,data:JSON.stringify(["1"])},function(){t.grid.reload()})}):t.selectRows(function(r){Ajax.post(n.MarkUserMessages,{status:i,data:JSON.stringify(r.ids)},function(){t.grid.reload()})})}var n={QueryUserMessages:baseUrl+"/System/QueryUserMessages",DeleteUserMessages:baseUrl+"/System/DeleteUserMessages",MarkUserMessages:baseUrl+"/System/MarkUserMessages"},t,f=[{text:"收件箱",icon:"fa fa-sign-in",handler:function(){i("收件")}},{text:"已发送",icon:"fa fa-sign-out",handler:function(){i("发件")}},{text:"已删除",icon:"fa fa-trash-o",handler:function(){i("删除")}}];this.render=function(){var n=$("<div>").addClass("fit"),i=$("<div>").addClass("um-box-left").appendTo(n);return e(i,f),t=$("<div>").addClass("um-box-right").appendTo(n),n};this.mounted=function(){$(".um-box-button:eq(0)").click()}}function Dashboard(){function r(){var n=Page[appId+"Dashboard"];return n&&n.component?n.component:new f}function f(){function c(i){var r=n(i,"75%"),l=$("<div>").addClass("row").appendTo(r),a=$("<div>").addClass("card").appendTo(l),e,o,h,c;Dashboard.createIconCards(a,s);e=$("<div>").addClass("row").appendTo(r);Dashboard.createTodoList(e,{height:"200px"});t=Dashboard.createNotice(e,{height:"200px"});o=$("<div>").addClass("row").appendTo(r);h=n(o,"50%");u.render(h);c=n(o,"50%");f.render(c)}function l(t){var u=n(t,"25%"),e=h(u),f;i=Dashboard.createShortcut(e,{height:"351px"});f=h(u);r=Dashboard.createCommLink(f,{height:"300px"})}function h(n){return $("<div>").addClass("row").css("padding-left","0").appendTo(n)}function n(n,t){return $("<div>").css({float:"left",width:t}).appendTo(n)}var a={GetCount:baseUrl+"/Home/GetCount"},t,i,r,u=new e,f=new o,s=[{id:"AppCount",name:"应用",icon:"fa fa-product-hunt",value:0,width:"25%",style:{backgroundColor:"#00c0ef"},targetPage:"SysApp"},{id:"ModuleCount",name:"资源",icon:"fa fa-th-list",value:0,width:"25%",style:{backgroundColor:"#00a65a"},targetPage:"SysModule"},{id:"UserCount",name:"用户",icon:"fa fa-user",value:0,width:"25%",style:{backgroundColor:"#dd4b39"},targetPage:"SysOrgUser"},{id:"LogCount",name:"日志",icon:"fa fa-commenting-o",value:0,width:"25%",style:{backgroundColor:"#f0ad4e"},targetPage:"SysLog"}];this.sysOption={icons:s};this.render=function(n){c(n);l(n)};this.mounted=function(){$.get("",function(n){for(var t in n)$("#"+t+" h3").html(n[t])});t.load();i.load();r.load();u.load();f.load()}}function e(){this.render=function(n){new Card({icon:"fa fa-line-chart",title:"分析1",style:{marginRight:"5px"},body:'<div id="chartFlow" style="height:300px;">'}).render().appendTo(n)};this.load=function(){var n=new Chart("chartFlow");n.setOption({title:{left:"center",text:""},tooltip:{trigger:"axis"},legend:{data:["PV","UV"]},xAxis:{splitLine:{show:!1},data:["06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"]},yAxis:{},series:[{name:"PV",type:"line",data:[111,222,333,444,555,666,3333,33333,55555,66666,33333,3333,6666,11888,26666,38888,56666,42222,39999,28888,17777,9666,6555,5555,3333,2222,3111,6999,5888,2777,1666,999,888,777]},{name:"UV",type:"line",data:[11,22,33,44,55,66,333,3333,5555,12666,3333,333,666,1188,2666,3888,6666,4222,3999,2888,1777,966,655,555,333,222,311,699,588,277,166,99,88,77]}]})}}function o(){this.render=function(n){new Card({icon:"fa fa-pie-chart",title:"分析2",style:{marginLeft:"5px"},body:'<div id="chartBrowser" style="height:300px;">'}).render().appendTo(n)};this.load=function(){var n=new Chart("chartBrowser");n.setOption({title:{left:"center",text:""},tooltip:{trigger:"item"},legend:{data:["Chrome","Firefox","IE 8.0","Safari","其它浏览器"]},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","50%"],data:[{value:9052,name:"Chrome"},{value:1610,name:"Firefox"},{value:3200,name:"IE 8.0"},{value:535,name:"Safari"},{value:1700,name:"其它浏览器"}]}]})}}var n,t,i=[{text:"站点地图",icon:"fa fa-sitemap",component:function(){return new MySiteMap},isDefault:!0},{text:"仪表盘",icon:"fa fa-tachometer",component:function(){return r()}}];this.render=function(t){var i=$("<div>").addClass("fit").css("padding-top","10px").appendTo(t);n=r();n.render(i)};this.mounted=function(){n.mounted()}}var ExtForm,Layer,isloadOssJs,app;const DateFormat="yyyy-MM-dd",DateTimeFormat="yyyy-MM-dd HH:mm:ss";Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};WsUtil.getUrl=function(n,t){var i,r,u;if(n.indexOf("ws://")>-1||n.indexOf("wss://")>-1||(i=location.protocol==="https:"?"wss://":"ws://",n.indexOf(location.host)<0&&(i+=location.host),n=i+n),t){n+=n.indexOf("?")<0?"?":"&";r=[];for(u in t)r.push(u+"="+t[u]);n+=r.join("&")}return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?"":decodeURI(t[2])},getClientId:function(){var r=function(n){var t="";for(i=0;i<n.length;i++)t+=u(n.charCodeAt(i));return t},u=function(n){for(var t=n.toString(16),i=0;i+t.length<4;)t="0"+t,i++;return t},t=document.createElement("canvas"),n=t.getContext("2d");n.font="14px Arial";n.fillStyle="#ccc";n.fillText("Known_Client",2,2);var f=t.toDataURL().replace("data:image/png;base64,",""),e=window.atob(f);return r(e.slice(-16,-12))},addCss:function(n){var i=document.createElement("link"),t;i.rel="stylesheet";t=$('link[href*="static/libs/"]');t.length||(t=$('link[href*="static/"]'));t.length?i.href=baseUrl+"/static"+n:(t=$('link[href*="libs/"]'),t.length||(t=$('link[href*="css/"]')),i.href=baseUrl+n);t.last().after($(i))},addJs:function(n){var i=document.createElement("script"),t=$('script[src*="static/libs/"]');t.length||(t=$('script[src*="static/"]'));t.length?i.src=baseUrl+"/static"+n:(t=$('script[src*="libs/"]'),t.length||(t=$('script[src*="js/"]')),i.src=baseUrl+n);t.last().after($(i))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},keyUser:"Known_User",keyCode:"Known_Codes",setUser:function(n){var t=this.keyUser;n?sessionStorage.setItem(t,JSON.stringify(n)):sessionStorage.removeItem(t)},getUser:function(){var n=sessionStorage.getItem(this.keyUser);return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){var t=this.keyCode;n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return n==="YesNo"?[{Code:1,Name:Language.Yes},{Code:0,Name:Language.No}]:n==="HasNot"?[{Code:1,Name:Language.Has},{Code:0,Name:Language.Not}]:n==="Enabled"?[{Code:1,Name:Language.Enable},{Code:0,Name:Language.Disable}]:(r=localStorage.getItem(this.keyCode),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion||this.addJs("/libs/region.js");n.form.Province.setData(window.PCARegion,n.data.Province);n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area&&n.form.Area.setData([])});n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City));n.form.Area&&(n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)}),n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area)))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&$("<i>").addClass(n.icon).appendTo(i);n.style&&i.addClass(n.style);$("<span>").html(n.text||n.name).appendTo(i);i.on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i},parseDom:function(n,t,i){typeof t=="function"?t(i):n.append(t)}},Ajax={get:function(n,t,i){var r=Layer.loading(Language.Loading+"......");$.get(n,t,function(n){r.close();n.Message&&Layer.tips(n.Message);n.IsValid?i&&i(n.Data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading(Language.Submitting+"......");$.post(n,t,function(n){r.close();n.IsValid?(Layer.tips(n.Message),i&&i(n.Data)):n.Message?Layer.alert(n.Message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.IsValid?(Layer.tips(n.Message),r&&r(n.Data)):n.Message?Layer.alert(n.Message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f="Known-Download",e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$("<form>").attr("method","post").attr("action",n).attr("target","").appendTo("body").hide(),u;if($("<input>").attr("type","hidden").attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$("<input>").attr("type","hidden").attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},Page={complete:function(){initDropdown();$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$('[placeholder="'+DateFormat+'"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd"})});$('[placeholder="yyyy-MM-dd HH:mm"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd hh:ii",pickTime:!0})});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser();$(document).ajaxSend(function(n,t){t.setRequestHeader("Known-Token",curUser?curUser.Token:"");t.setRequestHeader("Known-Client",Utils.getClientId())});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.app.login():i.error&&app.route({component:new Error(i)}))}});$(document).contextmenu(function(n){n.preventDefault()});$(function(){Page.complete()});ExtForm=window.ExtForm={};Form.bind=function(n,t,i){var f,u,r,e,o,s;for(f in t)u=n.find('[name="'+f+'"]'),u.length&&(r=t[f],e=u.attr("placeholder"),e&&(o=r instanceof Date?r:new Date(r),r=o.format(e)),s=u[0].nodeName,"DIV,P,SPAN,TD".indexOf(s)>-1?u.html(r):u.val(r),i&&i({elem:u,value:r,data:t}))};Picker.action={};GridManager.isLoadXlsx=!1;Chart.isLoad=!1;$.extend(Page,{Error500:{component:new Error({type:"500"})},Error403:{component:new Error({type:"403"})},Error404:{component:new Error({type:"404"})}});Picker.action.icon={title:"选择图标",type:"component",component:new IconPicker,valueField:"Icon",textField:"Icon"};Layer={index:1e4,page:function(n){return this._show("page",n)},open:function(n){return n.showMax=n.showMax===undefined?!0:n.showMax,this._show("dialog",n)},loading:function(n){var i,e;if(n=n||"",n==="")return{close:function(){}};var r=this,t=r.index++,u="mask"+t,f="load"+t;return $("<div>").addClass("mask").attr("id",u).css({zIndex:t}).appendTo($("body")),i=$("<div>").addClass("loading").attr("id",f).append('<i class="fa fa-spinner fa-spin fa-1x fa-fw">').append(n),e=i.outerWidth(),i.css({marginLeft:-(e/2)+"px",zIndex:t+1}).appendTo($("body")),{close:function(){$("#"+u+",#"+f).remove();r.index--}}},tips:function(n){var t,i,r;(n=n||"",n!=="")&&(t=$(".tips"),t.length||(t=$("<div>").addClass("tips").css({zIndex:this.index}).appendTo($("body"))),t.html(n),i=t.outerWidth(),r=t.outerHeight(),t.css({marginLeft:-(i/2)+"px",marginTop:-(r/2)+"px"}),setTimeout(function(){t.remove()},3e3))},alert:function(n,t){var i=this,r=56,u=i._show("dialog",{showMax:!1,icon:"fa fa-info-circle",title:Language.Tips,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:r+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();u.close()})}})},confirm:function(n,t){var i=this,u=56,r=i._show("dialog",{showMax:!1,icon:"fa fa-question-circle",title:Language.Confirm,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:u+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();r.close()});$("<span>").css({width:"20px",display:"inline-block"}).appendTo(n);i._createCancel(n,function(){r.close()})}})},changeMax:function(n,t,i,r){n.data("isMax")?(n.data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),t.removeClass(i).attr("style",n.data("layerStyle"))):(n.data("isMax",!0).data("layerStyle",t.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),t.addClass(i).attr("style","").css({zIndex:r}))},_createOK:function(n,t){$("<button>").addClass("ok").html(Language.OK).appendTo(n).on("click",t)},_createCancel:function(n,t){$("<button>").addClass("cancel").html(Language.Cancel).appendTo(n).on("click",t)},_show:function(n,t){function g(n){return $("<i>").addClass("fa fa-window-maximize maximize").data("isMax",!1).appendTo(n).click(function(){o.changeMax($(this),i,"dialog-max",f+1)})}function c(n){$("<i>").addClass("fa fa-close close").appendTo(n).click(w)}function w(){s.close();t.onClose&&t.onClose()}function nt(n){n.mousedown(function(n){n.preventDefault();r.move=!0;r.offset=[n.clientX-parseFloat(i.css("left")),n.clientY-parseFloat(i.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),r.move){var t=n.clientX-r.offset[0],u=n.clientY-r.offset[1];i.css({left:t,top:u})}}).mouseup(function(){delete r.move})}function b(n,i){if(t.content)i&&n.css({overflow:"auto"}),k(n,t.content);else if(t.url)t.partial?(i&&n.css({overflow:"auto"}),n.load(t.url)):(i||n.css({padding:0,overflow:"hidden"}),$("<iframe>").attr("frameborder","0").attr("src",t.url).appendTo(n));else if(t.component){var r=new Router(n);r.route(t)}}function tt(n){var i=$("<div>").addClass("dialog-footer");t.footer?(i.appendTo(n),k(i,t.footer)):t.buttons?(i.appendTo(n),$(t.buttons).each(function(n,t){$("<button>").addClass("ok").append(t.text).on("click",function(){t.handler&&t.handler.call(this,s)}).appendTo(i)}),o._createCancel(i,w)):h.css({bottom:0})}function k(n,t){typeof t=="function"?t(n):n.append(t)}var o=this,f=o.index++,y="mask"+f,p="layer"+f,i,s,r,l,a,v,d,u,h,e;return $("<div>").attr("id",y).addClass("mask").css({zIndex:f}).appendTo($("body")),i=$("<div>").attr("id",p).addClass(n).css({zIndex:f+1}).appendTo($("body")),s={index:f,layer:i,close:function(){$("#"+y+",#"+p).remove();o.index--}},r={},n==="dialog"?(l=t.width||500,a=t.height||300,i.css({width:l+"px",height:a+"px",marginTop:-(a/2)+"px",marginLeft:-(l/2)+"px"}),e=$("<div>").addClass("dialog-content").appendTo(i),t.title?(d=t.icon||"fa fa-window-maximize",u=$("<div>").addClass("dialog-header"),$("<i>").addClass("icon "+d).appendTo(u),u.append(t.title),nt(u),t.showMax&&(v=g(u)),c(u),e.append(u)):t.showClose&&c(i),h=$("<div>").addClass("dialog-body").appendTo(e),t.title||h.css({top:0}),b(h,!1),tt(e),t.max&&v&&v.click()):(e=$("<div>").addClass("page-content").appendTo(i),c(i),b(e,!0)),t.success&&t.success(),s}};isloadOssJs=!1;OssClient.config={region:"",accessKeyId:"",accessKeySecret:"",bucket:""};app=new App("app",{});const BizFileDeleteUrl=baseUrl+"/System/DeleteFile",BizFileDownloadUrl=baseUrl+"/System/DownloadFile";BizFile.download=function(n){Ajax.download(BizFileDownloadUrl,{id:n})};BizFile.delete=function(n){Layer.confirm(Language.ConfirmDeleteFile,function(){Ajax.post(BizFileDeleteUrl,{id:n})})};var BizFlow={url:{GetFlowTodos:baseUrl+"/System/GetFlowTodos",GetFlowLogs:baseUrl+"/System/GetFlowLogs",AssignFlow:baseUrl+"/System/AssignFlow",SubmitFlow:baseUrl+"/System/SubmitFlow",RevokeFlow:baseUrl+"/System/RevokeFlow",ReturnFlow:baseUrl+"/System/ReturnFlow",StopFlow:baseUrl+"/System/StopFlow"},logColumns:[{title:Language.ExecuteStep,field:"StepName",width:"100px"},{title:Language.ExecuteBy,field:"ExecuteBy",width:"100px"},{title:Language.ExecuteTime,field:"ExecuteTime",width:"140px",placeholder:DateTimeFormat},{title:Language.ExecuteAction,field:"Result",width:"100px",format:function(n){return'<span class="badge">'+n.Result+"<\/span>"}},{title:Language.ExecuteContent,field:"Note"}],getStatusColor:function(n){return n?n.indexOf("暂存")>-1||n.indexOf("关闭")>-1?" gray":n.indexOf("撤回")>-1?" warning":n.indexOf("退回")>-1||n.indexOf("删除")>-1?" danger":n.indexOf("通过")>-1||n.indexOf("中")>-1?" success":n.indexOf("待")>-1||n.indexOf("已")>-1?" info":"":""},loadTodos:function(n){var t=this;$("#"+n).addClass("grid").html('<table id="gridFlowTask"><\/table>');new Grid("FlowTask",{url:t.url.GetFlowTodos,page:!1,fixed:!1,showCheckBox:!1,columns:[{title:Language.Type,field:"FlowName",width:"100px"},{title:Language.Status,field:"BizStatus",width:"80px",format:function(n){var i=t.getStatusColor(n.BizStatus);return'<span class="badge'+i+'">'+n.BizStatus+"<\/span>"}},{title:Language.Task,field:"BizName",format:function(n){var t=$('<span class="link">').data("url",n.BizUrl).html(n.BizName);if(n.BizUrl.indexOf("js:")>-1)t.on("click",function(){var n=$(this).data("url").substr(3);eval("("+n+")")});else t.on("click",function(){location=baseUrl+$(this).data("url")});return t}}]})},loadLogs:function(n,t){var i=typeof n=="string"?$("#"+n):n,r,u,f;i.addClass("flow-log").html("").append("<h2>"+Language.FlowRecord+"<\/h2>");r=this.url.GetFlowLogs+"?bizId="+t;u=[];Utils.checkMobile()?(u=[{title:Language.FlowStep,field:"StepName",format:function(n){var t=new Date(n.ExecuteTime).format(DateTimeFormat),i='<div class="flow-name"><span class="flow-step">'+n.StepName+"<\/span>"+n.ExecuteBy+"（"+t+"）<\/div>";return i+('<div class="flow-note">'+n.Note+"<\/div>")}}],f=new Grid({url:r,columns:u}),f.render().appendTo(i)):(i.append('<table id="gridFlowLog"><\/table>'),new Grid("FlowLog",{page:!1,fixed:!1,showCheckBox:!1,url:r,columns:this.logColumns}))},assignData:{},assign:function(n,t){var i=this;this._openForm({title:Language.Assign,height:250,fields:[{title:Language.AssignTo,field:"UserName",type:"picker",pick:{action:"user"},required:!0},{title:Language.Note,field:"Note",type:"textarea"}],data:i.assignData,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.AssignFlow,{bizId:n,userName:r.data.UserName,note:r.data.Note},function(){t&&t();r.layer.close()})}})},submitData:{},submit:function(n,t){var i=this;this._openForm({title:Language.Submit,height:250,fields:[{title:Language.SubmitTo,field:"UserName",type:"picker",pick:{action:"user"},required:!0},{title:Language.Note,field:"Note",type:"textarea"}],data:i.submitData,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.SubmitFlow,{bizId:n,userName:r.data.UserName,note:r.data.Note},function(){t&&t();r.layer.close()})}})},revoke:function(n,t){var i=this;this._openForm({title:Language.Revoke,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.RevokeFlow,{bizId:n,reason:r.data.Reason},function(){t&&t();r.layer.close()})}})},"return":function(n,t,i){var r=this;this._openForm({title:Language.Return,callback:function(u){typeof n=="function"?n(u):Ajax.post(r.url.ReturnFlow,{bizId:n,bizStatus:t,reason:u.data.Reason},function(){i&&i();u.layer.close()})}})},stop:function(n,t){var i=this;this._openForm({title:Language.Stop,callback:function(r){typeof n=="function"?n(r):Ajax.post(i.url.StopFlow,{bizId:n,reason:r.data.Reason},function(){t&&t();r.layer.close()})}})},_openForm:function(n){var t;n.fields||(n.fields=[{title:n.title+Language.Reason,field:"Reason",type:"textarea",required:!0}]);n.success=function(n){t=n.form};n.buttons=[{text:Language.OK,handler:function(i){if(t.validate()){var r=n.confirmText||Language.OK+n.title+"？";Layer.confirm(r,function(){var r=t.getData();n.callback&&n.callback({layer:i,data:r})})}}}];BizForm.open(n)}},BizForm={open:function(n){var i=$("<div>").addClass("form form-block"),t=n.width;t||(t=Utils.checkMobile()?300:400);Layer.open({title:n.title,width:t,height:n.height||200,content:i,success:function(){var t=new Form(i,{fields:n.fields});n.data&&t.setData(n.data);n.success&&n.success({form:t})},buttons:n.buttons})},close:function(n,t){var i;this.open({title:n,fields:[{title:Language.Close+Language.Reason,field:"Reason",type:"textarea",required:!0}],success:function(n){i=n.form},buttons:[{text:Language.OK,handler:function(r){i.validate()&&Layer.confirm(Language.OK+n+"？",function(){r.close();var n=i.getData();t&&t(n.Reason)})}}]})}},BizHistory={url:{GetUserHistory:baseUrl+"/Home/GetUserHistory"},data:{},init:function(){var n=this;$.get(n.url.GetUserHistory,function(t){t&&(n.data=$.isPlainObject(t)?t:JSON.parse(t))})}},Log={url:{GetLogs:baseUrl+"/System/GetLogs"},open:function(n){var i=this,t=$("<div>");Layer.open({title:n.title||Language.OperateLog,width:n.width,height:n.height,content:t,success:function(){i.load(t,n.bizId)}})},load:function(n,t){var i=typeof n=="string"?$("#"+n):n,r,u;i.addClass("log").html("");$("<h2>").html(Language.OperateLog).appendTo(i);r=this.url.GetLogs+"?bizId="+t;u=[{title:Language.OperateType,field:"Type",width:"100px"},{title:Language.OperateBy,field:"CreateBy",width:"100px"},{title:Language.OperateTime,field:"CreateTime",width:"140px",placeholder:DateTimeFormat},{title:Language.OperateContent,field:"Content"}];$("<table>").attr("id","gridSysLog").appendTo(i);new Grid("SysLog",{page:!1,fixed:!1,showCheckBox:!1,url:r,columns:u})}},BizPreview={pdf:function(n,t){typeof PDFObject=="undefined"&&Utils.addJs("/libs/pdfobject.min.js");PDFObject.embed(t,"#"+n)},tiff:function(n,t){typeof Tiff=="undefined"&&Utils.addJs("/libs/tiff.min.js");n.html(Language.Loading+"......");var i=new XMLHttpRequest;i.responseType="arraybuffer";i.open("GET",t);i.onload=function(){var t=new Tiff({buffer:i.response}),r=t.toCanvas();n.html("").append(r)};i.send()}},KBMap={isLoad:!1,ak:"stivIs1QN5tRtrmycPDBKREhfGDigZKN",url:"https://api.map.baidu.com/api?v=3.0&ak=",id:"",option:{},style:{dark:{styleJson:[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.icon",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#2da0c6",visibility:"on"}}]},light:{styleJson:[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}}]}},load:function(){if(!this.isLoad){var t=this.url+this.ak+"&callback=KBMap.initMap",n=document.createElement("script");n.src=t;document.body.appendChild(n);this.isLoad=!0}},init:function(n,t){this.id=n;this.option=t;this.isLoad?this.initMap():this.load()},setMap:function(n,t){this._initMap(n,t)},initMap:function(){this.id&&this._initMap(this.id,this.option)},_initMap:function(n,t){var i=new BMap.Map(n);i.setMapStyle(this.style[t.style||"light"]);t.callback&&t.callback(i)}};KBMap.createSelectMapButton=function(n){function t(n,t){return $("<button>").html(Language.Select).click(function(){var r,f,u;f=Layer.open({title:Language.SelectCoordinate,width:650,height:350,content:function(n){var i=$("<div>").appendTo(n);u=$("<input>").attr("type","text").attr("id","mapKey").css({width:"200px",marginRight:"2px"}).appendTo(i);$("<button>").html(Language.Query).appendTo(i).on("click",function(){var n=new BMap.LocalSearch(r,{renderOptions:{map:r}}),t=document.getElementById("mapKey").value;n.search(t)});$("<div>").attr("id",t).addClass("fit").css({top:"40px",zIndex:"99999"}).appendTo(n)},success:function(){r=new BMap.Map(t,{enableMapClick:!1});r.enableScrollWheelZoom(!0);r.enableContinuousZoom();r.setDefaultCursor("default");r.setDraggingCursor("default");r.addEventListener("click",function(t){r.clearOverlays();n.Longitude.setValue(t.point.lng);n.Latitude.setValue(t.point.lat);f.close()});var h=n.Longitude.getValue(),c=n.Latitude.getValue(),e=n.Province?n.Province.getValue():"",o=n.City?n.City.getValue():"",s=n.Area?n.Area.getValue():"";h&&c?i(r,h,c):s?(u.val(s),r.centerAndZoom(s,13)):o?(u.val(o),r.centerAndZoom(o,10)):e&&(u.val(e),r.centerAndZoom(e,8))}})})}function i(n,t,i){var r=new BMap.Point(t,i),u;n.centerAndZoom(r,15);u=new BMap.Marker(r);n.addOverlay(u)}t(n.form,"mapContainer").appendTo(n.parent);KBMap.load()};KBMap.setBoundary=function(n,t){var i=new BMap.Boundary;i.get(t,function(t){var f=t.boundaries.length,i,r,u;if(f===0){alert(Language.NoCurrentAreaTips);return}for(i=[],r=0;r<f;r++)u=new BMap.Polygon(t.boundaries[r],{strokeWeight:2,strokeColor:"#014F99",fillColor:"#DDE4F0"}),n.addOverlay(u),i=i.concat(u.getPath());n.setViewport(i)})};KBMap.addMapMarker=function(n,t,i){var u=new BMap.Point(t.Longitude,t.Latitude),r=new BMap.Marker(u);n.addOverlay(r);r.setTitle(t.Name);r.addEventListener("click",function(){i&&i(t)})};$.extend(Page,{SysApp:{component:new SysApp}});$.extend(Page,{SysDictionary:{component:new SysDictionary}});$.extend(Page,{SysError:{component:new SysError}});$.extend(Page,{SysFile:{component:new SysFile}});$.extend(Page,{SysFlow:{component:new SysFlow}});$.extend(Page,{SysJob:{component:new SysJob}});$.extend(Page,{SysLog:{component:new SysLog}});$.extend(Page,{SysModule:{component:new SysModule}});$.extend(Page,{SysNoRule:{component:new SysNoRule}});$.extend(Page,{SysNotice:{component:new SysNotice}});Picker.action.organization={title:Language.SelectOrganization,type:"tree",width:350,height:350,url:baseUrl+"/System/GetOrganizations"};$.extend(Page,{SysOrganization:{component:new SysOrganization}});$.extend(Page,{SysPage:{component:new SysPage}});$.extend(Page,{SysRole:{component:new SysRole}});$.extend(Page,{SysServer:{component:new SysServer}});$.extend(Page,{SysSetting:{component:new SysSetting}});$.extend(Page,{SysSite:{component:new SysSite}});$.extend(Page,{SysSiteMap:{component:new SysSiteMap(!0)}});$.extend(Page,{SysTask:{component:new SysTask}});Picker.action.user={title:Language.SelectUser,url:baseUrl+"/System/QueryUsers",where:{OrgNo:curUser.CompNo},columns:[{title:Language.UserName,field:"UserName",width:"100px",query:!0},{title:Language.UserRealName,field:"Name",width:"100px",query:!0},{title:Language.Mobile,field:"Mobile",width:"120px"},{title:Language.Email,field:"Email",width:"150px"}],valueField:"UserName",textField:"Name"};$.extend(Page,{SysUser:{component:new SysUser(!1)},SysOrgUser:{component:new SysUser(!0)}});$.extend(Page,{SysUserInfo:{component:new SysUserInfo}});Dashboard.createIconCards=function(n,t){if(t&&t.length>0)for(var i=0;i<t.length;i++)new IconCard(t[i]).render().appendTo(n)};Dashboard.createTodoList=function(n,t){var i=$("<div>").css({float:"left",width:"50%"}).appendTo(n);new Card({icon:"fa fa-tasks",title:Language.PeddingTask,style:{marginRight:"5px"},callback:function(n){n.body.css("height",t.height);n.body.html('<div id="todoList">')}}).render().appendTo(i);BizFlow.loadTodos("todoList")};Dashboard.createNotice=function(n,t){var r=$("<div>").css({float:"left",width:"50%"}).appendTo(n),i;return new Card({icon:"fa fa-bell-o",title:Language.Notice,style:{marginLeft:"5px"},tool:'<span class="toolNotice">'+Language.More+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<div id="noticeList">');n.header.find(".toolNotice").on("click",function(){i.more()})}}).render().appendTo(r),i=new NoticeList("noticeList")};Dashboard.createShortcut=function(n,t){var i;return new Card({icon:"fa fa-external-link",title:Language.Shortcut,tool:'<span class="toolShortcut">'+Language.Set+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<ul id="ulShortcut">');n.header.find(".toolShortcut").on("click",function(){i.add()})}}).render().appendTo(n),i=new UserLink("ulShortcut","shortcut")};Dashboard.createCommLink=function(n,t){var i;return new Card({icon:"fa fa-external-link",title:Language.CommonLink,tool:'<span class="toolCommlink">'+Language.Add+"<\/span>",callback:function(n){n.body.css("height",t.height);n.body.html('<ul id="ulLink">');n.header.find(".toolCommlink").on("click",function(){i.add()})}}).render().appendTo(n),i=new UserLink("ulLink","commlink")};$.extend(Page,{Dashboard:{component:new Dashboard}});