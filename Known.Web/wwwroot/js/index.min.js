function log(n){console.log(n)}function loginByToken(n){$.post("/signToken",{token:n},function(n){n.IsValid?location="/":$("#app").html(n.Message)})}function registerWorker(){navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js")}function initDropdown(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()})}function WsUtil(){var n=null,i=!1,t=this;this.connectById=function(n,t,i){window[n]={};this.connect(baseUrl+"/ws?id="+n,t,function(n){if(n&&n.length){var t=JSON.parse(n);i&&i(t)}})};this.connect=function(r,u,f){return r=WsUtil.getUrl(r,u),log(Language.Connecting+"......"),n=new WebSocket(r),n.onopen=function(){log(Language.ClientConnected)},n.onmessage=function(n){n.data&&f&&f(n.data)},n.onclose=function(){i||(log(Language.ClientDisconnected),t.connect(r,u,f))},n.onerror=function(n){log(n);t.close()},window.onbeforeunload=function(){t.close()},n};this.send=function(t){n&&n.send(t)};this.close=function(){i=!0;n&&(n.close(),n=null,log(Language.ClientClosed))}}function Form(n,t){function ut(){i.tabs?at(i.tabs):yt();i.style&&h.addClass(i.style);i.ahtml&&Utils.parseDom(e,i.ahtml,e);u.body=e;pt(h);i.toolbar&&i.toolbar.length?ft(i.toolbar):e.css({bottom:0});i.url?ot(i.url):i.data&&u.setData(i.data)}function at(n){var t,i,f;for(r.addClass("tabs tabs-fit tabs-form"),s=$("<div>").addClass("tabs-header").appendTo(r),c=$("<div>").addClass("tabs-title").appendTo(s),v=$("<ul>").appendTo(s),d=$("<div>").addClass("right-toolbar").appendTo(s),y=$("<div>").addClass("tabs-body").appendTo(r),e=$("<div>").attr("id",rt+"0").addClass("tabs-item active").css("padding","0").appendTo(y),h=$("<div>").addClass("form").appendTo(e),t=0;t<n.length;t++)i=n[t],i.index=t,f=$("<li>").append(i.name).appendTo(v).data("item",i).on("click",function(){var n=$(this).data("item"),t;if(vt($(this),n),t=u.getData(),n.onClick)n.onClick({head:t,item:n.component});else n.component&&n.component.load&&n.component.load({head:t,isDetail:it})}),t===0&&f.addClass("active")}function vt(n,t){v.find("li").removeClass("active");n.addClass("active");var u=t.index||0,r=rt+u,i=$("#"+r);i.length||(i=$("<div>").attr("id",r).addClass("tabs-item").appendTo(y),new Router(i,{}).route(t));$(".tabs-item",y).removeClass("active");i.addClass("active")}function yt(){if(i.card?r.addClass("form-card"):i.info&&r.addClass("form-info"),r.hasClass("form-card"))s=$("<div>").addClass("form-card-header").appendTo(r),c=$("<div>").addClass("form-title").appendTo(s),d=$("<div>").addClass("right-toolbar").appendTo(s),e=$("<div>").addClass("form-card-body").appendTo(r),h=$("<div>").addClass("form").appendTo(e);else if(r.hasClass("form-info")){var n=i.icon||"fa fa-window-maximize";s=$("<div>").addClass("form-info-header").appendTo(r);c=$("<div>").append('<i class="'+n+'">').append(i.title).appendTo(s);e=$("<div>").addClass("form-info-body").appendTo(r);h=$("<div>").addClass("form").appendTo(e)}else e=r,h=r.length?r:$("<div>").addClass("form").appendTo(e)}function pt(n){var s,f,t,e,u,h;if(i.fields&&i.fields.length)s=i.fields.filter(function(n){return n.type&&n.type!==""}),wt(n,s);else for(f=r.find("input,select,textarea"),t=0;t<f.length;t++)e=$(f[t]),u=e.attr("name"),u&&u.length&&(h=o.filter(function(n){return n.name===u}),h.length||w(new Input(e)))}function ft(n){r.hasClass("form-card")?(f||(f=$("<div>").addClass("form-card-footer").appendTo(r)),f.html(""),et(f,n),Utils.createButton({icon:"fa fa-close",text:Language.Close,style:"fbClose danger",handler:function(){u.close()}}).appendTo(f)):(f||(f=$("<div>").addClass("form-button").appendTo(h),i.labelWidth&&f.css({marginLeft:i.labelWidth+20+"px"})),f.html(""),et(f,n))}function et(n,t){for(var r,f,i=0;i<t.length;i++)r=t[i],f=Utils.createButton(r,{form:u}).appendTo(n),r.detail&&(f.addClass("fbDetail"),nt.push({elem:f,item:r}))}function ot(n){i.isPrint?$.ajax({url:n,"async":!1,success:function(n){u.setData(n)}}):Ajax.get(n,null,function(n){u.setData(n)})}function wt(n,t){var f,i,r,e;for(n.html(""),f=0;f<t.length;f++)(i=t[f],i.visible===undefined||i.visible)&&(i.form=u,i.type==="hidden"?(e=new Input(n,i),w(e)):(i.label?k[i.label]?r=k[i.label]:(r=ht(n,i),k[i.label]=r):r=ht(n,i),i.type==="html"?st(i,r):(e=new Input(r,i),w(e),st(i,r)),i.tips&&$("<span>").addClass("form-tips").html(i.tips).appendTo(r)))}function st(n,t){n.inputHtml&&Utils.parseDom(t,n.inputHtml,{form:u,field:n,parent:t})}function ht(n,t){var e=t.label||t.title||"";e.length&&(e+="：");var u=$("<div>").addClass("form-item").appendTo(n),o=$("<label>").addClass("form-label").html(e).appendTo(u),f=$("<div>").addClass("form-input").appendTo(u),s=r.hasClass("form-block");return t.itemStyle&&u.addClass(t.itemStyle),t.inputStyle&&f.addClass(t.inputStyle),(t.lineBlock||s&&t.type==="textarea")&&u.addClass("block"),(t.inputBlock||!s&&t.type==="textarea")&&f.addClass("block"),t.colSpan&&u.addClass(t.colSpan),t.required&&o.addClass("required"),i.labelWidth&&(o.css({width:i.labelWidth+"px"}),(t.inputBlock||t.lineBlock||t.type==="textarea")&&f.css({marginLeft:i.labelWidth+20+"px"})),f}function w(n){o.push(n);u[n.name]=n}function bt(n,t){function u(n){n.mousedown(function(n){n.preventDefault();i.move=!0;i.offset=[n.clientX-parseFloat(r.css("left")),n.clientY-parseFloat(r.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),i.move){var t=n.clientX-i.offset[0],u=n.clientY-i.offset[1];r.css({left:t,top:u})}}).mouseup(function(){delete i.move})}n.html("");var i={};t?($("<i>").addClass("fa fa-window-maximize maximize").data("isMax",!1).appendTo(n).click(function(){Layer.changeMax($(this),r,"form-dialog-max",Layer.index+1)}),u(s)):$("<i>").addClass("fa fa-chevron-up").appendTo(n).click(function(){r.hasClass("collapse")?(r.removeClass("collapse"),$(this).removeClass("fa-chevron-down").addClass("fa-chevron-up")):(r.addClass("collapse"),$(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"))});$("<i>").addClass("fa fa-close close").appendTo(n).click(ct)}function g(n,o,h){var w,ft,k,y,p,g,rt,ut,et;tt=!0;it=o;n=n||{Id:""};b||(w=getCurTab(),b=w?w.title:"");s.length&&(c.html(""),ft=t.icon||"fa fa-window-maximize",c.append('<i class="'+ft+'">').append(b),k=n.Id===""?"【"+Language.New+"】":o?"【"+Language.Detail+"】":"【"+Language.Edit+"】",y="",i.titleInfo&&(y=i.titleInfo(n)),y.indexOf("【")>-1&&(k=""),c.append(k+y),bt(d,a));u.setData(n,o);i.tabs&&v.find("li:eq(0)").click();f&&(p=o&&nt.length===0,p?f.hide():f.show(),!p&&o?(f.find("button").hide(),f.find(".fbDetail,.fbClose").show()):f.find("button").show(),i.tabs||e.css({bottom:(p?0:40)+"px"}));a&&!h&&(r.addClass("form-dialog"),g=Layer.index++,$("<div>").attr("id",l+"Mask").addClass("mask").css({zIndex:g}).appendTo($("body")),rt=i.width||800,ut=i.height||400,r.css({zIndex:g+1,width:rt+"px",height:ut+"px",marginTop:-(ut/2)+"px",marginLeft:-(rt/2)+"px"}));r.removeClass("collapse");r.show();i.max&&(et=r.find(".right-toolbar .maximize"),Layer.changeMax(et,r,"form-dialog-max",Layer.index+1))}function ct(){if($("#"+l+"Mask").remove(),r.hasClass("form-dialog-max")){var n=r.find(".right-toolbar .fa-window-restore");Layer.changeMax(n,r,"form-dialog-max",Layer.index+1)}Layer.index--;r.hide();i.onClose&&i.onClose()}var i=t,l=typeof n=="string"?"form"+n:n.attr("id"),r=typeof n=="string"?$("#"+l):n,lt=t.saveClose===undefined?!0:t.saveClose,b=i.title,k={},o=[],nt=[],u=this,tt,a,it,v,y,rt=l+"-tab-",s,c,d,e,h,f,p={};this.id=l;this.elem=r;this.body=null;this.option=i;this.data={};this.render=function(){return this.elem=r=$("<div>"),ut(),r};this.show=function(n,t,i){p=i||{};a=r.hasClass("form-card")||r.hasClass("tabs-form");g(n,t,!1)};this.showDialog=function(n,t,i){p=i||{};a=!0;g(n,t,!1)};this.close=function(){tt&&ct()};this.setToolbar=function(n){this.option.toolbar=n;ft(n)};this.validate=function(){for(var t,i=[],n=0;n<o.length;n++)t=o[n],t.validate()||i.push(t);return i.length===0};this.clear=function(){for(var t,n=0;n<o.length;n++)t=o[n],t.clearError(),t.setValue("")};this.getData=function(){for(var t,r,i={},u=[],n=0;n<o.length;n++)t=o[n],t.name&&t.type!=="html"&&(t.name.indexOf(".")>-1?(r=t.name.split("."),i[r[0]]||(u.push(r[0]),i[r[0]]={}),i[r[0]][r[1]]=t.getValue()):i[t.name]=t.getValue());if(u.length)for(n=0;n<u.length;n++)i[u[n]]=JSON.stringify(i[u[n]]);return i};this.setData=function(n,t){var e,r,f,s,h;for(this.data=n,e=0;e<o.length;e++)r=o[e],r.clearError(),r.data=n,t?r.setReadonly(!0):r.setReadonly(r.readonly),r.name&&r.name.indexOf(".")>-1?(f=r.name.split("."),$.isPlainObject(n[f[0]])||(n[f[0]]=JSON.parse(n[f[0]]||"{}")),r.setValue(n[f[0]][f[1]],t)):(s=n[r.name],r.type==="picker"&&(s={value:s,text:n[r.name+"Name"]}),r.setValue(s,t));h={form:u,data:n,isDetail:t};i.setData&&i.setData(h)};this.setReadonly=function(n){for(var i,t=0;t<o.length;t++)i=o[t],i.setReadonly(n)};this.setInput=function(n){w(n)};this.load=function(n,t){i.url=n;Ajax.get(n,null,function(n){u.setData(n,t)})};this.reload=function(){ot(i.url)};this.save=function(n,t){function s(n){if(r.Id=n,i.tabs?g(r,!1,!0):lt&&u.close(),p.onSaveCallback)p.onSaveCallback(r);else t&&t(r)}var r,f,e,o;u.validate()&&(r=u.getData(),i.onSaving&&i.onSaving(r),f=[],i.fields&&(f=i.fields.filter(function(n){return n.type&&n.type==="file"})),f.length?Ajax.upload(f[0].field,n,r,s):(e={data:JSON.stringify(r)},i.submitData&&(o=i.submitData(),$.extend(e,o)),Ajax.post(n,e,s)))};r.length&&(ut(),i.isPrint||Page.complete())}function Input(n,t){function a(){f?i.component.render().appendTo(n):(h(i.type),r.render(n),r.elem&&(u=r.elem,v()),i.unit&&(n.css({position:"relative"}),$("<span>").addClass("form-unit").html(i.unit).appendTo(n)),i.value&&r.setValue(i.value))}function h(n){r=n==="label"?new p(i):n==="radio"?new w(i):n==="checkbox"?new b(i):n==="select"?new k(i):n==="date"?new d(i):n==="file"?new g(i):n==="picker"?new nt(i):n==="editor"?new tt(i):n==="textarea"?new it(i):new rt(i)}function v(){u.attr("name",o);i.placeholder&&u.attr("placeholder",i.placeholder);i.required&&u.attr("required",!0);i.inputStyle&&u.attr("style",i.inputStyle);i.change&&c(i.change)}function y(){u=n;e=u.parent();o=u.attr("name");_data=[];var t=u[0].nodeName==="SELECT"?"select":u[0].type;$.extend(i,{field:o,type:t,required:u[0].required});h(t)}function c(n){u&&u.change(function(){var t=$(this);n&&n({form:i.form,elem:t,value:t.val(),selected:t.find(":selected").data("data")})})}function p(n){var t,i=n.value;this.option=n;this.render=function(n){t=$("<div>").addClass("label").appendTo(n)};this.getData=function(){};this.setData=function(){};this.getValue=function(){return i};this.setValue=function(r){i=r;var u=r;n.code&&(u=Utils.getCodeName(n.code,r));t.html(u)};this.setReadonly=function(){}}function w(n){function i(n,t,i,u){var f,o;if(t.label||n.html(""),f=Utils.getCodes(i),f&&f.length)for(o=0;o<f.length;o++){var e=f[o],s=e.Code===""?"":e.Code||e,h=e.Name||s;r(n,e,s,h,u||t.value,t)}}function r(n,t,i,r,u,f){if(t.Code==="-"){$("<br>").appendTo(n);return}var e=$("<label>").addClass("form-radio").appendTo(n),o=$("<input>").data("data",t).attr("type",f.type).attr("name",f.field).attr("value",i).appendTo(e);if(u&&i===u&&o.attr("checked",!0),f.onClick)o.on("click",function(){f.onClick($(this).val())});$("<span>").html(r).appendTo(e)}var t;this.option=n;this.render=function(r){t=r;i(r,n,n.code)};this.getData=function(){var n=[];return t.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(r,u){i(t,n,r,u)};this.getValue=function(){return t.find('input[name="'+n.field+'"]:checked').val()||""};this.setValue=function(i){for(var u=t.find('input[name="'+n.field+'"]'),r=0;r<u.length;r++)u[r].checked=u[r].value===i};this.setReadonly=function(n){t.find("input").attr("disabled",n)}}function b(n){function r(n,t,i,r){var f,o;if(t.label||n.html(""),f=Utils.getCodes(i),f&&f.length)for(o=0;o<f.length;o++){var e=f[o],s=e.Code===""?"":e.Code||e,h=e.Name||s;u(n,e,s,h,r||t.value,t)}}function u(n,t,i,r,u,f){if(t.Code==="-"){$("<br>").appendTo(n);return}var e=$("<label>").addClass("form-radio").appendTo(n),o=$("<input>").data("data",t).attr("type",f.type).attr("name",f.field).attr("value",i).appendTo(e);if(u&&i===u&&o.attr("checked",!0),f.onClick)o.on("click",function(){f.onClick($(this).val())});$("<span>").html(r).appendTo(e)}var i,t;this.option=n;this.render=function(u){t=u;var f=n.code;f==="Enabled"?f=[{Code:1,Name:Language.Enable}]:n.label&&(f=[{Code:1,Name:f==="Enabled"?Language.Enable:n.title}]);f?r(u,n,f):(i=$("<input>").attr("type","checkbox").attr("name",n.field).attr("value","1").appendTo(u),(n.value===1||n.value==="1")&&(i[0].checked=!0))};this.getData=function(){var n=[];return t.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(i,u){r(t,n,i,u)};this.getValue=function(){var r=n.field,u=t.find('input[name="'+r+'"]'),i;return u.length===1?u[0].checked?1:0:(i=[],t.find('input[name="'+r+'"]:checked').each(function(n,t){i.push($(t).val())}),i.join(","))};this.setValue=function(i){for(var f,u=t.find('input[name="'+n.field+'"]'),r=0;r<u.length;r++)f=u[r].value,u[r].checked=i===1||i===!0||i&&i.indexOf(f)>-1};this.setReadonly=function(n){t.find("input").attr("disabled",n)}}function k(n){function i(n,t,i,r){var e,o,h,f;if(t.label||n.html(""),e=Utils.getCodes(i),e&&e.length){for(o=[],h="",h=t.emptyText!==undefined?t.emptyText:t.isQuery?Language.All:Language.PleaseSelect,h!==""&&o.push({Code:"",Name:h}),f=0;f<e.length;f++)o.push(e[f]);for(f=0;f<o.length;f++){var s=o[f],c=s.Code===""?"":s.Code||s,l=s.Name||c;u(n,s,c,l,r||t.value)}}}function u(n,t,i,r,u){var f=$("<option>").data("data",t).attr("value",i).html(r).appendTo(n);u&&i===u&&f.attr("selected",!0)}var t,r=this;this.elem;this.option=n;this.render=function(u){t=$("<select>").appendTo(u);r.elem=t;i(t,n,n.code)};this.getData=function(){return t.find(":selected").data("data")};this.setData=function(r,u){i(t,n,r,u)};this.getValue=function(){return t.val()};this.setValue=function(n){t.val(n)};this.setReadonly=function(n){t.attr("disabled",n)}}function d(n){var t,i,r=this;this.elem;this.option=n;this.render=function(n){i=n;var u=$("<div>").addClass("query-date").appendTo(n);t=$("<input>").attr("type","text").attr("autocomplete","off").appendTo(u);$("<span>").addClass("icon fa fa-calendar").appendTo(u).on("click",function(){t.focus()});r.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(n){var i=t.attr("placeholder");i&&(n instanceof Date?n=n.format(i):isNaN(n)&&!isNaN(Date.parse(n))&&(n=new Date(n).format(i)));t.val(n)};this.setReadonly=function(n){n?i.find(".icon").hide():i.find(".icon").show();t.attr("disabled",n)}}function g(n){var t,i,r=this;this.elem;this.option=n;this.render=function(u){i=u;t=$("<input>").attr("id",n.field).attr("type","file").attr("autocomplete","off").attr("accept",n.fileExt||".png,.jpg,.pdf,.doc,.docx.xls,.xlsx,.ppt,.pptx").appendTo(u);n.multiple&&t.attr("multiple","multiple");r.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(r){var u,f;t.val("");u=i.find(".file");u.length&&u.html("");f=n.form.data[n.idField];f!==null&&f!==""&&f!==undefined&&(u.length||(u=$("<span>").addClass("file inline").appendTo(i)),$("<span>").addClass("link").data("id",f).html(r).on("click",function(){BizFile.download($(this).data("id"))}).appendTo(u))};this.setReadonly=function(n){t.attr("disabled",n)}}function nt(t){var r,u,f=this;this.elem;this.option=t;this.render=function(n){n.css({position:"relative"});r=$("<input>").attr("type","hidden").appendTo(n);f.elem=r;u=new Picker(r,i)};this.getData=function(){return u.getData()};this.setData=function(){};this.getValue=function(){return r.val()};this.setValue=function(n){u.setValue(n)};this.setReadonly=function(t){t?n.find(".icon").hide():n.find(".icon").show();r.attr("disabled",t)}}function tt(n){function e(){var n,r;window.wangEditor||Utils.addJs("/libs/wangEditor.min.js");i.hide();n="editor"+o;i.before('<div id="'+n+'" class="editor">');u=new window.wangEditor("#"+n);u.config.onchange=function(n){i.val(n)};OssClient.config.accessKeyId?(r=new OssClient,u.config.customUploadImg=function(n,i){var e=t.form.OssUrl.getValue(),f=t.form.OssPath.getValue(),u;if(!e&&!f){Layer.tips("OSSPath"+Language.NotEmpty+"！");return}u=n[0];f+="/"+u.lastModified+u.name;r.put(f,u,function(n){i(e+n.name)})}):u.config.uploadImgServer=baseUrl+"/System/Upload";setTimeout(function(){u.create()},10)}var i,r,u,f=this;this.elem;this.option=n;this.render=function(n){r=n;i=$("<textarea>").appendTo(n);f.elem=i;e()};this.getData=function(){};this.setData=function(){};this.getValue=function(){return i.val()};this.setValue=function(n){i.val(n);u&&u.txt.html(n)};this.setReadonly=function(n){n?(r.find(".editor").addClass("readonly-editor"),r.find(".w-e-text-container").css("border-top","1px solid #c9d8db"),r.find(".w-e-text").attr("contenteditable",!1)):(r.find(".editor").removeClass("readonly-editor"),r.find(".w-e-text-container").css("border-top","none"),r.find(".w-e-text").attr("contenteditable",!0))}}function it(n){var t,i=this;this.elem;this.option=n;this.render=function(n){t=$("<textarea>").appendTo(n);i.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return t.val()};this.setValue=function(n){t.val(n)};this.setReadonly=function(n){t.attr("disabled",n)}}function rt(n){var t,i=this;this.elem;this.option=n;this.render=function(r){t=$("<input>").attr("type",n.type).attr("autocomplete","off").appendTo(r);i.elem=t};this.getData=function(){};this.setData=function(){};this.getValue=function(){return!t||!t.length?"":t.val()};this.setValue=function(n){t&&t.length&&t.val(n)};this.setReadonly=function(n){t&&t.length&&t.attr("disabled",n)}}var e=n,i=t||{},f=i.type==="component",l=i.readonly===undefined?!1:t.readonly,o=i.field,r,u,s=this;t&&t.type?a():y();this.option=i;this.elem=u;this.readonly=l;this.name=o;this.type=i.type;this.value="";this.data={};this.validate=function(){if(s.clearError(),!i.required)return!0;if(f)return i.component.validate();var n=$.trim(s.getValue());return n===""?(e.addClass("error"),!1):!0};this.clearError=function(){if(f){i.component.clearError();return}e.removeClass("error")};this.getValue=function(){return f?i.component.getData():r.getValue()};this.setValue=function(n,t){s.value=n;f?i.component.setData(n,t):r.setValue(n,t)};this.setReadonly=function(n){f?i.component.setReadonly(n):r.setReadonly(n)};this.setVisible=function(n){n?e.parent().show():e.parent().hide()};this.setUrl=function(n,t){$.get(n,function(n){s.setData(n);t&&t(n)})};this.getData=function(){return f?i.component.getData():r.getData()};this.setData=function(n,t){f?i.component.setData(n,t):r.setData(n,t)};this.change=function(n){c(n)};this.setUnit=function(t,i){var r=n.find(".form-unit").html(t);i&&r.css(i)};this.setTips=function(t,i){var r=n.find(".form-tips").html(t);i&&r.css(i)}}function Picker(n,t){function l(){var n=r.pick||{},t,s;e=o;n.action&&(e=n.action+e,n=Picker.action[n.action]||{},$.extend(!0,n,r.pick));f=n.multiSelect||!1;t=$("<span>").addClass("icon fa fa-ellipsis-h").on("click",function(){a(n)});n.valueField===n.textField?(i.attr("type","text").attr("disabled",!0),t.insertAfter(i)):(s=new Input(i.parent(),{field:o+"Name",type:"text",readonly:!0}),u=s.elem,r.form&&r.form.setInput(s),u.attr("disabled",!0),t.insertAfter(u))}function a(n){n.type==="component"?v(n):n.type==="tree"?y(n):p(n)}function v(n){var t=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(t){n.component.render(t);n.onLoad&&n.onLoad({form:r.form,control:n.component,option:n})},buttons:[{text:Language.OK,handler:function(){b(t,n)}}]})}function y(n){var t,i=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(i){t=new Tree(e+"TreePick",{url:n.url});t.render().appendTo(i);n.onLoad&&n.onLoad({form:r.form,control:t,option:n})},buttons:[{text:Language.OK,handler:function(){var r=t.selectedNode;if(!r){Layer.tips(Language.PleaseSelect+Language.Node+"！");return}k(i,n,r)}}]})}function p(n){var t,i=Layer.open({title:n.title,width:n.width||600,height:n.height||400,content:function(u){n.showCheckBox=!0;n.multiSelect=f;f||(n.dblclick=function(t){h(i,n,[t.row])});var o=$.extend({},n,{width:null});t=new Grid(e+"Pick",o);t.render().appendTo(u);n.saveUrl?Utils.createButton({icon:"fa fa-plus",text:Language.Add,handler:function(){w(n,function(r){f?t.reload():h(i,n,[r])})}}).appendTo(t.query.elem):n.onAddClick&&Utils.createButton({icon:"fa fa-plus",text:Language.Add,handler:function(){n.onAddClick({control:t,option:n})}}).appendTo(t.query.elem);n.onLoad&&n.onLoad({form:r.form,control:t,option:n})},buttons:[{text:Language.OK,handler:function(){var r=t.getSelected();if(f){if(!r||r.length===0){Layer.tips(Language.PleaseSelectOneAtLeast);return}}else if(!r||r.length===0||r.length>1){Layer.tips(Language.PleaseSelectOne);return}h(i,n,r)}}]})}function w(n,t){var i=new Form(e+"Pick",{style:"form form-block",fields:n.columns,data:n.formData}),r=Layer.open({title:n.title+"【"+Language.New+"】",width:n.formWidth||600,height:n.formHeight||350,component:i,buttons:[{text:Language.OK,handler:function(){i.save(n.saveUrl,function(n){t&&t(n);r.close()})}}]})}function b(n,t){var i={form:r.form},u=t.component.getData();i.value=u[t.valueField];i.text=u[t.textField];i.data=u;c(n,t,i)}function k(n,t,i){var u={form:r.form};u.value=i.id;u.text=i.title;u.data=i.data;c(n,t,u)}function h(n,t,i){var u={form:r.form},s,h,e,o;if(f){for(s=[],h=[],e=0;e<i.length;e++)s.push(i[e][t.valueField]),h.push(i[e][t.textField]);u.value=s.join(",");u.text=h.join(",");u.data=i}else o=i[0],u.value=o[t.valueField],u.text=o[t.textField],u.data=o;c(n,t,u)}function c(n,t,r){i.data(s,r.data);i.val(r.value);u&&u.val(r.text);t.callback&&t.callback(r);n.close()}var i=typeof n=="string"?$('[name="'+n+'"]'):n,r=t||{},f=!1,e,o=r.field,u,s="data";l();this.name=o;this.validate=function(){var n=$.trim(this.getValue());return!i[0].disabled&&i[0].required&&n===""?!1:!0};this.getValue=function(){var n=i.data(s);return n&&n.value?n.value:i.val()};this.getData=function(){var n=i.data(s);return n&&n.data?n.data:null};this.setValue=function(n){n&&(i.val(n.value),u&&u.val(n.text))}}function Error(n){function i(n){var i=t.title,r=t.content;t.title||(i=Language.Error500Title,r=Language.Error500Content,t.type==="403"?(i=Language.Error403Title,r=Language.Error403Content):t.type==="404"&&(i=Language.Error404Title,r=Language.Error404Content));$("<h1>").html(t.type).appendTo(n);$("<h3>").html(i).appendTo(n);$("<div>").html(r).appendTo(n)}var t=n||{};this.render=function(n){var t=$("<div>").addClass("error-box").appendTo(n);return i(t),t}}function Router(n,t){var u=t||{},i=n,r={},f=this;this.elem=i;this.route=function(n){var f=r.component,t;f&&f.destroy&&f.destroy();u.isTop&&(n.previous||(n.previous=r),r=n);t=n.component;t&&(typeof t=="string"?i.html(t):(i.html(""),u.multiNode?t.render(i):t.render().appendTo(i)),setTimeout(function(){Page.complete();t.mounted&&t.mounted()},10))};this.back=function(){f.route(r.previous)}}function Install(){var n={GetInstallInfo:baseUrl+"/Home/Install?data=1",SaveInstall:baseUrl+"/Home/Install"},t=new InitBox({getUrl:n.GetInstallInfo,saveUrl:n.SaveInstall,style:"install",title:"安装程序",btnText:"安 装",fields:[{title:"企业编码",field:"CompNo",type:"text",required:!0},{title:"企业名称",field:"CompName",type:"text",required:!0},{title:"系统名称",field:"AppName",type:"text",required:!0},{title:"产品ID",field:"ProductId",type:"text",readonly:!0},{title:"产品密钥",field:"ProductKey",type:"text",required:!0},{title:"管理员账号",field:"UserName",type:"text",readonly:!0},{title:"管理员密码",field:"Password",type:"password",required:!0},{title:"确认密码",field:"Password1",type:"password",required:!0}]});this.render=function(n){t.render(n)};this.mounted=function(){t.mounted()}}function Active(){var n={GetActiveInfo:baseUrl+"/Home/Active?data=1",SaveActive:baseUrl+"/Home/Active"},t=new InitBox({getUrl:n.GetActiveInfo,saveUrl:n.SaveActive,title:Language.ActiveTitle,btnText:Language.Active,fields:[{title:Language.CompNo,field:"CompNo",type:"text",readonly:!0},{title:Language.CompName,field:"CompName",type:"text",readonly:!0},{title:Language.ProductId,field:"ProductId",type:"text",readonly:!0},{title:Language.SerialNo,field:"ProductKey",type:"text",readonly:!0}]});this.render=function(n){t.render(n)};this.mounted=function(){t.mounted()}}function InitBox(n){function r(n){var t=$("<div>").addClass("active-header").appendTo(n);$("<h1>").html($("title").text()).appendTo(t)}function u(t){var u=$("<div>").addClass("active-body").appendTo(t),r=$("<div>").addClass("active-box").appendTo(u);n.style&&r.addClass(n.style);$("<h1>").addClass("active-title").html(n.title).appendTo(r);i.render().appendTo(r);$("<div>").addClass("message").appendTo(r)}function f(n){$("<div>").addClass("active-footer").append(copyrightInfo).appendTo(n)}function t(n,t){var i=$(".message").html("");t?$("<span>").addClass("red").html(n).appendTo(i):i.html(n)}var i=new Form("InitBox",{style:"form-block",fields:n.fields,toolbar:[{text:n.btnText,handler:function(i){if(i.form.validate()){var r=i.form.getData(),u=$(this).attr("disabled",!0);$.post(n.saveUrl,{data:JSON.stringify(r)},function(n){n.IsValid?(t(n.Message,!1),app.login()):(t(n.Message,!0),u.attr("disabled",!1))})}}}]});this.render=function(n){r(n);u(n);f(n)};this.mounted=function(){$.post(n.getUrl,function(n){i.setData(n);n.Message&&box.message(n.Message,!0)})};this.message=function(n,i){t(n,i)}}function Login(){function f(n){var t=$("<div>").addClass("login-header").appendTo(n);$("<h2>").html(appName).appendTo(t)}function e(n){var r=$("<div>").addClass("login").attr("id","login").appendTo(n),t=$("<div>").addClass("login-body").appendTo(r);i||o(t);s(t);i||c(t)}function o(n){var t=$("<div>").addClass("login-bell").appendTo(n);$("<img>").attr("src",staticUrl+"/img/login_icon1.png").attr("alt","login").appendTo(t).on("click",function(){var n=$(this).data("icon")||"1",t;n=n==="1"?"2":"1";t=staticUrl+"/img/login_icon"+n+".png";$(this).data("icon",n).attr("src",t);$(".login-form").hide();$("#login"+n).show()})}function s(t){var i=$("<div>").addClass("login-form").attr("id","login1").appendTo(t),f=$("<div>").addClass("login-title").attr("id","ltLogin").append(Language.UserLogin).appendTo(i),u;f.css("padding-bottom","0");n(i,"userName","text","fa fa-user",Language.UserName,'$("#password").focus()');n(i,"password","password","fa fa-lock",Language.Password,'$("#captcha").focus()');h(i);u=$("<div>").addClass("login-form-item").appendTo(i);$("<button>").addClass("btn-primary").attr("id","btnLogin").html(Language.Login).appendTo(u).on("click",function(){r($(this),!1)});$("<div>").attr("id","message").appendTo(i)}function n(n,t,i,r,u,f){var e=$("<div>").addClass("login-form-item").appendTo(n);return $("<label>").addClass(r).attr("for",t).appendTo(e),$("<input>").attr("type",i).attr("id",t).attr("placeholder",u).attr("autocomplete","off").attr("onenter",f).appendTo(e),e}function h(t){var i=n(t,"captcha","text","fa fa-check-circle-o",Language.Captcha,'$("#btnLogin").click()');$("<img>").attr("id","imgCaptcha").attr("src",baseUrl+"/Home/GetCaptcha").attr("title",Language.RefreshCaptcha).attr("alt","").appendTo(i).on("click",function(){var n=$(this),t=n.attr("src").split("?")[0];n.attr("src",t+"?rnd="+Math.random())})}function c(n){var t=$("<div>").addClass("login-form").attr("id","login2").appendTo(n),i;t.hide();$("<div>").addClass("login-title").attr("id","ltScan").append(Language.ScanCode).appendTo(t);i=$("<div>").addClass("login-qrcode").appendTo(t);$("<img>").attr("src",staticUrl+"/img/qrcode.png").attr("alt","qrcode").appendTo(i)}function l(n){var t=$("<div>").addClass("login-footer").appendTo(n);$("<p>").addClass("copyright").append(copyrightInfo).appendTo(t)}function r(n,i){var s,h;$(".login-form-item input").removeClass("error");var f=t("userName"),e=t("password"),o=t("captcha"),c=Utils.getClientId();f!==""&&e!==""&&o!==""&&(s=n.html(),h=n.attr("disabled",!0).html(Language.Logining),$.post(baseUrl+"/signin",{userName:f,password:e,captcha:o,cid:c,force:i},function(t){h.removeAttr("disabled").html(s);t.IsValid?(u("#00f",t.Message),location=location):t.Data&&t.Data.Confirm?Layer.confirm(t.Message,function(){r(n,!0)}):u("#f00",t.Message)}))}function t(n){var t=$("#"+n),i=$.trim(t.val());return i===""&&t.addClass("error"),i}function u(n,t){$("#message").css("color",n).html(t)}var i=Utils.checkMobile();this.render=function(n){$("body").css("background-image","url("+staticUrl+"/img/bg.jpg)");f(n);e(n);l(n)};this.mounted=function(){$("#userName").focus()}}function getCurTab(){return top.Admin.CurrentTab}function showTabPage(n){n.children=top.Admin.Buttons.filter(function(t){return t.pid===n.id});top.Admin.showTab(n)}function showTabPageByCode(n){var t=top.Admin.Menus.filter(function(t){return t.code===n});t.length&&showTabPage(t[0])}function App(n){function r(){i=new Router(t,{isTop:!0,multiNode:!0})}var t=$("#"+n),i;r();this.elem=t;this.router=i;this.user={};this.route=function(n){i.route(n)};this.render=function(){var n=Utils.getUrlParam("m"),r=Page[n];r?(i.route(r),setTimeout(function(){Page.complete();BizHistory.init()},10)):(t.html(""),$("<div>").addClass("content").html(n+Language.NotExist+"！").appendTo(t))};this.home=function(){this.route({component:new Home})};this.login=function(){Utils.setUser(null);Utils.setCodes(null);this.route({component:new Login})};this.install=function(){this.route({component:new Install})};this.active=function(){this.route({component:new Active})}}function Home(){function r(n){var i=n.AppValidDate,u,t;if(i==="永久")return!0;if(i==="")return Layer.open({width:300,height:100,content:function(n){$("<div>").addClass("alert-content center").html(Language.ProductNotAuthorized).appendTo(n)}}),!1;var f=Date.parse(i),e=new Date,r=parseInt((f-e)/864e5)+1;return r<=30&&(u=Utils.format(Language.ProductValidDateTips,r),t=Layer.open({width:450,height:200,content:function(i){var f=$('<div id="divValidDate">').addClass("layout-alert").appendTo(i),r;if($("<div>").addClass("alert-content").html(u).appendTo(f),r=$("<div>").addClass("alert-toolbar").appendTo(f),n.AppYun)$("<button>").addClass("ok").attr("style","margin-right:20px").html(Language.OK).appendTo(r).on("click",function(){t.close()});else $("<button>").addClass("active").attr("style","margin-right:20px").html(Language.GoToActivate).appendTo(r).on("click",function(){t.close();app.active()});$("<button>").addClass("cancel").html(Language.Close).appendTo(r).on("click",function(){t.close()})}})),!0}function u(n,t){function s(n){r(n,"refresh",Language.RefreshPage,"fa fa-refresh");r(n,"feedback",Language.Feedback,"fa fa-commenting-o");r(n,"fullScreen",Language.FullScreen,"fa fa-arrows-alt");r(n,"siteMap",Language.SiteMap,"fa fa-sitemap")}function r(n,t,i,r){var u=$("<li>").addClass("nav-item top-right").attr("title",i).attr("action",t).appendTo(n);$("<i>").addClass(r).appendTo(u)}function h(n){var t=$("<div>").addClass("nav-title title").appendTo(n),i;e=$("<img>").attr("alt","Avatar").attr("src",staticUrl+"/img/face1.png").appendTo(t);f=$("<span>").appendTo(t);$("<i>").addClass("fa fa-caret-down arrow").appendTo(t);i=$("<dl>").addClass("nav-child child").appendTo(n);$("<dd>").attr("action","userInfo").addClass("top-right").append('<i class="fa fa-user">').append($("<span>").html(Language.UserCenter)).appendTo(i);$("<dd>").attr("action","logout").addClass("top-right").append('<i class="fa fa-power-off">').append($("<span>").html(Language.SafeLogout)).appendTo(i)}function c(){var n=new Form("Feedback",{fields:[{field:"AppId",type:"hidden"},{field:"FeedName",type:"hidden"},{field:"FeedById",type:"hidden"},{title:Language.FeedBy,field:"FeedBy",type:"text",required:!0,readonly:!0},{title:Language.ContactMode,field:"FeedPhone",type:"text",required:!0},{title:Language.FeedContent,field:"Content",type:"textarea",required:!0,lineBlock:!0,inputStyle:"height:230px;"},{title:Language.Attachment,field:"File",type:"file",lineBlock:!0}]});Layer.open({title:Language.Feedback,width:650,height:450,component:n,success:function(){var t=Utils.getUser();n.setData({AppId:t.AppId,FeedName:t.CompName,FeedById:t.UserName,FeedBy:t.Name,FeedPhone:t.Mobile})},buttons:[{text:Language.Send,icon:"fa fa-send-o",handler:function(i){if(n.validate()){var r=n.getData();Ajax.upload("File",t.Feedback,r,function(){i.close()})}}}]})}function l(n){var t=document.documentElement,r=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen,i;r?r.call(t):typeof ActiveXObject!="undefined"&&(i=new ActiveXObject("WScript.Shell"),i!==null&&i.SendKeys("{F11}"));n.attr("action","exitScreen").html('<i class="fa fa-arrows">')}function a(n){var t=document,r=t.cancelFullScreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.exitFullScreen,i;r?r.call(t):typeof ActiveXObject!="undefined"&&(i=new ActiveXObject("WScript.Shell"),i!==null&&i.SendKeys("{F11}"));n.attr("action","fullScreen").html('<i class="fa fa-arrows-alt">')}function v(n){$("[action]").on("click",function(){var t=$(this),i=t.attr("action");n[i]?n[i].call(this,t):""})}function y(n){var t=n.data("status");t&&t==="1"?(n.data("status","0").addClass("fa-dedent").removeClass("fa-indent"),$("body").removeClass("layout-mini")):(n.data("status","1").addClass("fa-indent").removeClass("fa-dedent"),$("body").addClass("layout-mini"),$(".nav-tree i").each(function(n,t){var i=$(t).next().text();$(t).attr("title",i)}))}var u,i,f,e,o={refresh:function(){n.body.refresh()},share:function(){alert("share")},feedback:function(){c()},fullScreen:function(){l($(this))},exitScreen:function(){a($(this))},shortcut:function(){},siteMap:function(){n.body.showPage({id:"siteMap",title:$(this).attr("title"),icon:$(this).find("i").attr("class"),type:"page",code:"SysSiteMap"})},userInfo:function(){n.body.showPage({id:"userInfo",title:$(this).text(),icon:$(this).find("i").attr("class"),type:"page",code:"SysUserInfo"})},logout:function(){Layer.confirm(Language.LogoutConfirm,function(){$.post(t.SignOut,function(){app.login()})})}};this.render=function(n,t){var c=t.user,r=$("<div>").addClass("layout-header").appendTo(n),l=$("<div>").addClass("toggleMenu").appendTo(r),f,e;$("<i>").addClass("fa fa-dedent").attr("title",Language.Collapse).appendTo(l).on("click",function(){y($(this))});u=$("<span>").addClass("appName left").html(appName).appendTo(r);i=$("<ul>").attr("id","topMenu").addClass("nav left").appendTo(r);f=$("<ul>").attr("id","topRight").addClass("nav right").appendTo(r);s(f);e=$("<li>").addClass("nav-item dropdown").appendTo(f);h(e);this.setUserInfo(c);v(o)};this.setTitle=function(n){u.html(n)};this.setUserInfo=function(n){f.html(n.Name);e.attr("src",staticUrl+n.AvatarUrl)};this.showMenu=function(t){i.html("");for(var r=0;r<t.length;r++)$("<li>").addClass("nav-item"+(r===0?" active":"")).data("page",t[r]).html(t[r].name).appendTo(i).on("click",function(){i.find("li").removeClass("active");$(this).addClass("active");var t=$(this).data("page");n.body.showHome(t);n.body.showMenu(t)})}}function f(n,t){function e(n){var t,i;for(Admin.Buttons=[],Admin.Menus=[],t=0;t<n.length;t++)i=n[t],i.type==="button"?Admin.Buttons.push($.extend({},i)):Admin.Menus.push($.extend({},i))}function o(t){var f=t.user,e=t.menus,r=Utils.list2Tree(e,appId),u;r.length&&(r.length>1?(n.head.showMenu(r),i.showMenu(r[0])):f.AppTopMenu?(u=r[0].children,n.head.showMenu(u),i.showMenu(u[0])):i.showMenu(r[0]))}function s(n){var t=$("<div>").addClass("layout-side").appendTo(n),u=$("<div>").addClass("logo").appendTo(t),i;$("<img>").attr("src",staticUrl+"/img/logo.png").appendTo(u);i=$("<div>").addClass("layout-scroll").appendTo(t);r=$("<ul>").addClass("nav-tree").appendTo(i)}function h(n){var i=$("<div>").addClass("layout-nav").appendTo(n);$("<div>").addClass("tabs-header").appendTo(i);$("<div>").addClass("fa fa-question-circle-o help").attr("title",Language.HelpDocument).appendTo(i).on("click",function(){v()});t.multiTab&&Admin.bindContextMenu()}function c(n,t){return $("<div>").addClass("nav-title").append('<i class="'+t.icon+'">').append("<span>"+t.name+"<\/span>").data("page",t).data("show","0").appendTo(n).on("click",function(){var n=$(this),t;u(n);t=n.data("page");t.url||t.type==="page"?i.showPage(t):(r.find(".nav-title").not(n).each(function(n,t){f($(t),!1)}),f(n,n.data("show")==="0"))})}function l(n,t){$("<dd>").append('<i class="'+t.icon+'">').append("<span>"+t.name+"<\/span>").data("page",t).appendTo(n).on("click",function(){u($(this));i.showPage($(this).data("page"))})}function u(n){r.find(".nav-title,.nav-child dd").removeClass("active");n.addClass("active")}function f(n,t){t?(n.data("show","1"),n.next().show(),n.find("span.fa").removeClass("fa-chevron-down").addClass("fa-chevron-up")):(n.data("show","0"),n.next().hide(),n.find("span.fa").removeClass("fa-chevron-up").addClass("fa-chevron-down"))}function a(n){return $("<div>").addClass("layout-body").appendTo(n)}function v(){var t=$(".layout-body"),n;t.css({right:"400px"});n=$("<div>").addClass("layout-help").insertAfter(t);$("<span>").addClass("fa fa-close close").appendTo(n).on("click",function(){t.css({right:0});n.remove()});$("<div>").addClass("title").html('<i class="fa fa-question-circle-o"><\/i>'+Language.HelpDocument).appendTo(n);$("<div>").addClass("content").appendTo(n);Admin.showHelp()}function y(n){var r=$(".tabs-header").html(""),t;$("<i>").addClass("fa fa-home").css("margin-left","10px").appendTo(r);n.isHome?r.append(Language.HomePage):($("<span>").addClass("link").html(Language.HomePage).on("click",function(){i.showHome(Admin.CurrentMenu)}).appendTo(r),r.append(" / "+n.title));t=$(".layout-body iframe");t.length||(t=$("<iframe>").attr("frameborder","0").appendTo($(".layout-body")));t.attr("title",n.title);Admin.CurrentTab=n;Admin.loadFrame(t,n);Admin.showHelp()}var r,i=this;this.render=function(n,t){var i,r,u;s(n);h(n);i=a(n);t.menus.length?(e(t.menus),o(t)):(r=$("<div>").addClass("layout-error").appendTo(i),u=new Error({type:"403"}),u.render(r))};this.showMenu=function(n){var i,t,f,e,u,o;for(r.html(""),i=n.children||[],t=0;t<i.length;t++)f=$("<li>").addClass("nav-item").appendTo(r),e=c(f,i[t]),i[t].children&&i[t].children.length&&(u=i[t].children.filter(function(n){return n.type!=="button"}),u&&u.length&&(e.append('<span class="fa fa-chevron-down">'),o=$("<dl>").addClass("nav-child").appendTo(f),$(u).each(function(n,t){l(o,t)})));Admin.CurrentMenu=n;this.showHome(n)};this.showHome=function(n){n.id="home";n.isHome=!0;this.showPage(n)};this.showPage=function(n){n&&(t.multiTab?Admin.showTab(n):y(n))};this.refresh=function(){if(t.multiTab)Admin.refreshTab();else{var n=$(".layout-body iframe"),i=n.attr("src");n.attr("src",i)}}}var n={multiTab:!0,Feedback:baseUrl+"/System/Feedback",GetUserData:baseUrl+"/Home/GetUserData?type=1",SignOut:baseUrl+"/signout"},t,i=this;this.head=new u(this,n);this.body=new f(this,n);this.render=function(n){t=n};this.mounted=function(){$.get(n.GetUserData,{appId:appId},function(n){n.user?r(n.user)&&(Utils.setUser(n.user),Utils.setCodes(n.codes),i.head.render(t,n),i.body.render(t,n),Page.complete()):app.login()})}}var ExtForm,Layer,copyrightInfo,app,Admin;const DateFormat="yyyy-MM-dd",DateTimeFormat="yyyy-MM-dd HH:mm:ss";Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};WsUtil.getUrl=function(n,t){var i,r,u;if(n.indexOf("ws://")>-1||n.indexOf("wss://")>-1||(i=location.protocol==="https:"?"wss://":"ws://",n.indexOf(location.host)<0&&(i+=location.host),n=i+n),t){n+=n.indexOf("?")<0?"?":"&";r=[];for(u in t)r.push(u+"="+t[u]);n+=r.join("&")}return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?"":decodeURI(t[2])},getClientId:function(){var r=function(n){var t="";for(i=0;i<n.length;i++)t+=u(n.charCodeAt(i));return t},u=function(n){for(var t=n.toString(16),i=0;i+t.length<4;)t="0"+t,i++;return t},t=document.createElement("canvas"),n=t.getContext("2d");n.font="14px Arial";n.fillStyle="#ccc";n.fillText("Known_Client",2,2);var f=t.toDataURL().replace("data:image/png;base64,",""),e=window.atob(f);return r(e.slice(-16,-12))},addCss:function(n){var i=document.createElement("link"),t;i.rel="stylesheet";t=$('link[href*="static/libs/"]');t.length||(t=$('link[href*="static/"]'));t.length?i.href=baseUrl+"/static"+n:(t=$('link[href*="libs/"]'),t.length||(t=$('link[href*="css/"]')),i.href=baseUrl+n);t.last().after($(i))},addJs:function(n){var i=document.createElement("script"),t=$('script[src*="static/libs/"]');t.length||(t=$('script[src*="static/"]'));t.length?i.src=baseUrl+"/static"+n:(t=$('script[src*="libs/"]'),t.length||(t=$('script[src*="js/"]')),i.src=baseUrl+n);t.last().after($(i))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},keyUser:"Known_User",keyCode:"Known_Codes",setUser:function(n){var t=this.keyUser;n?sessionStorage.setItem(t,JSON.stringify(n)):sessionStorage.removeItem(t)},getUser:function(){var n=sessionStorage.getItem(this.keyUser);return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){var t=this.keyCode;n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return n==="YesNo"?[{Code:1,Name:Language.Yes},{Code:0,Name:Language.No}]:n==="HasNot"?[{Code:1,Name:Language.Has},{Code:0,Name:Language.Not}]:n==="Enabled"?[{Code:1,Name:Language.Enable},{Code:0,Name:Language.Disable}]:(r=localStorage.getItem(this.keyCode),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion||this.addJs("/libs/region.js");n.form.Province.setData(window.PCARegion,n.data.Province);n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area&&n.form.Area.setData([])});n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City));n.form.Area&&(n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)}),n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area)))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&$("<i>").addClass(n.icon).appendTo(i);n.style&&i.addClass(n.style);$("<span>").html(n.text||n.name).appendTo(i);i.on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i},parseDom:function(n,t,i){typeof t=="function"?t(i):n.append(t)}},Ajax={get:function(n,t,i){var r=Layer.loading(Language.Loading+"......");$.get(n,t,function(n){r.close();n.Message&&Layer.tips(n.Message);n.IsValid?i&&i(n.Data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading(Language.Submitting+"......");$.post(n,t,function(n){r.close();n.IsValid?(Layer.tips(n.Message),i&&i(n.Data)):n.Message?Layer.alert(n.Message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.IsValid?(Layer.tips(n.Message),r&&r(n.Data)):n.Message?Layer.alert(n.Message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f="Known-Download",e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$("<form>").attr("method","post").attr("action",n).attr("target","").appendTo("body").hide(),u;if($("<input>").attr("type","hidden").attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$("<input>").attr("type","hidden").attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},Page={complete:function(){initDropdown();$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$('[placeholder="'+DateFormat+'"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd"})});$('[placeholder="yyyy-MM-dd HH:mm"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd hh:ii",pickTime:!0})});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser();$(document).ajaxSend(function(n,t){t.setRequestHeader("Known-Token",curUser?curUser.Token:"");t.setRequestHeader("Known-Client",Utils.getClientId())});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.app.login():i.error&&app.route({component:new Error(i)}))}});$(document).contextmenu(function(n){n.preventDefault()});$(function(){Page.complete()});ExtForm=window.ExtForm={};Form.bind=function(n,t,i){var f,u,r,e,o,s;for(f in t)u=n.find('[name="'+f+'"]'),u.length&&(r=t[f],e=u.attr("placeholder"),e&&(o=r instanceof Date?r:new Date(r),r=o.format(e)),s=u[0].nodeName,"DIV,P,SPAN,TD".indexOf(s)>-1?u.html(r):u.val(r),i&&i({elem:u,value:r,data:t}))};Picker.action={};$.extend(Page,{Error500:{component:new Error({type:"500"})},Error403:{component:new Error({type:"403"})},Error404:{component:new Error({type:"404"})}});Layer={index:1e4,page:function(n){return this._show("page",n)},open:function(n){return n.showMax=n.showMax===undefined?!0:n.showMax,this._show("dialog",n)},loading:function(n){var i,e;if(n=n||"",n==="")return{close:function(){}};var r=this,t=r.index++,u="mask"+t,f="load"+t;return $("<div>").addClass("mask").attr("id",u).css({zIndex:t}).appendTo($("body")),i=$("<div>").addClass("loading").attr("id",f).append('<i class="fa fa-spinner fa-spin fa-1x fa-fw">').append(n),e=i.outerWidth(),i.css({marginLeft:-(e/2)+"px",zIndex:t+1}).appendTo($("body")),{close:function(){$("#"+u+",#"+f).remove();r.index--}}},tips:function(n){var t,i,r;(n=n||"",n!=="")&&(t=$(".tips"),t.length||(t=$("<div>").addClass("tips").css({zIndex:this.index}).appendTo($("body"))),t.html(n),i=t.outerWidth(),r=t.outerHeight(),t.css({marginLeft:-(i/2)+"px",marginTop:-(r/2)+"px"}),setTimeout(function(){t.remove()},3e3))},alert:function(n,t){var i=this,r=56,u=i._show("dialog",{showMax:!1,icon:"fa fa-info-circle",title:Language.Tips,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:r+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();u.close()})}})},confirm:function(n,t){var i=this,u=56,r=i._show("dialog",{showMax:!1,icon:"fa fa-question-circle",title:Language.Confirm,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:u+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();r.close()});$("<span>").css({width:"20px",display:"inline-block"}).appendTo(n);i._createCancel(n,function(){r.close()})}})},changeMax:function(n,t,i,r){n.data("isMax")?(n.data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),t.removeClass(i).attr("style",n.data("layerStyle"))):(n.data("isMax",!0).data("layerStyle",t.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),t.addClass(i).attr("style","").css({zIndex:r}))},_createOK:function(n,t){$("<button>").addClass("ok").html(Language.OK).appendTo(n).on("click",t)},_createCancel:function(n,t){$("<button>").addClass("cancel").html(Language.Cancel).appendTo(n).on("click",t)},_show:function(n,t){function g(n){return $("<i>").addClass("fa fa-window-maximize maximize").data("isMax",!1).appendTo(n).click(function(){o.changeMax($(this),i,"dialog-max",f+1)})}function c(n){$("<i>").addClass("fa fa-close close").appendTo(n).click(w)}function w(){s.close();t.onClose&&t.onClose()}function nt(n){n.mousedown(function(n){n.preventDefault();r.move=!0;r.offset=[n.clientX-parseFloat(i.css("left")),n.clientY-parseFloat(i.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),r.move){var t=n.clientX-r.offset[0],u=n.clientY-r.offset[1];i.css({left:t,top:u})}}).mouseup(function(){delete r.move})}function b(n,i){if(t.content)i&&n.css({overflow:"auto"}),k(n,t.content);else if(t.url)t.partial?(i&&n.css({overflow:"auto"}),n.load(t.url)):(i||n.css({padding:0,overflow:"hidden"}),$("<iframe>").attr("frameborder","0").attr("src",t.url).appendTo(n));else if(t.component){var r=new Router(n);r.route(t)}}function tt(n){var i=$("<div>").addClass("dialog-footer");t.footer?(i.appendTo(n),k(i,t.footer)):t.buttons?(i.appendTo(n),$(t.buttons).each(function(n,t){$("<button>").addClass("ok").append(t.text).on("click",function(){t.handler&&t.handler.call(this,s)}).appendTo(i)}),o._createCancel(i,w)):h.css({bottom:0})}function k(n,t){typeof t=="function"?t(n):n.append(t)}var o=this,f=o.index++,y="mask"+f,p="layer"+f,i,s,r,l,a,v,d,u,h,e;return $("<div>").attr("id",y).addClass("mask").css({zIndex:f}).appendTo($("body")),i=$("<div>").attr("id",p).addClass(n).css({zIndex:f+1}).appendTo($("body")),s={index:f,layer:i,close:function(){$("#"+y+",#"+p).remove();o.index--}},r={},n==="dialog"?(l=t.width||500,a=t.height||300,i.css({width:l+"px",height:a+"px",marginTop:-(a/2)+"px",marginLeft:-(l/2)+"px"}),e=$("<div>").addClass("dialog-content").appendTo(i),t.title?(d=t.icon||"fa fa-window-maximize",u=$("<div>").addClass("dialog-header"),$("<i>").addClass("icon "+d).appendTo(u),u.append(t.title),nt(u),t.showMax&&(v=g(u)),c(u),e.append(u)):t.showClose&&c(i),h=$("<div>").addClass("dialog-body").appendTo(e),t.title||h.css({top:0}),b(h,!1),tt(e),t.max&&v&&v.click()):(e=$("<div>").addClass("page-content").appendTo(i),c(i),b(e,!0)),t.success&&t.success(),s}};copyrightInfo="&copy;2020-"+(new Date).format("yyyy")+'<a href="http://www.pumantech.com" target="_blank">普漫科技<\/a>';app=new App("app",{});Admin=window.Admin={injects:[],CacheHelps:{},Buttons:[],Menus:[],CurrentMenu:null,CurrentTab:null,inject:function(n){if(this.injects.indexOf(n)===-1){this.injects.push(n);var t=document.createElement("script");t.src=n;$('script[src*="js/"]').last().after($(t))}},prependNav:function(n){if(!$("#"+n.id).length){var t=$("<li>").attr("id",n.id).addClass("nav-item").css("margin-right","10px").on("click",n.handler);n.icon?$("<i>").addClass(n.icon).appendTo(t):t.html(n.text);$("#topRight").prepend(t)}},showTab:function(n){var r=this,t="tab-"+n.id,i=$("#"+t),f;if(!i.length){var e=n.isHome?"fa fa-home":n.icon,u=n.isHome?Language.HomePage:n.title,o=$('<div id="h'+t+'">').addClass("tabs-header-item").data("data",n).append('<i class="icon '+e+'">').append('<span class="title">'+u+"<\/span>").appendTo($(".tabs-header")).on("click",function(){r.activeTab($(this).data("data"))});if(u!==Language.HomePage)$("<i>").addClass("close fa fa-close").data("data",n).appendTo(o).on("click",function(){r.closePage($(this).data("data"))});i=$("<div>").attr("id",t).addClass("tabs-body-item").appendTo($(".layout-body"));f=$("<iframe>").attr("frameborder","0").attr("title",n.title).appendTo(i);this.loadFrame(f,n)}this.activeTab(n)},activeTab:function(n){this.CurrentTab=n;$(".tabs-header-item,.tabs-body-item").removeClass("active");$("#htab-"+n.id+",#tab-"+n.id).addClass("active");this.showHelp()},refreshTab:function(){var t=this.CurrentTab.id,n=$("#tab-"+t+" iframe"),i=n.attr("src");n.attr("src",i)},closePage:function(n){var i=$("#htab-"+n.id),r=i.hasClass("active"),t;r&&(t=i.next(),t.length||(t=i.prev()),t.length&&this.activeTab(t.data("data")));i.remove();$("#tab-"+n.id).remove()},closeAll:function(){var n=this;$(".tabs-header-item").each(function(t,i){var r=$(i).data("data");$(i).text()===Language.HomePage?n.activeTab(r):$("#htab-"+r.id+",#tab-"+r.id).remove()})},closeOne:function(n){var t=$("#"+n).text();t!==Language.HomePage&&this.closePage($("#"+n).data("data"))},closeOther:function(n){var t=this;$(".tabs-header-item").each(function(i,r){if($(r).text()!==Language.HomePage){var u=$(r).data("data");$(r).attr("id")===n?t.activeTab(u):$("#htab-"+u.id+",#tab-"+u.id).remove()}})},bindContextMenu:function(){var t=this,n;$(document).click(function(){n&&n.length&&n.remove()});$(".tabs-header").contextmenu(function(i){var r,u,f;if(i.preventDefault(),r=[],i.target.className==="tabs-header"?r.push({Code:"closeAll",Icon:"fa fa-times",Name:Language.CloseAll}):i.target.className==="title"&&(r.push({Code:"closeAll",Icon:"fa fa-times",Name:Language.CloseAll}),r.push({Code:"closeOne",Icon:"fa fa-times-circle-o",Name:Language.CloseOne}),r.push({Code:"closeOther",Icon:"fa fa-times-circle",Name:Language.CloseOther})),r.length)for(n=$(".ctxmCloseTab").html(""),n.length||(n=$("<ul>").addClass("contextmenu ctxmCloseTab").appendTo($("body"))),n.css({top:i.pageY+"px",left:i.pageX+"px"}),u=0;u<r.length;u++){f=r[u];$("<li>").data("code",f.Code).append('<i class="'+f.Icon+'">').append("<span>"+f.Name+"<\/span>").appendTo(n).on("click",function(){t[$(this).data("code")].call(t,i.target.parentNode.id);n.remove()})}})},showHelp:function(){var u=$(".layout-help");if(u.length){var n=this,t=n.CurrentTab.hid,i=$(".layout-help .content"),r=n.CacheHelps[t];r?i.html(r):(i.html(Language.Loading+"......"),$.get(baseUrl+"/Home/GetHelp?hid="+t,function(r){n.CacheHelps[t]=r;i.html(r)}))}},loadFrame:function(n,t){if(t){if(t.url){n.attr("src",baseUrl+t.url);return}var i="";t.isHome?(i="Dashboard",t.type==="page"&&(i=t.code+"Dashboard")):t.type==="page"&&(i=t.code);n.attr("src",baseUrl+"/?a="+appId+"&m="+i)}}};$(function(){if(!window.localStorage)var n=Layer.open({width:450,height:250,content:function(t){var r=$("<div>").addClass("layout-alert").appendTo(t),i;$("<div>").addClass("alert-content").html(Language.BrowserTips).appendTo(r);i=$("<div>").addClass("alert-toolbar").appendTo(r);$("<button>").addClass("ok").attr("style","margin-right:20px").html(Language.IKnow).appendTo(i).on("click",function(){n.close()});$("<button>").addClass("cancel").html(Language.GoToDownload).appendTo(i).on("click",function(){window.open("https://www.baidu.com/s?wd=chrome")})}})});