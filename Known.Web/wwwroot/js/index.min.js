function log(n){console.log(n)}function Router(n,t){var f=t||{},i=n,r={},u=this;this.elem=i;this.route=function(n){var u=r.component,t;u&&u.destroy&&u.destroy();n.previous||(n.previous=r);r=n;t=n.component;t&&(typeof t=="string"?i.html(t):(i.html(""),t.render(i)),setTimeout(function(){t.mounted&&t.mounted();Page.complete()},10))};this.back=function(){u.route(r.previous)}}function WsUtil(){var n=null,i=!1,t=this;this.connectById=function(n,t,i){window[n]={};this.connect("/ws?id="+n,t,function(n){if(n&&n.length){var t=JSON.parse(n);i&&i(t)}})};this.connect=function(r,u,f){return r=WsUtil.getUrl(r,u),log("Connecting......"),n=new WebSocket(r),n.onopen=function(){log("Connected")},n.onmessage=function(n){n.data&&f&&f(n.data)},n.onclose=function(){i||(log("Disconnected"),t.connect(r,u,f))},n.onerror=function(n){log(n);t.close()},window.onbeforeunload=function(){t.close()},n};this.send=function(t){n&&n.send(t)};this.close=function(){i=!0;n&&(n.close(),n=null,log("Closed"))}}function Card(n,t){var r=$("<div>").addClass("card").addClass(t.style).appendTo(n),i,u,f,e;t.title&&(i=$("<div>").addClass("card-head").appendTo(r),t.icon&&$("<i>").addClass(t.icon).appendTo(i),$("<span>").addClass("title").html(t.title).appendTo(i),t.tool&&(u=$("<span>").addClass("tool").appendTo(i),t.tool(u)));t.body&&(f=$("<div>").addClass("card-body").appendTo(r),t.body(f));t.foot&&(e=$("<div>").addClass("card-foot").appendTo(r),t.foot(e))}function Card(n,t){var r=$("<div>").addClass("card").addClass(t.style).appendTo(n),i,u,f,e;t.title&&(i=$("<div>").addClass("card-head").appendTo(r),t.icon&&$("<i>").addClass(t.icon).appendTo(i),$("<span>").addClass("title").html(t.title).appendTo(i),t.tool&&(u=$("<span>").addClass("tool").appendTo(i),t.tool(u)));t.body&&(f=$("<div>").addClass("card-body").appendTo(r),t.body(f));t.foot&&(e=$("<div>").addClass("card-foot").appendTo(r),t.foot(e))}function LayoutBody(){function i(n){var i=$("<div>").attr("id",t.code).attr("title",t.name).attr("iconCls","fa fa-home").appendTo(n);Admin.render(i,t.code)}function r(t){$(n).tabs("add",{id:t.code,title:t.name,iconCls:t.icon,closable:!0})}var n,t={code:"Dashboard",name:"首页"};this.render=function(r){n=$("<div>").addClass("kui-body easyui-tabs").appendTo(r);i(n);$(n).tabs({onAdd:function(n){var t=$(this).tabs("getTab",n),i=t.attr("id");t.addClass("kui-layout");Admin.render(t,i)},onSelect:function(n){var i=$(this).tabs("getTab",n);t.code=i.attr("id");t.name=n}})};this.resize=function(){$(n).tabs("resize");for(var t in LayoutBody.Resizer)LayoutBody.Resizer[t]()};this.refresh=function(){var i=$(n).tabs("getTab",t.name);Admin.render(i,t.code)};this.showPage=function(t){var i=$(n).tabs("getTab",t.name);i&&i.length?$(n).tabs("select",t.name):r(t)}}function LayoutHead(n){function f(){var r=$("<div>").addClass("toggleMenu").appendTo(i);$("<i>").addClass("fa fa-dedent").attr("title",t.Collapse).appendTo(r).on("click",function(){e($(this));n.resize()})}function e(n){var t=n.data("status");t&&t==="1"?(n.data("status","0").addClass("fa-dedent").removeClass("fa-indent"),$("body").removeClass("kui-mini")):(n.data("status","1").addClass("fa-indent").removeClass("fa-dedent"),$("body").addClass("kui-mini"),$(".nav-tree i").each(function(n,t){var i=$(t).next().text();$(t).attr("title",i)}))}function o(){}function s(){var f=$("<ul>").addClass("nav right").appendTo(i);u(f,t.RefreshPage,"fa fa-refresh",function(){n.refresh()});u(f,t.FullScreen,"fa fa-arrows-alt",function(){c($(this))});r=h(f)}function u(n,t,i,r){var u=$("<li>").addClass("nav-item").attr("title",t).on("click",r).appendTo(n);$("<i>").addClass(i).appendTo(u)}function h(i){var f=$("<li>").addClass("nav-item dropdown").appendTo(i),r=$("<div>").addClass("nav-title title").appendTo(f),u;userAvatar=$("<img>").attr("alt","Avatar").attr("src",curUser.AvatarUrl).appendTo(r);userName=$("<span>").html(curUser.Name).appendTo(r);$("<i>").addClass("fa fa-caret-down arrow").appendTo(r);u=$("<dl>").addClass("nav-child child").appendTo(f);$("<dd>").append('<i class="fa fa-user">').append($("<span>").html(t.UserCenter)).appendTo(u).on("click",function(){n.showPage({code:"UserInfo",name:t.UserCenter,icon:"fa fa-user"})});$("<dd>").append('<i class="fa fa-power-off">').append($("<span>").html(t.SafeLogout)).appendTo(u).on("click",function(){Layer.confirm(t.LogoutConfirm,function(){$.post("/signout",function(){location.reload()})})});return{Avatar:userAvatar,Name:userName}}function c(n){n.data("fullScreen")==="1"?a(n):l(n)}function l(n){var t=document.documentElement,r=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen,i;r?r.call(t):typeof ActiveXObject!="undefined"&&(i=new ActiveXObject("WScript.Shell"),i!==null&&i.SendKeys("{F11}"));n.data("fullScreen","1").html('<i class="fa fa-arrows">')}function a(n){var t=document,r=t.cancelFullScreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.exitFullScreen,i;r?r.call(t):typeof ActiveXObject!="undefined"&&(i=new ActiveXObject("WScript.Shell"),i!==null&&i.SendKeys("{F11}"));n.data("fullScreen","0").html('<i class="fa fa-arrows-alt">')}var t={RefreshPage:"刷新页面",ShareSystem:"分享系统",FullScreen:"全屏切换",SiteMap:"站点地图",UserCenter:"个人中心",SafeLogout:"安全退出",Collapse:"折叠/展开",TechSupport:"技术支持",Feedback:"问题反馈",LogoutConfirm:"确定要退出系统？"},i,r;this.render=function(n){i=$("<div>").addClass("kui-header").appendTo(n);f();s()};this.setMenus=function(n){o(n)};this.setUser=function(n){r.Name.html(n.Name);r.Avatar.attr("src",n.AvatarUrl)}}function LayoutSide(n){function f(n){var t,i;for(Admin.Menus=[],Admin.Buttons=[],t=0;t<n.length;t++)i=n[t],i.type==="button"?Admin.Buttons.push($.extend({},i)):Admin.Menus.push($.extend({},i))}function e(n){var t=Utils.list2Tree(n,appId);t.length&&(t.length>1,i.showMenu(t[0]))}function o(n,f){return $("<div>").addClass("nav-title").append('<i class="'+f.icon+'">').append("<span>"+f.name+"<\/span>").data("page",f).data("show","0").appendTo(n).on("click",function(){var n=$(this),f;r(n);f=n.data("page");f.url||f.type==="page"?i.showPage(f):(t.find(".nav-title").not(n).each(function(n,t){u($(t),!1)}),u(n,n.data("show")==="0"))})}function s(t,i){$("<dd>").append('<i class="'+i.icon+'">').append("<span>"+i.name+"<\/span>").data("page",i).appendTo(t).on("click",function(){r($(this));n.showPage($(this).data("page"))})}function r(n){t.find(".nav-title,.nav-child dd").removeClass("active");n.addClass("active")}function u(n,t){t?(n.data("show","1"),n.next().show(),n.find("span.fa").removeClass("fa-chevron-down").addClass("fa-chevron-up")):(n.data("show","0"),n.next().hide(),n.find("span.fa").removeClass("fa-chevron-up").addClass("fa-chevron-down"))}var t,i=this;this.render=function(n){var i=$("<div>").addClass("kui-side").appendTo(n),u=$("<div>").addClass("logo").appendTo(i),r;$("<img>").attr("src","/img/logo.png").appendTo(u);r=$("<div>").addClass("kui-scroll").appendTo(i);t=$("<ul>").addClass("nav-tree").appendTo(r)};this.setMenus=function(n){f(n);e(n)};this.showMenu=function(n){var r,i,f,e,u,h;for(t.html(""),r=n.children||[],i=0;i<r.length;i++)f=$("<li>").addClass("nav-item").appendTo(t),e=o(f,r[i]),r[i].children&&r[i].children.length&&(u=r[i].children.filter(function(n){return n.type!=="button"}),u&&u.length&&(e.append('<span class="fa fa-chevron-down">'),h=$("<dl>").addClass("nav-child").appendTo(f),$(u).each(function(n,t){s(h,t)})))}}function Dashboard(){function n(n){var t=$("<div>").addClass("card ws-card").appendTo(n),i,r;$("<div>").addClass("ws-title").html("工作台").appendTo(t);$("<img>").addClass("ws-avatar").attr("alt","Avatar").attr("src",curUser.AvatarUrl).appendTo(t);i="早安！"+curUser.Name+"，开始您一天的工作吧！";$("<span>").addClass("ws-name").html(i).appendTo(t);r=(new Date).format("yyyy年MM月dd日 www");$("<span>").addClass("ws-tips").html("今天是："+r).appendTo(t)}function t(n){Card(n,{style:"ws-todo",title:"我的待办",icon:"fa fa-list",body:function(){}})}function i(n){Card(n,{style:"ws-func",title:"常用功能",icon:"fa fa-th",body:function(){}})}this.render=function(r){r.css({padding:"10px",backgroundColor:"inherit"});n(r);var u=$("<div>").addClass("row").appendTo(r);t(u);i(u)}}function DevSample(){function t(t){var i=$("<ul>").appendTo($(t));$(i).tree({data:n,onClick:function(n){$("#dsTitle").html("示例-"+n.text);n.page.render($("#dsPage"))}})}function i(){this.render=function(){}}function r(){this.render=function(){}}function u(){this.render=function(){}}var n=[{text:"表单",children:[{text:"普通表单",page:new i},{text:"高级表单",page:new r}]},{text:"表格",children:[{text:"普通表格",page:new u}]}];this.render=function(n){var i=$("<div>").appendTo(n);$(i).layout({fit:!0});$(i).layout("add",{id:"dsMenu",region:"west",title:"示例菜单",width:"180px",split:!0});$(i).layout("add",{id:"dsPage",region:"center",title:'<span id="dsTitle">示例<\/span>'});t("#dsMenu");LayoutBody.Resizer.resizeDevSample=function(){$(i).layout("resize")}}}function SysModule(){this.render=function(n){var t=$("<table>").appendTo(n);$(t).treegrid({url:"/System/GetModuleTree",method:"get",fit:!0,idField:"id",treeField:"name",columns:[[{title:"Task Name",field:"name",width:180},{field:"persons",title:"Persons",width:60,align:"right"},{field:"begin",title:"Begin Date",width:80},{field:"end",title:"End Date",width:80}]]})}}function Home(){var n=new LayoutBody,t=new LayoutHead(n),i=new LayoutSide(n);this.render=function(r){t.render(r);i.render(r);n.render(r)};this.mounted=function(){$.get("/Home/GetUserData?type=1",function(n){n.user?(Utils.setUser(n.user),Utils.setCodes(n.codes),t.setUser(n.user),i.setMenus(n.menus)):location.reload()})}}var Admin;const DateFormat="yyyy-MM-dd",DateTimeFormat="yyyy-MM-dd HH:mm:ss",KeyToken="Known-Token",KeyUser="Known_User",KeyCode="Known_Codes",KeyClient="Known_Client",KeyDownload="Known-Download";Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},r,t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));/(w+)/.test(n)&&(r=["日","一","二","三","四","五","六"],n=n.replace(RegExp.$1,"星期"+r[this.getDay()]));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};WsUtil.getUrl=function(n,t){var i,r,u;if(n.indexOf("ws://")>-1||n.indexOf("wss://")>-1||(i=location.protocol==="https:"?"wss://":"ws://",n.indexOf(location.host)<0&&(i+=location.host),n=i+n),t){n+=n.indexOf("?")<0?"?":"&";r=[];for(u in t)r.push(u+"="+t[u]);n+=r.join("&")}return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?"":decodeURI(t[2])},getClientId:function(){var r=function(n){var t="";for(i=0;i<n.length;i++)t+=u(n.charCodeAt(i));return t},u=function(n){for(var t=n.toString(16),i=0;i+t.length<4;)t="0"+t,i++;return t},t=document.createElement("canvas"),n=t.getContext("2d");n.font="14px Arial";n.fillStyle="#ccc";n.fillText(KeyClient,2,2);var f=t.toDataURL().replace("data:image/png;base64,",""),e=window.atob(f);return r(e.slice(-16,-12))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},setUser:function(n){var t=KeyUser;n?sessionStorage.setItem(t,JSON.stringify(n)):sessionStorage.removeItem(t)},getUser:function(){var n=sessionStorage.getItem(KeyUser);return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){var t=KeyCode;n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return(r=localStorage.getItem(KeyCode),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion&&(n.form.Province.setData(window.PCARegion,n.data.Province),n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area&&n.form.Area.setData([])}),n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City)),n.form.Area&&(n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)}),n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area))))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&$("<i>").addClass(n.icon).appendTo(i);n.style&&i.addClass(n.style);$("<span>").html(n.text||n.name).appendTo(i);i.on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i},parseDom:function(n,t,i){typeof t=="function"?t(i):n.append(t)}},Layer={open:function(){},loading:function(){},tips:function(){},alert:function(){},confirm:function(){}},Ajax={get:function(n,t,i){$.get(n,t,function(n){n.Message&&Layer.tips(n.Message);n.IsValid?i&&i(n.Data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading();$.post(n,t,function(n){r.close();n.IsValid?(Layer.tips(n.Message),i&&i(n.Data)):n.Message?Layer.alert(n.Message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.IsValid?(Layer.tips(n.Message),r&&r(n.Data)):n.Message?Layer.alert(n.Message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f=KeyDownload,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$("<form>").attr("method","post").attr("action",n).attr("target","").appendTo("body").hide(),u;if($("<input>").attr("type","hidden").attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$("<input>").attr("type","hidden").attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},Page={complete:function(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()});$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser(),app=new Router($("#app"));$(document).ajaxSend(function(n,t){t.setRequestHeader(KeyToken,curUser?curUser.Token:"");t.setRequestHeader(KeyClient,Utils.getClientId())});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?this.location.reload():i.error&&app.route({component:new Error(i)}))}});$(document).contextmenu(function(n){n.preventDefault()});Admin={Menus:[],Buttons:[],render:function(n,t){var i=Page[t],r;i||(i={component:t+" is not exist!"});r=new Router(n);r.route(i)}};LayoutBody.Resizer={};$(window).resize(function(){for(var n in LayoutBody.Resizer)LayoutBody.Resizer[n]()});$.extend(Page,{Dashboard:{component:new Dashboard}});$.extend(Page,{DevSample:{component:new DevSample}});$.extend(Page,{SysModule:{component:new SysModule}});Layer.open=function(){};Layer.loading=function(){};Layer.tips=function(n){$.messager.show({msg:n,timeout:3e3})};Layer.alert=function(n,t){$.messager.alert("提示",n,"info",t)};Layer.confirm=function(n,t){$.messager.confirm("确认",n,function(n){n&&t&&t()})};app.route({component:new Home});