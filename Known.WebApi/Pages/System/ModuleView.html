<div class="mini-splitter" style="width:100%;height:100%;">
    <div id="splitLeft" tooltip="关闭/显示菜单" size="180px" showCollapseButton="true">
        <ul id="leftTree" class="mini-tree" contextMenu="#tbTreeMenu"></ul>
    </div>
    <div id="splitRight"></div>
</div>
<ul id="tbTreeMenu" class="mini-contextmenu">
    <li id="addNode" iconCls="fa-plus">新增</li>
    <li id="removeNode" iconCls="fa-minus">删除</li>
</ul>

<script>
    var ModuleView = {

        leftTree: null,

        show: function () {
            var _this = this;
            this.leftTree = mini.get('leftTree');
            this.leftTree.set({
                url: '/static/data/menu.txt', resultAsTree: false,
                allowDrag: true, allowDrop: true, allowLeafDropIn: true
            });
            this.leftTree.on('nodeclick', function (e) { _this.treeNodeClick(e); });
            this.leftTree.on('drop', function (e) { _this.treeNodeDrop(e); });

            Toolbar.bind('tbTreeMenu', this);
        },

        //tree
        treeNodeClick: function (e) {
            this.showForm(e.node);
        },

        treeNodeDrop: function (e) {
            console.log(e);
        },

        addNode: function () {
            var tree = this.leftTree;
            var node = tree.getSelectedNode();
            tree.addNode({}, "add", node);
        },

        removeNode: function () {
            var tree = this.leftTree;
            var node = tree.getSelectedNode();
            if (node) {
                Message.confirm('确定要删除选中模块？', function () {
                    tree.removeNode(node);
                });
            }
        },

        //form
        showForm: function (node) {
            $('#splitRight').loadView('/System/Partials/ModuleForm', {
                node: node,
                callback: function () {

                }
            });
        }

    };
</script>