<div id="tbFormModule" class="mini-toolbar">
    <a class="mini-button" plain="true" id="save" iconCls="fa-save">保存</a>
    <a class="mini-button" plain="true" id="close" iconCls="fa-remove">关闭</a>
</div>
<div class="mini-fit" style="padding:5px;">
    <table id="formModule" class="form">
        <tr>
            <th style="width:80px;">编码：</th>
            <td>
                <input class="mini-hidden" id="Id" name="Id" />
                <input class="mini-hidden" id="ParentId" name="ParentId" />
                <input class="mini-textbox" id="Code" name="Code" required="true" />
            </td>
            <th style="width:80px;"><span id="icon"></span>名称：</th>
            <td>
                <input class="mini-textbox" id="Name" name="Name" required="true" />
            </td>
        </tr>
        <tr>
            <th>URL：</th>
            <td colspan="3">
                <input class="mini-textbox" id="Url" name="Url" />
            </td>
        </tr>
        <tr>
            <th>选项：</th>
            <td colspan="3">
                <input class="mini-checkbox" id="Enabled" name="Enabled" text="可用" />
            </td>
        </tr>
        <tr>
            <th>描述：</th>
            <td colspan="3">
                <input class="mini-textarea" id="Description" name="Description" />
            </td>
        </tr>
    </table>
</div>

<script>
    var ModuleForm = {

        option: null,
        form: null,

        show: function (option) {
            this.option = option;
            this.form = new Form('formModule');
            this.initForm(option.data);
            Toolbar.bind('tbFormModule', this);
        },

        //toolbar
        save: function () {
            var _this = this;
            if (!_this.form.validate())
                return;

            Ajax.postJson('/api/Module/SaveModule', {
                data: _this.form.getData(true)
            }, function(result) {
                Message.result(result, function (data) {
                    _this.initForm({ Id: data });
                    _this.option.callback();
                });
            });
        },

        //private
        initForm: function (data) {
            var _this = this;
            _this.form.clear();
            if (data.Id === '') {
                _this.form.setData(data);
            } else {
                Ajax.getJson('/api/Module/GetModule', {
                    id: data.Id
                }, function (result) {
                    _this.form.setData(result, function (f, d) {
                        $('#icon').attr('class', 'fa ' + d.Icon);
                    });
                });
            }
        }

    };
</script>
