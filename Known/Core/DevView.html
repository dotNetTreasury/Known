<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Known开发工具</title>
    <link rel="stylesheet" href="/static/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/libs/easyui/easyui.css">
    <style>
        html, body {
            margin: 0;
            font-family: 微软雅黑;
            font-size: 14px;
        }

        .panel-tool, .l-btn-icon, .panel-icon, .menu-icon, .tabs-icon {
            font-family: FontAwesome;
            font-size: 14px !important;
            line-height: normal !important;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: #6699cc;
            text-align: center;
            margin-top: -7px;
        }
    </style>
</head>
<body>
    <h1 style="margin:0;">Known开发工具</h1>
    <table style="width:100%;height:100%;">
        <tr>
            <td style="width:50%;" valign="top">
                <table id="dg"></table>
            </td>
            <td>
                <textarea id="code" style="width:100%;height:100%;"></textarea>
            </td>
        </tr>
    </table>

    <script src="/static/libs/jquery.min.js"></script>
    <script src="/static/libs/easyui/jquery.easyui.min.js"></script>
    <script src="/static/libs/easyui/easyui-lang-zh_CN.js"></script>
    <script>
        $.extend($.fn.datagrid.methods, {
            editCell: function (jq, param) {
                return jq.each(function () {
                    var opts = $(this).datagrid('options');
                    var fields = $(this).datagrid('getColumnFields', true).concat($(this).datagrid('getColumnFields'));
                    for (var i = 0; i < fields.length; i++) {
                        var col = $(this).datagrid('getColumnOption', fields[i]);
                        col.editor1 = col.editor;
                        if (fields[i] != param.field) {
                            col.editor = null;
                        }
                    }
                    $(this).datagrid('beginEdit', param.index);
                    for (var i = 0; i < fields.length; i++) {
                        var col = $(this).datagrid('getColumnOption', fields[i]);
                        col.editor = col.editor1;
                    }
                });
            }
        });

        var DevView = {

            grid: null,
            editIndex: undefined,

            show: function () {
                var _this = this;
                this.grid = $('#dg').datagrid({
                    toolbar: '#tb',
                    onClickCell: this.onClickCell,
                    columns: [[
                        { field: 'ck', checkbox: true },
                        { field: 'Field', title: '字段', width: '25%', editor: 'text' },
                        { field: 'Name', title: '名称', width: '30%', editor: 'text' },
                        { field: 'Type', title: '类型', width: '25%', editor: { type: 'combobox' } },
                        { field: 'Length', title: '长度', width: '15%', editor: 'numberbox' }
                    ]],
                    toolbar: [{
                        iconCls: 'fa-plus', text: '添加',
                        handler: function () { _this.add(); }
                    }, {
                        iconCls: 'fa-minus', text: '移除',
                        handler: function () { _this.remove(); }
                    }]
                });
            },

            onClickCell: function (index, field) {
                var _this = DevView;
                if (_this.endEditing()) {
                    _this.grid.datagrid('selectRow', index)
                        .datagrid('editCell', { index: index, field: field });
                    _this.editIndex = index;
                }
            },

            add: function () {
                this.grid.datagrid('appendRow', {});
                //this.editIndex = this.grid.datagrid('getRows').length - 1;
                //this.grid.datagrid('selectRow', this.editIndex)
                //		 .datagrid('beginEdit', this.editIndex);
            },

            remove: function () {
                if (this.editIndex == undefined)
                    return;

                this.grid.datagrid('cancelEdit', this.editIndex)
                    .datagrid('deleteRow', this.editIndex);
            },

            endEditing: function () {
                if (this.editIndex == undefined)
                    return true;

                if (this.grid.datagrid('validateRow', this.editIndex)) {
                    this.grid.datagrid('endEdit', this.editIndex);
                    this.editIndex = undefined;
                    return true;
                }

                return false;
            }

        };

        DevView.show();
    </script>
</body>
</html>